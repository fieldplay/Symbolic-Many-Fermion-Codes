(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[    586846,      14167]
NotebookOptionsPosition[    585514,      14123]
NotebookOutlinePosition[    586133,      14143]
CellTagsIndexPosition[    586090,      14140]
WindowFrame->Normal
ContainsDynamic->False*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[""], "Input"],

Cell[CellGroupData[{

Cell["Collected Diagram ", "Section",
 CellChangeTimes->{{3.416606193224515*^9, 3.4166062095481043`*^9}, {
  3.4260149174470673`*^9, 3.4260149387083282`*^9}, {3.4260151801186934`*^9, 
  3.426015195076366*^9}, {3.4262833410747128`*^9, 3.426283364975091*^9}, {
  3.428426962748301*^9, 3.428426978340094*^9}, {3.431980900613965*^9, 
  3.431980928131336*^9}, {3.431980978269443*^9, 3.431980993898834*^9}, {
  3.448420669884112*^9, 3.448420675469308*^9}, {3.466909257062312*^9, 
  3.46690925933673*^9}}],

Cell["\<\
John Parkhill 
(*Removes Sum & Permutation Symbols. JAP Nov 2009*)
(*Fixes Disconnected Lambda Bug, JAP Jan 2010*)
(*Fixed External-Internal Number bug JAP Feb 2010*)\
\>", "Text",
 CellChangeTimes->{{3.416606217110368*^9, 3.416606220020578*^9}, 
   3.4484206810281067`*^9, 3.468157449281702*^9, {3.4738659757045383`*^9, 
   3.473866003973871*^9}, {3.474223860846054*^9, 3.474223877850153*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Actual Contraction/Diagram Generation code (MUST BE RUN FIRST)\
\>", "Section",
 CellChangeTimes->{{3.416606294940753*^9, 3.416606321099419*^9}, {
   3.416606708443572*^9, 3.416606708643688*^9}, 3.416606857083449*^9, {
   3.419713174780768*^9, 3.419713180405087*^9}, {3.420392445054091*^9, 
   3.4203924687163267`*^9}, {3.4274765618865833`*^9, 
   3.4274765700257387`*^9}, {3.469025337927885*^9, 3.469025341380086*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"If", " ", "you", " ", "add", " ", "new", " ", "operators"}], ",", 
   " ", 
   RowBox[{
    RowBox[{"make", " ", "sure", " ", "to", " ", "check", " ", 
     RowBox[{"ExtInd", "[", "]"}]}], "..."}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.4854770907068644`*^9, 3.485477106483088*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PrintLevel", "=", "0"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PrintL", "[", "a___", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"PrintLevel", ">", "0"}], ",", 
     RowBox[{"Print", "[", "a", "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SafeReap", "[", "arg_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"tmmp", "=", 
         RowBox[{
          RowBox[{"Reap", "[", "arg", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}], "===", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Null", ",", 
          RowBox[{"{", "}"}]}], "}"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
      RowBox[{"{", "}"}], ",", "tmmp"}], "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Contract", " ", "develops", " ", "all", " ", "possible", " ", 
    "connectivities", " ", "between", " ", "an", " ", "object", " ", "and", 
    " ", "one", " ", "or", " ", "more", " ", "other", " ", 
    RowBox[{"objects", ".", " ", "It"}], " ", "does", " ", "this", " ", "one",
     " ", "line", " ", "\n", "at", " ", "a", " ", 
    RowBox[{"time", ".", " ", "one"}], " ", "sort", " ", "of", " ", "line", 
    " ", "at", " ", "a", " ", 
    RowBox[{"time", "."}]}], " ", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Kontract", "[", 
     RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PrintL", "[", 
       RowBox[{
       "\"\<Kontracting \>\"", ",", "1", ",", "\"\< object with \>\"", " ", 
        ",", 
        RowBox[{"Length", "[", "b", "]"}], ",", "\"\< objects\>\""}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", 
         RowBox[{"\"\<a can make \>\"", ",", 
          RowBox[{"prtt", "=", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"a", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "iter"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"iter", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ",", 
          "\"\< Connections \>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"PrintL", "[", 
         RowBox[{"\"\<But will only be making \>\"", ",", 
          RowBox[{"prtt", "=", 
           RowBox[{"prtt", "-", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", "iter", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"iter", ",", "1", ",", "4"}], "}"}]}], "]"}]}]}], ",", 
          "\"\< Connections \>\""}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "b", "]"}], "<", "6"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"sumt", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"sumt", "+=", 
             RowBox[{"b", "[", 
              RowBox[{"[", 
               RowBox[{"iter1", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"iter1", ",", "1", ",", 
              RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"sumt", "+=", 
             RowBox[{"b", "[", 
              RowBox[{"[", 
               RowBox[{"iter1", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"iter1", ",", "1", ",", 
              RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"sumt", "+=", 
             RowBox[{"b", "[", 
              RowBox[{"[", 
               RowBox[{"iter1", ",", "2", ",", "3"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"iter1", ",", "1", ",", 
              RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"sumt", "+=", 
             RowBox[{"b", "[", 
              RowBox[{"[", 
               RowBox[{"iter1", ",", "2", ",", "4"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"iter1", ",", "1", ",", 
              RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"PrintL", "[", 
             RowBox[{
             "\"\<b has \>\"", ",", "sumt", ",", 
              "\"\< Ends so number of unrestricted connections is \>\"", ",", 
              
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"sumt", "!"}], "*", 
                 RowBox[{"prtt", "!"}]}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"sumt", "-", "prtt"}], ")"}], "!"}], ")"}]}]}], 
             "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"grwnb", "=", 
           RowBox[{"{", "b", "}"}]}], ";"}], ")"}], ",", 
        RowBox[{"grwnb", "=", "b"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"grwna", "=", 
       RowBox[{"{", "a", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"remends", "=", 
       RowBox[{"a", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "\"\<Connecting up occupieds..\>\"", "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Ctmp", "=", 
              RowBox[{"Conect", "[", 
               RowBox[{"grwna", ",", "grwnb", ",", "1"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "True"}], ",", 
               RowBox[{"remends", "=", 
                RowBox[{"remends", "-", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}]}]}]}], 
              "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=!=", "False"}], ",", 
               RowBox[{"grwnb", "=", 
                RowBox[{"Union", "[", 
                 RowBox[{"Ctmp", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "]"}], ";"}], 
            ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"iter", ",", "1", ",", 
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "-", 
              RowBox[{"c", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], "]"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "\"\<Connecting down occupieds..\>\"", "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Ctmp", "=", 
              RowBox[{"Conect", "[", 
               RowBox[{"grwna", ",", "grwnb", ",", "2"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "True"}], ",", 
               RowBox[{"remends", "=", 
                RowBox[{"remends", "-", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}]}]}]}], 
              "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=!=", "False"}], ",", 
               RowBox[{"grwnb", "=", 
                RowBox[{"Union", "[", 
                 RowBox[{"Ctmp", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "]"}], ";"}], 
            ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"iter", ",", "1", ",", 
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", 
              RowBox[{"c", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], "]"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "\"\<Connecting up virtuals..\>\"", "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "3"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Ctmp", "=", 
              RowBox[{"Conect", "[", 
               RowBox[{"grwna", ",", "grwnb", ",", "3"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "True"}], ",", 
               RowBox[{"remends", "=", 
                RowBox[{"remends", "-", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}]}]}]}], 
              "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=!=", "False"}], ",", 
               RowBox[{"grwnb", "=", 
                RowBox[{"Union", "[", 
                 RowBox[{"Ctmp", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "]"}], ";"}], 
            ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"iter", ",", "1", ",", 
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "3"}], "]"}], "]"}], "-", 
              RowBox[{"c", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], "]"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "\"\<Connecting down virtuals..\>\"", "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "4"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Ctmp", "=", 
              RowBox[{"Conect", "[", 
               RowBox[{"grwna", ",", "grwnb", ",", "4"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "True"}], ",", 
               RowBox[{"remends", "=", 
                RowBox[{"remends", "-", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}]}]}], 
              "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Ctmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=!=", "False"}], ",", 
               RowBox[{"grwnb", "=", 
                RowBox[{"Union", "[", 
                 RowBox[{"Ctmp", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "]"}], ";"}], 
            ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"iter", ",", "1", ",", 
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "4"}], "]"}], "]"}], "-", 
              RowBox[{"c", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}]}], "]"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Done Connecting... and there are \>\"", ",", 
        RowBox[{"Length", "[", "grwnb", "]"}], ",", "\"\< branches\>\""}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "grwnb", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "PrintL", "[", 
         "\"\<Adding the ends of A to the output for further Kontraction\>\"",
          "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"remends", "=!=", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"grwnb", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"grwnb", "[", 
                RowBox[{"[", "iter", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"a", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "remends", ",", 
                 RowBox[{"a", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}],
           ";"}], ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter", ",", "1", ",", 
          RowBox[{"Length", "[", "grwnb", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "grwnb", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "grwnb", "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SimplifyCon", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a___", ",", 
       RowBox[{"{", 
        RowBox[{"x_", ",", 
         RowBox[{"g", ":", 
          RowBox[{"{", 
           RowBox[{
           "_Integer", ",", "_Integer", ",", "_Integer", ",", "_Integer"}], 
           "}"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x_", ",", 
         RowBox[{"h", ":", 
          RowBox[{"{", 
           RowBox[{
           "_Integer", ",", "_Integer", ",", "_Integer", ",", "_Integer"}], 
           "}"}]}]}], "}"}], ",", "b___"}], "}"}], "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"a", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", 
         RowBox[{"g", "+", "h"}]}], "}"}], ",", "b"}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Conect", "[", 
     RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"grwna", "=", "a"}], ";", "\[IndentingNewLine]", 
      RowBox[{"grwnb", "=", "b"}], ";", "\[IndentingNewLine]", 
      RowBox[{"newb", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Flag", "=", "False"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "\"\<PrintL Entering Conct..\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
        "PrintL", "[", "\"\<making a single a to b connection...\>\"", "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", 
         RowBox[{"\"\<There are already \>\"", ",", " ", 
          RowBox[{"Length", "[", "b", "]"}], ",", 
          "\"\< Different branches\>\""}], "]"}], " ", ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"PrintL", "[", 
            RowBox[{"\"\<Working on input Branch \>\"", ",", "iter1"}], "]"}],
            ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"thiscona", "=", "grwna"}], ";", "\[IndentingNewLine]", 
          RowBox[{"thisconb", "=", 
           RowBox[{"grwnb", "[", 
            RowBox[{"[", "iter1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"PrintL", "[", 
             RowBox[{"thiscona", ",", "\"\<\\n\>\"", ",", "thisconb"}], "]"}],
             ";"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"c", "\[Equal]", "1"}], ",", 
              RowBox[{
               RowBox[{"PrintL", "[", 
                RowBox[{"\"\<unique connectable amplitudes: \>\"", ",", 
                 RowBox[{"ends", "=", 
                  RowBox[{"Union", "[", 
                   RowBox[{"Cases", "[", 
                    RowBox[{"thisconb", ",", 
                    RowBox[{"{", 
                    RowBox[{"g_", ",", 
                    RowBox[{"{", 
                    RowBox[{"x_", ",", 
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}], ",", "z_", ",", "q_"}], "}"}], 
                    ",", "h___"}], "}"}]}], "]"}], "]"}]}]}], "]"}], ";"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"c", "\[Equal]", "2"}], ",", 
              RowBox[{
               RowBox[{"PrintL", "[", 
                RowBox[{"\"\<unique connectable amplitudes: \>\"", ",", 
                 RowBox[{"ends", "=", 
                  RowBox[{"Union", "[", 
                   RowBox[{"Cases", "[", 
                    RowBox[{"thisconb", ",", 
                    RowBox[{"{", 
                    RowBox[{"g_", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}], ",", "x_", ",", "z_", ",", 
                    "q_"}], "}"}], ",", "h___"}], "}"}]}], "]"}], "]"}]}]}], 
                "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"c", "\[Equal]", "3"}], ",", 
              RowBox[{
               RowBox[{"PrintL", "[", 
                RowBox[{"\"\<unique connectable amplitudes: \>\"", ",", 
                 RowBox[{"ends", "=", 
                  RowBox[{"Union", "[", 
                   RowBox[{"Cases", "[", 
                    RowBox[{"thisconb", ",", 
                    RowBox[{"{", 
                    RowBox[{"g_", ",", 
                    RowBox[{"{", 
                    RowBox[{"x_", ",", "z_", ",", "q_", ",", 
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}]}], "}"}], ",", "h___"}], 
                    "}"}]}], "]"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"c", "\[Equal]", "4"}], ",", 
              RowBox[{
               RowBox[{"PrintL", "[", 
                RowBox[{"\"\<unique connectable amplitudes: \>\"", ",", 
                 RowBox[{"ends", "=", 
                  RowBox[{"Union", "[", 
                   RowBox[{"Cases", "[", 
                    RowBox[{"thisconb", ",", 
                    RowBox[{"{", 
                    RowBox[{"g_", ",", 
                    RowBox[{"{", 
                    RowBox[{"x_", ",", "z_", ",", 
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}], ",", "q_"}], "}"}], ",", 
                    "h___"}], "}"}]}], "]"}], "]"}]}]}], "]"}], ";"}]}], 
             "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"c", "\[Equal]", "1"}], ",", 
            RowBox[{"ends", "=", 
             RowBox[{"Union", "[", 
              RowBox[{"Cases", "[", 
               RowBox[{"thisconb", ",", 
                RowBox[{"{", 
                 RowBox[{"g_", ",", 
                  RowBox[{"{", 
                   RowBox[{"x_", ",", 
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}], ",", "z_", ",", "q_"}], "}"}], 
                  ",", "h___"}], "}"}]}], "]"}], "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"c", "\[Equal]", "2"}], ",", 
            RowBox[{"ends", "=", 
             RowBox[{"Union", "[", 
              RowBox[{"Cases", "[", 
               RowBox[{"thisconb", ",", 
                RowBox[{"{", 
                 RowBox[{"g_", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}], ",", "x_", ",", "z_", ",", 
                    "q_"}], "}"}], ",", "h___"}], "}"}]}], "]"}], "]"}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"c", "\[Equal]", "3"}], ",", 
            RowBox[{"ends", "=", 
             RowBox[{"Union", "[", 
              RowBox[{"Cases", "[", 
               RowBox[{"thisconb", ",", 
                RowBox[{"{", 
                 RowBox[{"g_", ",", 
                  RowBox[{"{", 
                   RowBox[{"x_", ",", "z_", ",", "q_", ",", 
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}]}], "}"}], ",", "h___"}], 
                 "}"}]}], "]"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
           
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"c", "\[Equal]", "4"}], ",", 
            RowBox[{"ends", "=", 
             RowBox[{"Union", "[", 
              RowBox[{"Cases", "[", 
               RowBox[{"thisconb", ",", 
                RowBox[{"{", 
                 RowBox[{"g_", ",", 
                  RowBox[{"{", 
                   RowBox[{"x_", ",", "z_", ",", 
                    RowBox[{"y_", "/;", 
                    RowBox[{"y", ">", "0"}]}], ",", "q_"}], "}"}], ",", 
                  "h___"}], "}"}]}], "]"}], "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "ends", "]"}], ">", "0"}], ",", 
            RowBox[{"Flag", "=", "True"}], ",", 
            RowBox[{"Return", "[", 
             RowBox[{"{", 
              RowBox[{"b", ",", "False"}], "}"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"PrintL", "[", 
             RowBox[{"\"\<Spawning \>\"", ",", 
              RowBox[{"Length", "[", "ends", "]"}], ",", "\"\< Terms\>\""}], 
             "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"POC", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"thisconb", ",", 
                  RowBox[{"ends", "[", 
                   RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"ttmp", "=", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{
                 RowBox[{"thisconb", "[", 
                  RowBox[{"[", "POC", "]"}], "]"}], ",", 
                 RowBox[{"2", "\[Rule]", 
                  RowBox[{
                   RowBox[{"thisconb", "[", 
                    RowBox[{"[", 
                    RowBox[{"POC", ",", "2"}], "]"}], "]"}], "-", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "2"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "1"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "4"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "3"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], 
                    "]"}]}], "]"}]}], "]"}]}], "]"}]}]}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"ttmp", "=", 
               RowBox[{"Append", "[", 
                RowBox[{"ttmp", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"thiscona", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "1"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "2"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "3"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"c", "\[Equal]", "4"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], 
                    "]"}]}], "]"}]}], "]"}]}], "]"}], ",", 
                   RowBox[{"thiscona", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
               ";", "\[IndentingNewLine]", 
              RowBox[{"newb", "=", 
               RowBox[{"Append", "[", 
                RowBox[{"newb", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"thisconb", ",", 
                   RowBox[{"POC", "\[Rule]", "ttmp"}]}], "]"}]}], "]"}]}], 
              ";"}], "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"iter2", ",", "1", ",", 
              RowBox[{"Length", "[", "ends", "]"}]}], "}"}]}], "]"}]}], 
         "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter1", ",", "1", ",", 
          RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "\"\<leaving conct...\>\"", "]"}], ";"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"newb", "=", 
       RowBox[{"Union", "[", "newb", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "newb", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"newb", ",", "Flag"}], "}"}], "]"}], ";"}], 
     "\[IndentingNewLine]", ")"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OnlyCon", "[", 
     RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tempout", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"curt", "=", 
           RowBox[{"c", "[", 
            RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
          RowBox[{"ayes", "=", 
           RowBox[{"Cases", "[", 
            RowBox[{"curt", ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "g___"}], "}"}]}], "]"}]}], ";", "\n", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Cases", "[", 
                 RowBox[{
                  RowBox[{"ayes", "[", 
                   RowBox[{"[", "iter2", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"b", ",", "g___"}], "}"}]}], "]"}], "]"}], "==", 
               "0"}], ",", 
              RowBox[{"(", 
               RowBox[{"Flag", "=", "False"}], ")"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"iter2", ",", "1", ",", 
              RowBox[{"Length", "[", "ayes", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ayes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "===", 
             RowBox[{"{", 
              RowBox[{"Vn", ",", "1"}], "}"}]}], ",", 
            RowBox[{"Flag", "=", "True"}]}], "]"}], ";", "\n", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ayes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "===", 
             RowBox[{"{", 
              RowBox[{"Fn", ",", "1"}], "}"}]}], ",", 
            RowBox[{"Flag", "=", "True"}]}], "]"}], ";", "\n", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Flag", "\[Equal]", "True"}], ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"tempout", "=", 
               RowBox[{"Append", "[", 
                RowBox[{"tempout", ",", "curt"}], "]"}]}], ";"}], ")"}]}], 
           "]"}]}], "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter", ",", "1", ",", 
          RowBox[{"Length", "[", "c", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "tempout", "]"}], ";"}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ConnectedPart", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"intt", "=", "a"}], ";", "\[IndentingNewLine]", 
     RowBox[{"amplist", "=", 
      RowBox[{"Union", "[", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"Sow", "[", 
            RowBox[{"a", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "it", ",", "1"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"it", ",", "1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"a", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}],
         "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"amplist", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"amplist", ",", 
        RowBox[{"{", 
         RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{"amplist", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"amplist", ",", 
        RowBox[{"{", 
         RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Amplitudes: \>\"", ",", " ", "amplist"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"intt", "=", 
        RowBox[{"OnlyCon", "[", 
         RowBox[{
          RowBox[{"amplist", "[", 
           RowBox[{"[", "pter", "]"}], "]"}], ",", "b", ",", "intt"}], 
         "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"pter", ",", "1", ",", 
         RowBox[{"Length", "[", "amplist", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Connected Part \>\"", ",", "intt"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "intt", "]"}], ";"}], "\[IndentingNewLine]", 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NormIndexLessThan", "[", 
    RowBox[{"d_", ",", "e_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"d", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", 
        RowBox[{"e", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], " ", ")"}], "&&", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"d", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", 
        RowBox[{"e", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], " ", ")"}], "&&", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"d", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "\[LessEqual]", 
        RowBox[{"e", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], " ", ")"}], "&&", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"d", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "\[LessEqual]", 
        RowBox[{"e", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], " ", ")"}]}], "]"}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReferenceLessThan", "[", 
    RowBox[{"a_", ",", "c_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"reptmp", "=", 
      RowBox[{"Reap", "[", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"curt", "=", 
            RowBox[{"a", "[", 
             RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"emin", "=", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"emin", "=", 
                RowBox[{"emin", "+", 
                 RowBox[{"curt", "[", 
                  RowBox[{"[", 
                   RowBox[{"iter2", ",", "2"}], "]"}], "]"}]}]}], ";"}], 
              ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"iter2", ",", "1", ",", 
               RowBox[{"Length", "[", "curt", "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"NormIndexLessThan", "[", 
              RowBox[{"emin", ",", "c"}], "]"}], ",", 
             RowBox[{"Sow", "[", "curt", "]"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"iter", ",", "1", ",", 
           RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"reptmp", "=!=", 
        RowBox[{"{", 
         RowBox[{"Null", ",", 
          RowBox[{"{", "}"}]}], "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"reptmp", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";"}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Reference", "[", 
    RowBox[{"a_", ",", "c_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"reptmp", "=", 
      RowBox[{"Reap", "[", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"curt", "=", 
            RowBox[{"a", "[", 
             RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"emin", "=", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"emin", "=", 
                RowBox[{"emin", "+", 
                 RowBox[{"curt", "[", 
                  RowBox[{"[", 
                   RowBox[{"iter2", ",", "2"}], "]"}], "]"}]}]}], ";"}], 
              ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"iter2", ",", "1", ",", 
               RowBox[{"Length", "[", "curt", "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"emin", "===", "c"}], ",", 
             RowBox[{"Sow", "[", "curt", "]"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"iter", ",", "1", ",", 
           RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"reptmp", "=!=", 
        RowBox[{"{", 
         RowBox[{"Null", ",", 
          RowBox[{"{", "}"}]}], "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"reptmp", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";"}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenAmp", "[", "n_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", ">", "0"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"T", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "n", ",", "0", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "n", ",", "0", ",", "n"}], "}"}]}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Iterate", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tonum", "=", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"a", "[", 
           RowBox[{"[", 
            RowBox[{"-", "pter"}], "]"}], "]"}], "*", 
          RowBox[{"b", "^", 
           RowBox[{"(", 
            RowBox[{"pter", "-", "1"}], ")"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"pter", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tonum", "=", 
       RowBox[{"tonum", "+", "1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", "tonum", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"outt", "=", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Sow", "[", 
              RowBox[{"IntegerPart", "[", 
               RowBox[{"tonum", "/", 
                SuperscriptBox["b", 
                 RowBox[{"4", "-", "pter"}]]}], "]"}], "]"}], ";", 
             RowBox[{"tonum", "=", 
              RowBox[{"tonum", "-", 
               RowBox[{
                SuperscriptBox["b", 
                 RowBox[{"4", "-", "pter"}]], "*", 
                RowBox[{"IntegerPart", "[", 
                 RowBox[{"tonum", "/", 
                  SuperscriptBox["b", 
                   RowBox[{"4", "-", "pter"}]]}], "]"}]}]}]}], ";"}], ")"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"pter", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], "[", 
        
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"Return", "[", "outt", "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RemoveNulls", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aa___", ",", "Null", ",", "bb___"}], "}"}], "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"aa", ",", "bb"}], "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RemoveNulls2", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"aa___", ",", 
        RowBox[{"{", "}"}], ",", "bb___"}], "}"}], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"aa", ",", "bb"}], "}"}]}], "}"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AmplDiag", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<Hamiltonian \>\"", ",", 
                  RowBox[{"Ham", "[", 
                   RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                  "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                "\[IndentingNewLine]", "\t", 
                RowBox[{"hotchip", "=", 
                 RowBox[{"Kontract", "[", 
                  RowBox[{
                   RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                   
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                   RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "a", ",", "0", ",", "a"}], "}"}]}], 
                    "]"}]}], ",", " ", 
                   RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "a", ",", "0", ",", "a"}], "}"}]}], 
                    "]"}]}], ";"}]}], "]"}], "\[IndentingNewLine]", "\t", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"st", " ", "=!=", "False"}], ",", 
                   RowBox[{"Sow", "[", "st", "]"}]}], "]"}]}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ")"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The T \>\"", ",", " ", "a", ",", 
       "\"\< Amplitude Equation Of the CC(\>\"", ",", "b", ",", 
       "\"\<)model possesses \>\"", ",", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "Diags", "]"}], ";"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenLam", "[", "n_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"n", ">", "0"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}]}], "}"}]}], 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LamDiag", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"LeaveOff", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<Generating the complete connected similarity transformed \
Hamiltonian for CC-\>\"", ",", "b", ",", "\"\< model\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", "\t", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", "\t", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                ";"}], ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Diagrams to Kontract with lambda: \>\"", ",", "Diags"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"PrintL", "[", 
        RowBox[{"\"\<Here is a Sample... \>\"", ",", 
         RowBox[{"Diags", "[", 
          RowBox[{"[", 
           RowBox[{"Range", "[", 
            RowBox[{"2000", ",", "2030"}], "]"}], "]"}], "]"}]}], "]"}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Lambda]", "=", 
             RowBox[{"GenLam", "[", "lambda", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Working on Lambda amp: \>\"", ",", "\[Lambda]"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cdiag", "=", 
                 RowBox[{"Diags", "[", 
                  RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Ediag", "=", 
                 RowBox[{"Ends", "[", "Cdiag", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Logic", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Ediag", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "a"}], 
                  "\[And]", 
                  RowBox[{
                   RowBox[{"Ediag", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "\[LessEqual]", "a"}], 
                  "\[And]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", " ", 
                    "lambda"}], ")"}], "\[And]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[GreaterEqual]", " ", 
                    RowBox[{"lambda", "-", "a"}]}], ")"}]}], ")"}], "\[And]", 
                  
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "\[LessEqual]", " ", 
                    "lambda"}], ")"}], "\[And]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "\[GreaterEqual]", " ", 
                    RowBox[{"lambda", "-", "a"}]}], ")"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{"Logic", ",", 
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"lambda", ">", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"\[Lambda]", ",", "Cdiag", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "a", ",", "0"}], "}"}]}], 
                    "]"}]}], ";"}], ")"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"{", "Cdiag", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "a", ",", "0"}], "}"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sow", "[", "st", "]"}], ";"}], " ", ")"}]}], 
                    "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
                ";"}], "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"dlist", ",", "1", ",", 
                RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
            ";"}], "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"lambda", ",", "0", ",", "b"}], "}"}]}], "]"}], "]"}], "[",
        
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ldiag", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Removing Diagrams unlinked to \[Lambda]... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ldiag", "=", 
          RowBox[{"RemoveDisconnected", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\[CapitalLambda]", ",", "lambda"}], "}"}], ",", 
            "ldiag"}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"lambda", ",", "1", ",", "b"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{"RemoveLamDisconnected", "[", "ldiag", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The \[CapitalLambda] \>\"", ",", " ", "a", ",", 
       "\"\< Amplitude Equation Of the CC(\>\"", ",", "b", ",", 
       "\"\<)model possesses \>\"", ",", 
       RowBox[{"Length", "[", "ldiag", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ldiag", "]"}], ";"}], ")"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenL", "[", "n_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"n", ">", "0"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}]}], "}"}]}], 
     "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenR", "[", "n_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"n", ">", "0"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "n", ",", "0", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "n", ",", "0", ",", "n"}], "}"}]}], "}"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EOMrDiag", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"LeaveOff", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<Generating the complete connected similarity transformed \
Hamiltonian for CC-\>\"", ",", "b", ",", "\"\< model\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", "\t", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", "\t", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                ";"}], ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Here is a Sample... \>\"", ",", 
       RowBox[{"Diags", "[", 
        RowBox[{"[", 
         RowBox[{"Range", "[", 
          RowBox[{"100", ",", "110"}], "]"}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<Working on R equation amp: \>\"", ",", "a"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"reqn", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Rop", " ", "=", 
             RowBox[{"GenR", "[", "curr", "]"}]}], ";", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Rop: \>\"", ",", "Rop"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Cdiag", "=", 
                    RowBox[{"Diags", "[", 
                    RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"Rop", ",", "Cdiag", ",", 
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "a", ",", "0", ",", "a"}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Cheap", " ", "way", " ", "of", " ", "removing", " ", 
                    "Disconnected", " ", 
                    RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"st", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "Rop"}], "]"}], 
                    ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{"st", "=!=", "False"}], ")"}]}], ",", 
                    RowBox[{"st", "=", "False"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"dlist", ",", "1", ",", 
                    RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
                ";"}], "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"curr", ",", "1", ",", "b"}], "}"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"reqn", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"reqn", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The R\>\"", ",", "a", ",", 
       "\"\< Amplitude Equation Of the CC(\>\"", ",", "b", ",", 
       "\"\<)model possesses \>\"", ",", 
       RowBox[{"Length", "[", "reqn", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "reqn", "]"}], ";"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EOMlDiag", "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ham", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Fn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Fn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Fn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Fn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Vn", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
      "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"LeaveOff", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Amps", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{
     "\"\<Generating the complete connected similarity transformed \
Hamiltonian for CC-\>\"", ",", "b", ",", "\"\< model\>\""}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Diags", "=", 
     RowBox[{
      RowBox[{"Reap", "[", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"InBounds", "==", "True"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ampliste", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Reap", "[", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"Sow", "[", 
                  RowBox[{"GenAmp", "[", 
                   RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
             "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"(", "\[IndentingNewLine]", "\t", 
                  RowBox[{
                   RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                   "\[IndentingNewLine]", "\t", 
                   RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                   "\[IndentingNewLine]", "\t", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\t", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                  "\[IndentingNewLine]", ")"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
               ";"}], ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Amps", "=", 
            RowBox[{"Iterate", "[", 
             RowBox[{"Amps", ",", 
              RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Amps", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ">", 
               RowBox[{"Amps", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "||", 
              RowBox[{
               RowBox[{"Amps", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ">", 
               RowBox[{"Amps", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], "||", 
              RowBox[{
               RowBox[{"Amps", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ">", 
               RowBox[{"Amps", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Amps", "=", 
                RowBox[{"Iterate", "[", 
                 RowBox[{"Amps", ",", 
                  RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
           ";", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Amps", "===", 
              RowBox[{"{", 
               RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
             RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
        "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Diags", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{
     "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
      RowBox[{"Length", "[", "Diags", "]"}], ",", 
      "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Here is a Sample... \>\"", ",", 
      RowBox[{"Diags", "[", 
       RowBox[{"[", 
        RowBox[{"Range", "[", 
         RowBox[{"100", ",", "110"}], "]"}], "]"}], "]"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Working on L equation amp: \>\"", ",", "a"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"reqn", "=", 
     RowBox[{
      RowBox[{"Reap", "[", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Rop", " ", "=", 
            RowBox[{"GenL", "[", "curr", "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Rop: \>\"", ",", "Rop"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"(", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Cdiag", "=", 
                    RowBox[{"Diags", "[", 
                    RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"Rop", ",", "Cdiag", ",", 
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "a", ",", "0"}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Cheap", " ", "way", " ", "of", " ", "removing", " ", 
                    "Disconnected", " ", 
                    RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"st", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "Rop"}], "]"}], 
                    ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{"st", "=!=", "False"}], ")"}]}], ",", 
                    RowBox[{"st", "=", "False"}]}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                  "\[IndentingNewLine]", ")"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"dlist", ",", "1", ",", 
                   RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
               ";"}], "\[IndentingNewLine]", ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"curr", ",", "1", ",", "b"}], "}"}]}], "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
    "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
     "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"reqn", "=", 
     RowBox[{"Union", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"reqn", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]",
     
    RowBox[{"Print", "[", 
     RowBox[{
     "\"\<The R\>\"", ",", "a", ",", "\"\< Amplitude Equation Of the CC(\>\"",
       ",", "b", ",", "\"\<)model possesses \>\"", ",", 
      RowBox[{"Length", "[", "reqn", "]"}], ",", 
      "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "reqn", "]"}], ";"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenLam", "[", "n_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", ">", "0"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CapitalLambda]", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}]}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RemoveDisconnected", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tempout", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tempout", "=", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"curt", "=", 
              RowBox[{"b", "[", 
               RowBox[{"[", "iter", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
             RowBox[{"ayes", "=", 
              RowBox[{"Cases", "[", 
               RowBox[{"curt", ",", 
                RowBox[{"{", 
                 RowBox[{"a", ",", "g___"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"PrintL", "[", "ayes", "]"}], ";", "\[IndentingNewLine]",
              
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ayes", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter2", ",", "2"}], "]"}], "]"}], "===", 
                  RowBox[{"ayes", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter2", ",", "3"}], "]"}], "]"}]}], ",", 
                 RowBox[{"(", 
                  RowBox[{"Flag", "=", "False"}], ")"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"iter2", ",", "1", ",", 
                 RowBox[{"Length", "[", "ayes", "]"}]}], "}"}]}], "]"}], ";", 
             
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ayes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                RowBox[{"{", 
                 RowBox[{"Vn", ",", "1"}], "}"}]}], ",", 
               RowBox[{"Flag", "=", "True"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ayes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                RowBox[{"{", 
                 RowBox[{"Fn", ",", "1"}], "}"}]}], ",", 
               RowBox[{"Flag", "=", "True"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Flag", "==", "False"}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"stmp", "=", 
                  RowBox[{"Cases", "[", 
                   RowBox[{"curt", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Except", "[", "a", "]"}], ",", "g___"}], "}"}]}],
                    "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"stmp", "[", 
                    RowBox[{"[", 
                    RowBox[{"iter2", ",", "2"}], "]"}], "]"}], "=!=", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ",",
                     
                    RowBox[{"(", 
                    RowBox[{"Flag", "=", "True"}], ")"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "stmp", "]"}]}], "}"}]}], "]"}], 
                 ";"}], ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Flag", "\[Equal]", "True"}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tempout", "=", 
                  RowBox[{"Sow", "[", "curt", "]"}]}], ";"}], ")"}], ",", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<Disconnected Diagram: \>\"", ",", "curt"}], 
                "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"iter", ",", "1", ",", 
             RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], "]"}], "[", 
        
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"Return", "[", "tempout", "]"}], ";"}], ")"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "If", " ", "all", " ", "Vacuum", " ", "lines", " ", "of", " ", "a", " ", 
     "Lambda", " ", "diagram", " ", "belong", " ", "to", " ", "Lambda"}], ",",
     " ", 
    RowBox[{"then", " ", "it", " ", 
     RowBox[{"doesn", "'"}], "t", " ", "come", " ", "from", " ", "a", " ", 
     "connected", " ", "amplitude", " ", 
     RowBox[{"diagram", "."}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RemoveLamDisconnected", "[", "b_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tempout", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tempout", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"curt", "=", 
             RowBox[{"b", "[", 
              RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\[IndentingNewLine]",
             
            RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
            RowBox[{"TermVac", "=", 
             RowBox[{"Ends", "[", "curt", "]"}]}], ";", "\[IndentingNewLine]",
             
            RowBox[{"TermLamVac", "=", 
             RowBox[{
              RowBox[{"Cases", "[", 
               RowBox[{"curt", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"\[CapitalLambda]", ",", "_"}], "}"}], ",", 
                  "___"}], "}"}]}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"TermVac", "===", "TermLamVac"}], ",", 
              RowBox[{"Flag", "=", "False"}], ",", 
              RowBox[{"Flag", "=", "True"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Flag", "\[Equal]", "True"}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tempout", "=", 
                 RowBox[{"Sow", "[", "curt", "]"}]}], ";"}], ")"}], ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Lambda-Disconnected Diagram: \>\"", ",", "curt"}],
                "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"iter", ",", "1", ",", 
            RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "tempout", "]"}], ";"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ends", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"emin", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"emin", "=", 
          RowBox[{"emin", "+", 
           RowBox[{"a", "[", 
            RowBox[{"[", 
             RowBox[{"iter2", ",", "2"}], "]"}], "]"}]}]}], ";"}], ")"}], ",",
        
       RowBox[{"{", 
        RowBox[{"iter2", ",", "1", ",", 
         RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "emin", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExcitationRank", "[", "ADiagram_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Narwhal", "=", 
      RowBox[{"Ends", "[", "ADiagram", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"UpRank", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Narwhal", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", 
         RowBox[{"Narwhal", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}], ")"}], "/", "2"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DownRank", " ", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Narwhal", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", 
         RowBox[{"Narwhal", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ")"}], "/", "2"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"UpRank", "-", "DownRank"}], "]"}]}], "\[IndentingNewLine]", 
    ")"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Generates", " ", "Hbar", " ", 
    RowBox[{"Diagrams", ".", " ", "To"}], " ", "get", " ", "algebraic", " ", 
    "expressions", " ", "Run", " ", "DecomposeDM"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMDiag", "[", "b_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"LeaveOff", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<Generating the complete connected similarity transformed \
Hamiltonian for CC-\>\"", ",", "b", ",", "\"\< model\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", "\t", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", "\t", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                ";"}], ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Diagrams to Kontract with lambda: \>\"", ",", "Diags"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"PrintL", "[", 
        RowBox[{"\"\<Here is a Sample... \>\"", ",", 
         RowBox[{"Diags", "[", 
          RowBox[{"[", 
           RowBox[{"Range", "[", 
            RowBox[{"2000", ",", "2030"}], "]"}], "]"}], "]"}]}], "]"}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Lambda]", "=", 
             RowBox[{"GenLam", "[", "lambda", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Working on Lambda amp: \>\"", ",", "\[Lambda]"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cdiag", "=", 
                 RowBox[{"Diags", "[", 
                  RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Ediag", "=", 
                 RowBox[{"Ends", "[", "Cdiag", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Logic", "=", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"lambda", "\[Equal]", "0"}], "||", 
                   RowBox[{"Ediag", "===", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "lambda", ",", "0", ",", "lambda"}], 
                    "}"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{"Logic", ",", 
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"lambda", ">", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"\[Lambda]", ",", "Cdiag", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}]}], ";"}], ")"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"{", "Cdiag", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sow", "[", "st", "]"}], ";"}], " ", ")"}]}], 
                    "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
                ";"}], "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"dlist", ",", "1", ",", 
                RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
            ";"}], "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"lambda", ",", "0", ",", "b"}], "}"}]}], "]"}], "]"}], "[",
        
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ldiag", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<There are \>\"", ",", 
       RowBox[{"Length", "[", "ldiag", "]"}], ",", 
       "\"\< unique closed diagrams which will generate the DM.\>\""}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"onepar", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"ldiag", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "#", "]"}], ",", "Fn"}], "]"}], ">", 
          "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"twopar", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"ldiag", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "#", "]"}], ",", "Vn"}], "]"}], ">", 
          "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<There are \>\"", ",", 
       RowBox[{"Length", "[", "onepar", "]"}], ",", 
       "\"\< unique closed diagrams which will generate the 1-DM.\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<There are \>\"", ",", 
       RowBox[{"Length", "[", "twopar", "]"}], ",", 
       "\"\< unique closed diagrams which will generate the 2-DM.\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<One Particle Density Matrix: \>\"", ",", " ", "onepar"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Two Particle Density Matrix: \>\"", ",", " ", "twopar"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ldiag", "]"}]}], ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenLam", "[", "n_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", ">", "0"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CapitalLambda]", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "0", ",", "n", ",", "0"}], "}"}]}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParticleIndex", "[", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"pind", "++"}], ";", 
     RowBox[{"Return", "[", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"\"\<p\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"pind", "-", "1"}], "]"}]}], "]"}], "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HoleIndex", "[", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"hind", "++"}], ";", 
     RowBox[{"Return", "[", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"\"\<h\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"hind", "-", "1"}], "]"}]}], "]"}], "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NoSinglesAmpDiag", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ContinueFlag", "=", "False"}], ";", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "===", "1"}], ",", 
                  RowBox[{"ContinueFlag", "=", "True"}]}], "]"}], ";"}], 
               ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"ContinueFlag", ",", 
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"While", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Amps", "=", 
                    RowBox[{"Iterate", "[", 
                    RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"Amps", "===", 
                   RowBox[{"{", 
                    RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",",
                   
                  RowBox[{"InBounds", "=", "False"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Continue", "[", "]"}], ";"}], "\[IndentingNewLine]", 
               ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<Hamiltonian \>\"", ",", 
                  RowBox[{"Ham", "[", 
                   RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                  "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"hotchip", "=", 
                 RowBox[{"Kontract", "[", 
                  RowBox[{
                   RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                   
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                  RowBox[{"st", "=", 
                   RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "a", ",", "0", ",", "a"}], "}"}]}], 
                    "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "a", ",", "0", ",", "a"}], "}"}]}], 
                    "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"st", " ", "=!=", "False"}], ",", 
                  RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ")"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The T \>\"", ",", " ", "a", ",", 
       "\"\< Amplitude Equation Of NO SINGLES the CC(\>\"", ",", "b", ",", 
       "\"\<)model possesses \>\"", ",", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "Diags", "]"}], ";"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NoSinglesAllLamDiag", "[", "b_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"LeaveOff", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<Generating the complete connected similarity transformed \
Hamiltonian for NoSing NUMBERED CC-\>\"", ",", "b", ",", "\"\< model\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ContinueFlag", "=", "False"}], ";", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "===", "1"}], ",", 
                  RowBox[{"ContinueFlag", "=", "True"}]}], "]"}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"ContinueFlag", ",", 
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"While", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Amps", "=", 
                    RowBox[{"Iterate", "[", 
                    RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"Amps", "===", 
                   RowBox[{"{", 
                    RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",",
                   
                  RowBox[{"InBounds", "=", "False"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Continue", "[", "]"}], ";"}], "\[IndentingNewLine]", 
               ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Sow", "[", 
                    RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                ";"}], ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Diagrams to Kontract with lambda: \>\"", ",", "Diags"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"PrintL", "[", 
        RowBox[{"\"\<Here is a Sample... \>\"", ",", 
         RowBox[{"Diags", "[", 
          RowBox[{"[", 
           RowBox[{"Range", "[", 
            RowBox[{"2000", ",", "2030"}], "]"}], "]"}], "]"}]}], "]"}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lambda", "===", "1"}], ",", 
              RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Lambda]", "=", 
             RowBox[{"GenLam", "[", "lambda", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Working on Lambda amp: \>\"", ",", "\[Lambda]"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cdiag", "=", 
                 RowBox[{"Diags", "[", 
                  RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Ediag", "=", 
                 RowBox[{"Ends", "[", "Cdiag", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Logic", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Ediag", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "b"}], 
                  "\[And]", 
                  RowBox[{
                   RowBox[{"Ediag", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "\[LessEqual]", "b"}], 
                  "\[And]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", " ", 
                    "lambda"}], ")"}], "\[And]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[GreaterEqual]", " ", 
                    RowBox[{"lambda", "-", "b"}]}], ")"}]}], ")"}], "\[And]", 
                  
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "\[LessEqual]", " ", 
                    "lambda"}], ")"}], "\[And]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "\[GreaterEqual]", " ", 
                    RowBox[{"lambda", "-", "b"}]}], ")"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{"Logic", ",", 
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"lambda", ">", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ReferenceLessThan", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"\[Lambda]", ",", "Cdiag", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"b", ",", "0", ",", "b", ",", "0"}], "}"}]}], 
                    "]"}]}], ";"}], ")"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ReferenceLessThan", "[", 
                    RowBox[{
                    RowBox[{"{", "Cdiag", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"b", ",", "0", ",", "b", ",", "0"}], "}"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sow", "[", "st", "]"}], ";"}], " ", ")"}]}], 
                    "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
                ";"}], "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"dlist", ",", "1", ",", 
                RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
            ";"}], "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"lambda", ",", "0", ",", "b"}], "}"}]}], "]"}], "]"}], "[",
        
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ldiag", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Removing Diagrams unlinked to \[Lambda]... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ldiag", "=", 
          RowBox[{"RemoveDisconnected", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\[CapitalLambda]", ",", "lambda"}], "}"}], ",", 
            "ldiag"}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"lambda", ",", "1", ",", "b"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{"RemoveLamDisconnected", "[", "ldiag", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<Separating \>\"", ",", 
       RowBox[{"Length", "[", "ldiag", "]"}], ",", "\"\< Terms... \>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ldiags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Sow", "[", 
             RowBox[{"Reference", "[", 
              RowBox[{"ldiag", ",", 
               RowBox[{"{", 
                RowBox[{"rnks", ",", "0", ",", "rnks", ",", "0"}], "}"}]}], 
              "]"}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"rnks", ",", "2", ",", "b"}], "}"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<The \[CapitalLambda] \>\"", ",", " ", "rnk", ",", 
           "\"\< Amplitude Equation Of the CC(\>\"", ",", "b", ",", 
           "\"\<)model possesses \>\"", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"ldiags", "[", 
             RowBox[{"[", 
              RowBox[{"rnk", "-", "1"}], "]"}], "]"}], "]"}], ",", 
           "\"\< unique diagrams.\>\""}], "]"}], ";"}], "\[IndentingNewLine]",
         ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"rnk", ",", "2", ",", 
         RowBox[{"1", "+", 
          RowBox[{"Length", "[", "ldiags", "]"}]}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ldiags", "]"}], ";"}], ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NoSinglesDMDiag", "[", "b_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Vn", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"LeaveOff", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Amps", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<Generating the complete connected similarity transformed \
Hamiltonian for NoSingles CC-\>\"", ",", "b", ",", "\"\< model\>\""}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"InBounds", "==", "True"}], ",", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ContinueFlag", "=", "False"}], ";", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "===", "1"}], ",", 
                  RowBox[{"ContinueFlag", "=", "True"}]}], "]"}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"ContinueFlag", ",", 
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"While", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                   RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Amps", "=", 
                    RowBox[{"Iterate", "[", 
                    RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"Amps", "===", 
                   RowBox[{"{", 
                    RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",",
                   
                  RowBox[{"InBounds", "=", "False"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Continue", "[", "]"}], ";"}], "\[IndentingNewLine]", 
               ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ampliste", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Reap", "[", 
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Sow", "[", 
                    RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}], 
               "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
              "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Do", "[", 
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                ";"}], ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Amps", "=", 
             RowBox[{"Iterate", "[", 
              RowBox[{"Amps", ",", 
               RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]",
             
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "||", 
               RowBox[{
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ">", 
                RowBox[{"Amps", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Amps", "=", 
                 RowBox[{"Iterate", "[", 
                  RowBox[{"Amps", ",", 
                   RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Amps", "===", 
               RowBox[{"{", 
                RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
              RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Diags", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Diagrams to Kontract with lambda: \>\"", ",", "Diags"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
       RowBox[{"Length", "[", "Diags", "]"}], ",", 
       "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lambda", "===", "1"}], ",", 
              RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Lambda]", "=", 
             RowBox[{"GenLam", "[", "lambda", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Working on Lambda amp: \>\"", ",", "\[Lambda]"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cdiag", "=", 
                 RowBox[{"Diags", "[", 
                  RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Ediag", "=", 
                 RowBox[{"Ends", "[", "Cdiag", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Logic", "=", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"lambda", "\[Equal]", "0"}], "||", 
                   RowBox[{"Ediag", "===", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "lambda", ",", "0", ",", "lambda"}], 
                    "}"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{"Logic", ",", 
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"lambda", ">", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"\[Lambda]", ",", "Cdiag", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}]}], ";"}], ")"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"{", "Cdiag", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sow", "[", "st", "]"}], ";"}], " ", ")"}]}], 
                    "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
                ";"}], "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"dlist", ",", "1", ",", 
                RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
            ";"}], "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"lambda", ",", "0", ",", "b"}], "}"}]}], "]"}], "]"}], "[",
        
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ldiag", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ldiag", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<There are \>\"", ",", 
       RowBox[{"Length", "[", "ldiag", "]"}], ",", 
       "\"\< unique closed diagrams which will generate the DM.\>\""}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"onepar", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"ldiag", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "#", "]"}], ",", "Fn"}], "]"}], ">", 
          "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"twopar", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"ldiag", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "#", "]"}], ",", "Vn"}], "]"}], ">", 
          "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<There are \>\"", ",", 
       RowBox[{"Length", "[", "onepar", "]"}], ",", 
       "\"\< unique closed diagrams which will generate the 1-DM.\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<There are \>\"", ",", 
       RowBox[{"Length", "[", "twopar", "]"}], ",", 
       "\"\< unique closed diagrams which will generate the 2-DM.\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<One Particle Density Matrix: \>\"", ",", " ", "onepar"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Two Particle Density Matrix: \>\"", ",", " ", "twopar"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ldiag", "]"}]}], ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EvenLamDiag", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LeaveOff", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Amps", "=", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Generating the complete connected similarity transformed \
Hamiltonian for EVEN NUMBERED CC-\>\"", ",", "b", ",", "\"\< model\>\""}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Diags", "=", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"InBounds", "==", "True"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ContinueFlag", "=", "False"}], ";", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"OddQ", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], ",", 
                   RowBox[{"ContinueFlag", "=", "True"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"ContinueFlag", ",", 
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Amps", "=", 
                  RowBox[{"Iterate", "[", 
                   RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"While", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                    RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                    RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Amps", "=", 
                    RowBox[{"Iterate", "[", 
                    RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
                  ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"Amps", "===", 
                    RowBox[{"{", 
                    RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",",
                    
                   RowBox[{"InBounds", "=", "False"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Continue", "[", "]"}], ";"}], "\[IndentingNewLine]",
                 ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"ampliste", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"Reap", "[", 
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Sow", "[", 
                    RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ";"}], 
                    "\[IndentingNewLine]", ")"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}],
                 "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
               "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                    "\[IndentingNewLine]", ")"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                 ";"}], ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Amps", "=", 
              RowBox[{"Iterate", "[", 
               RowBox[{"Amps", ",", 
                RowBox[{"b", "+", "1"}]}], "]"}]}], ";", "\n", 
             RowBox[{"While", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", 
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                RowBox[{
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ">", 
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                RowBox[{
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], ">", 
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Amps", "=", 
                  RowBox[{"Iterate", "[", 
                   RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
              ";", "\n", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Amps", "===", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
               RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
          "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"Diags", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Diagrams to Kontract with lambda: \>\"", ",", "Diags"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
        
        RowBox[{"Length", "[", "Diags", "]"}], ",", 
        "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintL", "[", 
         RowBox[{"\"\<Here is a Sample... \>\"", ",", 
          RowBox[{"Diags", "[", 
           RowBox[{"[", 
            RowBox[{"Range", "[", 
             RowBox[{"2000", ",", "2030"}], "]"}], "]"}], "]"}]}], "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ldiag", "=", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"OddQ", "[", "lambda", "]"}], ",", 
               RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Lambda]", "=", 
              RowBox[{"GenLam", "[", "lambda", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Working on Lambda amp: \>\"", ",", "\[Lambda]"}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Cdiag", "=", 
                  RowBox[{"Diags", "[", 
                   RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Ediag", "=", 
                  RowBox[{"Ends", "[", "Cdiag", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Logic", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "a"}], 
                   "\[And]", 
                   RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "\[LessEqual]", "a"}], 
                   "\[And]", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", " ", 
                    "lambda"}], ")"}], "\[And]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[GreaterEqual]", " ", 
                    RowBox[{"lambda", "-", "a"}]}], ")"}]}], ")"}], "\[And]", 
                   
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "\[LessEqual]", " ", 
                    "lambda"}], ")"}], "\[And]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Ediag", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "\[GreaterEqual]", " ", 
                    RowBox[{"lambda", "-", "a"}]}], ")"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{"Logic", ",", 
                   RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"lambda", ">", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"\[Lambda]", ",", "Cdiag", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "a", ",", "0"}], "}"}]}], 
                    "]"}]}], ";"}], ")"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"{", "Cdiag", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "a", ",", "0"}], "}"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sow", "[", "st", "]"}], ";"}], " ", ")"}]}], 
                    "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
                 ";"}], "\[IndentingNewLine]", ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"dlist", ",", "1", ",", 
                 RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"lambda", ",", "0", ",", "b"}], "}"}]}], "]"}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{
      "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ldiag", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ldiag", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
      "Print", "[", "\"\<Removing Diagrams unlinked to \[Lambda]... \>\"", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ldiag", "=", 
           RowBox[{"RemoveDisconnected", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[CapitalLambda]", ",", "lambda"}], "}"}], ",", 
             "ldiag"}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"lambda", ",", "1", ",", "b"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ldiag", "=", 
       RowBox[{"RemoveLamDisconnected", "[", "ldiag", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<The \[CapitalLambda] \>\"", ",", " ", "a", ",", 
        "\"\< Amplitude Equation Of the CC(\>\"", ",", "b", ",", 
        "\"\<)model possesses \>\"", ",", 
        RowBox[{"Length", "[", "ldiag", "]"}], ",", 
        "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "ldiag", "]"}], ";"}], ")"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EvenDMDiag", "[", "b_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Fn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "1", ",", "2"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2", ",", "0", ",", "2"}], "}"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Vn", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0", ",", "2", ",", "0"}], "}"}]}], "}"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LeaveOff", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Amps", "=", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"InBounds", "=", "True"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Generating the complete connected similarity transformed \
Hamiltonian for CC-\>\"", ",", "b", ",", "\"\< model\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Diags", "=", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"InBounds", "==", "True"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ContinueFlag", "=", "False"}], ";", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"OddQ", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], ",", 
                   RowBox[{"ContinueFlag", "=", "True"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"ContinueFlag", ",", 
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Amps", "=", 
                  RowBox[{"Iterate", "[", 
                   RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"While", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                    RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                    RowBox[{
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ">", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Amps", "=", 
                    RowBox[{"Iterate", "[", 
                    RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
                  ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"Amps", "===", 
                    RowBox[{"{", 
                    RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",",
                    
                   RowBox[{"InBounds", "=", "False"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Continue", "[", "]"}], ";"}], "\[IndentingNewLine]",
                 ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"ampliste", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"Reap", "[", 
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Sow", "[", 
                    RowBox[{"GenAmp", "[", 
                    RowBox[{"Amps", "[", 
                    RowBox[{"[", "it", "]"}], "]"}], "]"}], "]"}], ";"}], 
                    "\[IndentingNewLine]", ")"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"it", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}],
                 "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "//.", 
               "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Hamiltonian \>\"", ",", 
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", 
                    "\"\< amplist \>\"", ",", "ampliste"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"hotchip", "=", 
                    RowBox[{"Kontract", "[", 
                    RowBox[{
                    RowBox[{"Ham", "[", 
                    RowBox[{"[", "iter3", "]"}], "]"}], ",", "ampliste", ",", 
                    
                    RowBox[{"LeaveOff", "[", 
                    RowBox[{"[", "peter", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"iter3", "\[LessEqual]", "4"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Fn", ",", "1"}], "}"}]}], "]"}]}], ",", " ", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"ConnectedPart", "[", 
                    RowBox[{"hotchip", ",", 
                    RowBox[{"{", 
                    RowBox[{"Vn", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"Sow", "[", "st", "]"}]}], "]"}], ";"}], 
                    "\[IndentingNewLine]", ")"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter3", ",", "1", ",", "13"}], "}"}]}], "]"}], 
                 ";"}], ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"peter", ",", "1", ",", "34"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Amps", "=", 
              RowBox[{"Iterate", "[", 
               RowBox[{"Amps", ",", 
                RowBox[{"b", "+", "1"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"While", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", 
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "||", 
                RowBox[{
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ">", 
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "||", 
                RowBox[{
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], ">", 
                 RowBox[{"Amps", "[", 
                  RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Amps", "=", 
                  RowBox[{"Iterate", "[", 
                   RowBox[{"Amps", ",", 
                    RowBox[{"b", "+", "1"}]}], "]"}]}], ";"}], ")"}]}], "]"}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Amps", "===", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "b", ",", "b", ",", "b"}], "}"}]}], ",", 
               RowBox[{"InBounds", "=", "False"}]}], "]"}], ";"}], ")"}]}], 
          "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"Diags", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Diags", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Diagrams to Kontract with lambda: \>\"", ",", "Diags"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<The Similarity Transformed Hamiltonian Possesses \>\"", ",", " ", 
        
        RowBox[{"Length", "[", "Diags", "]"}], ",", 
        "\"\< unique diagrams.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ldiag", "=", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"OddQ", "[", "lambda", "]"}], ",", 
               RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Lambda]", "=", 
              RowBox[{"GenLam", "[", "lambda", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Working on Lambda amp: \>\"", ",", "\[Lambda]"}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Cdiag", "=", 
                  RowBox[{"Diags", "[", 
                   RowBox[{"[", "dlist", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Ediag", "=", 
                  RowBox[{"Ends", "[", "Cdiag", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Logic", "=", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"lambda", "\[Equal]", "0"}], "||", 
                    RowBox[{"Ediag", "===", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "lambda", ",", "0", ",", "lambda"}], 
                    "}"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{"Logic", ",", 
                   RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"lambda", ">", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"Kontract", "[", 
                    RowBox[{"\[Lambda]", ",", "Cdiag", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}]}], ";"}], ")"}], ",", 
                    RowBox[{"st", "=", 
                    RowBox[{"Reference", "[", 
                    RowBox[{
                    RowBox[{"{", "Cdiag", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"st", " ", "=!=", "False"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sow", "[", "st", "]"}], ";"}], " ", ")"}]}], 
                    "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
                 ";"}], "\[IndentingNewLine]", ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"dlist", ",", "1", ",", 
                 RowBox[{"Length", "[", "Diags", "]"}]}], "}"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"lambda", ",", "0", ",", "b"}], "}"}]}], "]"}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{
      "Print", "[", "\"\<Taking the union of all diags generated... \>\"", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ldiag", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ldiag", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<There are \>\"", ",", 
        RowBox[{"Length", "[", "ldiag", "]"}], ",", 
        "\"\< unique closed diagrams which will generate the DM.\>\""}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"onepar", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"ldiag", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "#", "]"}], ",", "Fn"}], "]"}], ">", 
           "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"twopar", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"ldiag", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "#", "]"}], ",", "Vn"}], "]"}], ">", 
           "0"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<There are \>\"", ",", 
        RowBox[{"Length", "[", "onepar", "]"}], ",", 
        "\"\< unique closed diagrams which will generate the 1-DM.\>\""}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<There are \>\"", ",", 
        RowBox[{"Length", "[", "twopar", "]"}], ",", 
        "\"\< unique closed diagrams which will generate the 2-DM.\>\""}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<One Particle Density Matrix: \>\"", ",", " ", "onepar"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Two Particle Density Matrix: \>\"", ",", " ", "twopar"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "ldiag", "]"}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"**", "**", "**", "**", "**", "**", "**", "\n", "The"}], " ", 
     "Functions", " ", "below", " ", "are", " ", "devoted", " ", "to", " ", 
     "the", " ", "algebraic", " ", "interpretation", " ", "of", " ", "the", 
     " ", "diagrams", " ", "generated", " ", "above"}], "..."}], " ", "*)"}], 
  "\n", "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AreEqLines", "[", 
    RowBox[{"t_", ",", "dex1_", ",", "dex2_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sort", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"First", ",", 
           RowBox[{"Position", "[", 
            RowBox[{"t", ",", "dex1", ",", "3"}], "]"}]}], "]"}], "]"}], "===",
         
        RowBox[{"Sort", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"First", ",", 
           RowBox[{"Position", "[", 
            RowBox[{"t", ",", "dex2", ",", "3"}], "]"}]}], "]"}], "]"}]}], 
       ",", 
       RowBox[{"Return", "[", "True", "]"}], ",", 
       RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";"}], 
    "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PutIntoClass", "[", 
    RowBox[{"classes_", ",", "elem_", ",", "ter_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"clast", "=", "classes"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PrintL", "[", 
          RowBox[{"elem", ",", "\"\< \>\"", ",", 
           RowBox[{"classes", "[", 
            RowBox[{"[", 
             RowBox[{"pter", ",", "1"}], "]"}], "]"}], ",", "\"\< \>\"", ",", 
           
           RowBox[{"AreEqLines", "[", 
            RowBox[{"ter", ",", "elem", ",", 
             RowBox[{"classes", "[", 
              RowBox[{"[", 
               RowBox[{"pter", ",", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"AreEqLines", "[", 
            RowBox[{"ter", ",", "elem", ",", 
             RowBox[{"classes", "[", 
              RowBox[{"[", 
               RowBox[{"pter", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"clast", "[", 
               RowBox[{"[", "pter", "]"}], "]"}], "=", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"clast", "[", 
                 RowBox[{"[", "pter", "]"}], "]"}], ",", "elem"}], "]"}]}], 
             ";"}], ")"}]}], "]"}]}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"pter", ",", "1", ",", 
         RowBox[{"Length", "[", "classes", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PrintL", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "clast", "]"}], ",", "\"\< \>\"", " ", ",", 
        "elem", ",", "\"\< \>\"", ",", " ", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "clast", "]"}], ",", "elem"}], "]"}]}], 
       "]"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "clast", "]"}], ",", "elem"}], "]"}]}], 
        ",", 
        RowBox[{"clast", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"clast", ",", 
           RowBox[{"{", "elem", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "clast", "]"}], ";"}], "\[IndentingNewLine]", 
    ")"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EqLines", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"term", "=", "a"}], ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Eqlines term : \>\"", ",", "term"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hl", "=", 
      RowBox[{"ih", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pl", "=", 
      RowBox[{"ip", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"hClasses", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pClasses", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"coef", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"hClasses", "=", 
          RowBox[{"PutIntoClass", "[", 
           RowBox[{"hClasses", ",", 
            RowBox[{"hl", "[", 
             RowBox[{"[", "iter1", "]"}], "]"}], ",", "term"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintL", "[", "hClasses", "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"iter1", ",", "1", ",", 
         RowBox[{"Length", "[", "hl", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"coef", "=", 
          RowBox[{"coef", "*", 
           RowBox[{"(", 
            RowBox[{"1", "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"hClasses", "[", 
                 RowBox[{"[", "iter1", "]"}], "]"}], "]"}], "!"}], ")"}]}], 
            ")"}]}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"iter1", ",", "1", ",", 
         RowBox[{"Length", "[", "hClasses", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pClasses", "=", 
          RowBox[{"PutIntoClass", "[", 
           RowBox[{"pClasses", ",", 
            RowBox[{"pl", "[", 
             RowBox[{"[", "iter1", "]"}], "]"}], ",", "term"}], "]"}]}], ";", 
         "\n", 
         RowBox[{"PrintL", "[", "pClasses", "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"iter1", ",", "1", ",", 
         RowBox[{"Length", "[", "pl", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"coef", "=", 
          RowBox[{"coef", "*", 
           RowBox[{"(", 
            RowBox[{"1", "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"pClasses", "[", 
                 RowBox[{"[", "iter1", "]"}], "]"}], "]"}], "!"}], ")"}]}], 
            ")"}]}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"iter1", ",", "1", ",", 
         RowBox[{"Length", "[", "pClasses", "]"}]}], "}"}]}], "]"}], ";", 
     "\n", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<coef: \>\"", ",", "coef"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "coef", "]"}], ";"}], "\[IndentingNewLine]", 
    ")"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RemoveNulls", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aa___", ",", "Null", ",", "bb___"}], "}"}], "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"aa", ",", "bb"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RemoveNulls2", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"aa___", ",", 
        RowBox[{"{", "}"}], ",", "bb___"}], "}"}], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"aa", ",", "bb"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Fixed", " ", "length", " ", "bug", " ", "JAP", " ", 
      RowBox[{"2", "/", "2010"}]}], " ", "&"}], " ", 
    RowBox[{"Doesn", "'"}], "t", " ", "alter", " ", "order", " ", "of", " ", 
    "indices"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ip", "[", "a_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"seedlist", "=", 
     RowBox[{"Flatten", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"indlist", "=", 
     RowBox[{"Map", "[", 
      RowBox[{"ToExpression", ",", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"StringCases", "[", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"Flatten", "[", "a", "]"}], "]"}], ",", 
           RowBox[{"(", 
            RowBox[{"\"\<p\>\"", "~~", "NumberString"}], ")"}]}], "]"}], ",", 
         
         RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}]}], "]"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"Union", "[", 
      RowBox[{"Select", "[", 
       RowBox[{"indlist", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"seedlist", ",", "#"}], "]"}], ">=", "2"}], ")"}], 
         "&"}]}], "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", ")"}]}], "\n",
 
 RowBox[{
  RowBox[{
   RowBox[{"ih", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"seedlist", "=", 
      RowBox[{"Flatten", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"indlist", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"ToExpression", ",", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"StringCases", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{"Flatten", "[", "a", "]"}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{"\"\<h\>\"", "~~", "NumberString"}], ")"}]}], "]"}], ",",
           
          RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Union", "[", 
       RowBox[{"Select", "[", 
        RowBox[{"indlist", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Count", "[", 
             RowBox[{"seedlist", ",", "#"}], "]"}], ">=", "2"}], ")"}], 
          "&"}]}], "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"ep", "[", "a_", "]"}], ":=", 
     RowBox[{"Complement", "[", 
      RowBox[{
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringCases", "[", 
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{"Union", "[", 
            RowBox[{"Flatten", "[", "a", "]"}], "]"}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{"\"\<p\>\"", "~~", "NumberString"}], ")"}]}], "]"}], "]"}],
        ",", 
       RowBox[{"ip", "[", "a", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"eh", "[", "a_", "]"}], ":=", 
     RowBox[{"Complement", "[", 
      RowBox[{
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringCases", "[", 
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{"Union", "[", 
            RowBox[{"Flatten", "[", "a", "]"}], "]"}], "]"}], ",", 
          RowBox[{"(", 
           RowBox[{"\"\<h\>\"", "~~", "NumberString"}], ")"}]}], "]"}], "]"}],
        ",", 
       RowBox[{"ih", "[", "a", "]"}]}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ep", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"seedlist", "=", 
      RowBox[{"Flatten", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"indlist", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"ToExpression", ",", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"StringCases", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{"Flatten", "[", "a", "]"}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{"\"\<p\>\"", "~~", "NumberString"}], ")"}]}], "]"}], ",",
           
          RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Select", "[", 
       RowBox[{"indlist", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"seedlist", ",", "#"}], "]"}], "\[Equal]", "1"}], ")"}], 
         "&"}]}], "]"}], "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"eh", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"seedlist", "=", 
      RowBox[{"Flatten", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"indlist", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"ToExpression", ",", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"StringCases", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{"Flatten", "[", "a", "]"}], "]"}], ",", 
            RowBox[{"(", 
             RowBox[{"\"\<h\>\"", "~~", "NumberString"}], ")"}]}], "]"}], ",",
           
          RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Select", "[", 
       RowBox[{"indlist", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"seedlist", ",", "#"}], "]"}], "\[Equal]", "1"}], ")"}], 
         "&"}]}], "]"}], "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReOrderIntegralIndices", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TehIntegralBefore", "=", 
      RowBox[{"HamPartAlg", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "TehIntegralBefore", "]"}], "\[Equal]", "0"}], 
       ",", 
       RowBox[{"Return", "[", "a", "]"}]}], "]"}], ";", "\[IndentingNewLine]",
      
     RowBox[{"SpaceList", "=", 
      RowBox[{"OVSpaceList", "[", "TehIntegralBefore", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"SpaceList", "===", 
        RowBox[{"{", 
         RowBox[{"\"\<p\>\"", ",", "\"\<h\>\""}], "}"}]}], ",", 
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"TehIntegralAfter", "=", 
          RowBox[{"Part", "[", 
           RowBox[{"TehIntegralBefore", ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"SpaceList", "===", 
          RowBox[{"{", 
           RowBox[{
           "\"\<h\>\"", ",", "\"\<p\>\"", ",", "\"\<h\>\"", ",", 
            "\"\<h\>\""}], "}"}]}], ",", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"TehIntegralAfter", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"TehIntegralBefore", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "4", ",", "5", ",", "2", ",", "3"}], "}"}]}],
              "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"SpaceList", "===", 
            RowBox[{"{", 
             RowBox[{
             "\"\<p\>\"", ",", "\"\<p\>\"", ",", "\"\<h\>\"", ",", 
              "\"\<h\>\""}], "}"}]}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"TehIntegralAfter", "=", 
              RowBox[{"Part", "[", 
               RowBox[{"TehIntegralBefore", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "4", ",", "5", ",", "2", ",", "3"}], 
                 "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"SpaceList", "===", 
              RowBox[{"{", 
               RowBox[{
               "\"\<p\>\"", ",", "\"\<p\>\"", ",", "\"\<h\>\"", ",", 
                "\"\<p\>\""}], "}"}]}], ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"TehIntegralAfter", "=", 
                RowBox[{"Part", "[", 
                 RowBox[{"TehIntegralBefore", ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "4", ",", "5", ",", "2", ",", "3"}], 
                   "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"SpaceList", "===", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<h\>\"", ",", "\"\<p\>\"", ",", "\"\<h\>\"", ",", 
                  "\"\<h\>\""}], "}"}]}], ",", 
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"TehIntegralAfter", "=", 
                  RowBox[{"Part", "[", 
                   RowBox[{"TehIntegralBefore", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "4", ",", "5", ",", "2", ",", "3"}], 
                    "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"Return", "[", "a", "]"}]}], "]"}]}], "]"}]}], "]"}]}],
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"a", "/.", 
       RowBox[{"{", 
        RowBox[{"TehIntegralBefore", "\[Rule]", "TehIntegralAfter"}], "}"}]}],
       "]"}]}], "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DtA", "[", "a_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AExRank", "=", 
       RowBox[{"ExcitationRank", "[", "a", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pind", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"hind", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"etens", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"itens", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"curt", "=", 
           RowBox[{"a", "[", 
            RowBox[{"[", "eind", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"PrintL", "[", 
           RowBox[{"\"\<Current External Tensor \>\"", ",", 
            RowBox[{"curt", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "\"\< Curt \>\"", ",", " ", 
            "curt"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"ITNS", "=", 
           RowBox[{"IndiciesThatNeedSpawning", "[", "curt", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ITNS", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ">", "0"}], ",", 
            RowBox[{"itmp1", "=", 
             RowBox[{
              RowBox[{"Reap", "[", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"Sow", "[", 
                  RowBox[{"HoleIndex", "[", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ti", ",", "1", ",", 
                   RowBox[{"ITNS", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"itmp1", "=", 
             RowBox[{"{", "Null", "}"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ITNS", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", 
            RowBox[{"itmp2", "=", 
             RowBox[{
              RowBox[{"Reap", "[", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"Sow", "[", 
                  RowBox[{"HoleIndex", "[", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ti", ",", "1", ",", 
                   RowBox[{"ITNS", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"itmp2", "=", 
             RowBox[{"{", "Null", "}"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"pind", "=", 
           RowBox[{"Max", "[", 
            RowBox[{"hind", ",", "pind"}], "]"}]}], ";", " ", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"Slight", " ", "reformatting"}], "..."}], "  ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ITNS", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ">", "0"}], ",", 
            RowBox[{"itmp3", "=", 
             RowBox[{
              RowBox[{"Reap", "[", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"Sow", "[", 
                  RowBox[{"ParticleIndex", "[", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ti", ",", "1", ",", 
                   RowBox[{"ITNS", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"itmp3", "=", 
             RowBox[{"{", "Null", "}"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ITNS", "[", 
              RowBox[{"[", "4", "]"}], "]"}], ">", "0"}], ",", 
            RowBox[{"itmp4", "=", 
             RowBox[{
              RowBox[{"Reap", "[", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"Sow", "[", 
                  RowBox[{"ParticleIndex", "[", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ti", ",", "1", ",", 
                   RowBox[{"ITNS", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"itmp4", "=", 
             RowBox[{"{", "Null", "}"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"hind", "=", 
           RowBox[{"Max", "[", 
            RowBox[{"hind", ",", "pind"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"etens", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"etens", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"curt", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "itmp1", ",", "itmp4", 
               ",", "itmp2", ",", "itmp3"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"durt", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"curt", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "itmp1", ",", "itmp4", ",",
              "itmp2", ",", "itmp3"}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"PrintL", "[", 
           RowBox[{
           "\"\<Indices added for this Connection: \>\"", ",", "durt"}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"cpi1", "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"cpi2", "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"chi1", "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"chi2", "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "curt", "]"}], ">", "3"}], ",", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"curit", "=", 
                 RowBox[{"curt", "[", 
                  RowBox[{"[", "iind", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", "curit", "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<itens \>\"", ",", " ", "itens"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<Cases curit: \>\"", ",", 
                  RowBox[{"Cases", "[", 
                   RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{"etens", ",", "itens"}], "]"}], ",", 
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{"etens", ",", "itens"}], "]"}], ",", "1"}], "]"}],
                     ",", 
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
                   "\[Equal]", "0"}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"itens", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"itens", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"{", "Null", "}"}], ",", 
                    RowBox[{"{", "Null", "}"}], ",", 
                    RowBox[{"{", "Null", "}"}], ",", 
                    RowBox[{"{", "Null", "}"}]}], "}"}]}], "]"}]}], ";", 
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Appending \>\"", ",", 
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ")"}], ",", 
                  RowBox[{"(", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"etens", ",", "1"}], "]"}], ",", 
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
                    "\[NotEqual]", "0"}], ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "PrintL", "[", 
                    "\"\<Making an external tensor internal.\>\"", "]"}], ";",
                     "\[IndentingNewLine]", " ", 
                    RowBox[{"ttm", "=", 
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{"etens", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "g___"}], "}"}]}], 
                    "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"itens", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"itens", ",", "ttm"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"etens", "=", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"etens", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "g___"}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"PrintL", "[", 
                    RowBox[{"itens", ",", "etens"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"PrintL", "[", "ttm", "]"}], ";"}], 
                    "\[IndentingNewLine]", ")"}]}], "]"}], ")"}]}], "]"}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<etens \>\"", ",", " ", "etens"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<itens \>\"", ",", " ", "itens"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<Adding the index \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "indx"}], "}"}], 
                  ",", "\"\< to \>\"", ",", 
                  RowBox[{"pos", "=", 
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"itens", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "g___"}], "}"}]}], 
                    "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", "1"}], 
                  ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Internal Index: \>\"", ",", 
                    RowBox[{"indx", "=", 
                    RowBox[{"durt", "[", 
                    RowBox[{"[", 
                    RowBox[{"4", ",", "chi1"}], "]"}], "]"}]}]}], "]"}], ";", 
                    
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "2"}], "]"}], "]"}], "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "2"}], "]"}], "]"}], ",", "indx"}], 
                    "]"}]}], ";", 
                    RowBox[{"chi1", "++"}], ";"}], ")"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", "2"}], 
                  ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Internal Index: \>\"", ",", 
                    RowBox[{"indx", "=", 
                    RowBox[{"durt", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "chi2"}], "]"}], "]"}]}]}], "]"}], ";", 
                    
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "4"}], "]"}], "]"}], "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "4"}], "]"}], "]"}], ",", "indx"}], 
                    "]"}]}], ";", 
                    RowBox[{"chi2", "++"}]}], ")"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", "3"}], 
                  ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Internal Index: \>\"", ",", 
                    RowBox[{"indx", "=", 
                    RowBox[{"durt", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "cpi1"}], "]"}], "]"}]}]}], "]"}], ";", 
                    
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "5"}], "]"}], "]"}], "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "5"}], "]"}], "]"}], ",", "indx"}], 
                    "]"}]}], ";", 
                    RowBox[{"cpi1", "++"}], ";"}], ")"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"curit", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", "4"}], 
                  ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"PrintL", "[", 
                    RowBox[{"\"\<Internal Index: \>\"", ",", 
                    RowBox[{"indx", "=", 
                    RowBox[{"durt", "[", 
                    RowBox[{"[", 
                    RowBox[{"5", ",", "cpi2"}], "]"}], "]"}]}]}], "]"}], ";", 
                    
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "3"}], "]"}], "]"}], "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"itens", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", ",", "3"}], "]"}], "]"}], ",", "indx"}], 
                    "]"}]}], ";", 
                    RowBox[{"cpi2", "++"}]}], ")"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"PrintL", "[", 
                 RowBox[{"\"\<itens \>\"", ",", " ", "itens"}], "]"}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"iind", ",", "4", ",", 
                RowBox[{"Length", "[", "curt", "]"}]}], "}"}]}], "]"}]}], 
           "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"eind", ",", "1", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "etens", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"itens", "//.", "RemoveNulls"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"outt", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"etens", ",", 
         RowBox[{"itens", "//.", "RemoveNulls"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"outt", "=", 
         RowBox[{"Prepend", "[", 
          RowBox[{"outt", ",", 
           RowBox[{"{", 
            RowBox[{"Sum", ",", 
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{"Union", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"Cases", "[", 
                  RowBox[{
                   RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "outt", "]"}], ",", "2"}], "]"}], 
                   ",", 
                   RowBox[{"{", 
                    RowBox[{"q_Symbol", ",", "q_Symbol"}], "}"}]}], "]"}], 
                 "]"}], "]"}], ",", "T"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"outt", "=", 
       RowBox[{"outt", "//.", "RemoveNulls"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"outt", "=", 
       RowBox[{"outt", "//.", "RemoveNulls2"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"outt", "=", 
       RowBox[{"FmtTens", "[", "outt", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coef", "=", 
       RowBox[{"EqLines", "[", "outt", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Does", " ", "hphh"}], "\[Rule]", 
        RowBox[{"hhhp", " ", 
         RowBox[{"etc", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"outt", "=", 
       RowBox[{"ReOrderIntegralIndices", "[", "outt", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Check", " ", "for", " ", "equivalent", " ", "external", " ", 
        "tensors", " ", "and", " ", "modify", " ", 
        RowBox[{"coef", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"coef3", "=", 
       RowBox[{"(", 
        RowBox[{"1", "/", 
         RowBox[{"ExternalTensorEqFactor", "[", 
          RowBox[{"Prepend", "[", 
           RowBox[{"outt", ",", "coef"}], "]"}], "]"}]}], ")"}]}], ";", 
      RowBox[{"outt", "=", 
       RowBox[{"Prepend", "[", 
        RowBox[{"outt", ",", 
         RowBox[{"Abs", "[", 
          RowBox[{"coef3", "*", "coef", "*", 
           RowBox[{"(", 
            RowBox[{"1", "/", 
             RowBox[{"InternalTensorEqFactor", "[", 
              RowBox[{"Prepend", "[", 
               RowBox[{"outt", ",", "coef"}], "]"}], "]"}]}], ")"}]}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Makes", " ", "sure", " ", "ext", " ", "ind", " ", "are", " ", "in", 
         " ", "order"}], ",", " ", 
        RowBox[{"Rechecks", " ", "Sign"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"outt", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"AExRank", " ", "\[NotEqual]", " ", "0"}], ",", 
         RowBox[{"CommonExtInd", "[", 
          RowBox[{"outt", ",", "AExRank"}], "]"}], ",", "outt"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "If", " ", "Density", " ", "matrix", " ", "make", " ", "sure", " ", 
        "sign", " ", "is", " ", 
        RowBox[{"reassigned", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "outt", "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Removes", " ", "the", " ", "Hamiltonian", " ", "from", " ", "the", " ", 
     "term", " ", "making", " ", "the", " ", "relevant", " ", "indices", " ", 
     "External", "\[IndentingNewLine]", "Used", " ", "to", " ", "construct", 
     " ", "CC"}], "-", 
    RowBox[{"density", " ", 
     RowBox[{"matrices", ".", " ", "Checks"}], " ", "Sign", " ", "is", " ", 
     "correct", " ", "now", " ", 
     RowBox[{"(", 
      RowBox[{"1", "/", "2010"}], ")"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeleteHam", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"WorkingCopy", " ", "=", " ", "a"}], ";", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"dhParticleNumber", "=", "0"}], ";", " ", "\[IndentingNewLine]", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{"a", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Fn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}], 
        ">", "0"}], ",", 
       RowBox[{"dhParticleNumber", "=", "1"}], " ", ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{"a", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Vn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}], 
          ">", "0"}], ",", 
         RowBox[{"dhParticleNumber", "=", "2"}], " ", ",", 
         RowBox[{"Print", "[", "\"\<Error, No Integral Found\>\"", "]"}]}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dhParticleNumber", "==", "1"}], ",", 
       RowBox[{"dhTheIntegral", "=", 
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"a", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Fn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}], 
         "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dhParticleNumber", "\[Equal]", "2"}], ",", 
         RowBox[{"dhTheIntegral", "=", 
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"a", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Vn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}],
            "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ","}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WorkingCopy", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"a", ",", "dhTheIntegral"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SourceIndices", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"dhTheIntegral", ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"HoleNum", "=", 
      RowBox[{"Length", "[", 
       RowBox[{"HolePart", "[", "SourceIndices", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PartNum", "=", 
      RowBox[{"Length", "[", 
       RowBox[{"PartPart", "[", "SourceIndices", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{
      "\"\<HoleNum :: PartNum :\>\"", ",", "HoleNum", ",", "PartNum"}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"pind", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"hind", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DestIndices", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"IsHole", "[", 
           RowBox[{"SourceIndices", "[", 
            RowBox[{"[", "SI", "]"}], "]"}], "]"}], ",", 
          RowBox[{"DestIndices", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"DestIndices", ",", 
             RowBox[{"ExternalHoleIndex", "[", "]"}]}], "]"}]}], ",", 
          RowBox[{"DestIndices", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"DestIndices", ",", 
             RowBox[{"ExternalPartIndex", "[", "]"}]}], "]"}]}]}], "]"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"SI", ",", "1", ",", 
         RowBox[{"Length", "[", "SourceIndices", "]"}]}], "}"}]}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"DestIndices", "=", 
      RowBox[{"Flatten", "[", "DestIndices", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Source \>\"", ",", "SourceIndices"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Dest \>\"", ",", "DestIndices"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ReplacementRules", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"Sow", "[", 
           RowBox[{
            RowBox[{"SourceIndices", "[", 
             RowBox[{"[", "iter", "]"}], "]"}], "\[Rule]", 
            RowBox[{"DestIndices", "[", 
             RowBox[{"[", "iter", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"iter", ",", "1", ",", 
            RowBox[{"Length", "[", "SourceIndices", "]"}]}], "}"}]}], "]"}], 
        "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"WorkingCopy", "=", 
      RowBox[{"WorkingCopy", "//.", 
       RowBox[{"{", "ReplacementRules", "}"}]}]}], ";", "\[IndentingNewLine]",
      
     RowBox[{"WorkingHOps", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"FirstHalf", "[", "DestIndices", "]"}], ",", 
        RowBox[{"Reverse", "[", 
         RowBox[{"SecondHalf", "[", "DestIndices", "]"}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<HamOpString: \>\"", ",", "WorkingHOps"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"WorkingCopy", "=", 
      RowBox[{"WorkingCopy", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"ReFormulateFactorDM", "[", 
       RowBox[{"WorkingCopy", ",", "WorkingHOps"}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Recomputes", " ", "factor", " ", "of", " ", "a", " ", "diagram"}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReFormulateFactorDM", "[", 
   RowBox[{"aterm_", ",", "HamOpString_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TheTerm", "=", 
     RowBox[{"Drop", "[", 
      RowBox[{"aterm", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"PrintL", "[", 
     RowBox[{"\"\<TheTerm: \>\"", ",", "TheTerm"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"coef", "=", 
     RowBox[{"EqLines", "[", "TheTerm", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Check", " ", "for", " ", "equivalent", " ", "external", " ", "tensors", 
      " ", "and", " ", "modify", " ", 
      RowBox[{"coef", "."}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"coef3", "=", 
     RowBox[{"(", 
      RowBox[{"1", "/", 
       RowBox[{"ExternalTensorEqFactor", "[", 
        RowBox[{"Prepend", "[", 
         RowBox[{"TheTerm", ",", "coef"}], "]"}], "]"}]}], ")"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"TheTerm", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"TheTerm", ",", 
       RowBox[{
        RowBox[{"GenerateSignDM", "[", 
         RowBox[{
          RowBox[{"Prepend", "[", 
           RowBox[{"TheTerm", ",", "coef"}], "]"}], ",", "HamOpString"}], 
         "]"}], "*", 
        RowBox[{"Abs", "[", 
         RowBox[{"coef3", "*", "coef", "*", 
          RowBox[{"(", 
           RowBox[{"1", "/", 
            RowBox[{"InternalTensorEqFactor", "[", 
             RowBox[{"Prepend", "[", 
              RowBox[{"TheTerm", ",", "coef"}], "]"}], "]"}]}], ")"}]}], 
         "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "TheTerm", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SQstringDM", "[", 
    RowBox[{"term1_", ",", " ", "HOS_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"term", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"term1", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ToReturn", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"OpsForL", "[", "term", "]"}], ",", 
         RowBox[{"OpsForLam", "[", "term", "]"}], ",", "HOS", ",", 
         RowBox[{"OpsForT", "[", "term", "]"}], ",", 
         RowBox[{"OpsForR", "[", "term", "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<OperatorString:\>\"", ",", " ", "ToReturn"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ToReturn", "]"}], ";"}], "\n", ")"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Second", " ", "arguement", " ", "is", " ", "actually", " ", "the", " ", 
    "Hamiltonian", " ", "operator", " ", 
    RowBox[{"string", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateSignDM", "[", 
    RowBox[{"term_", ",", "TermsERank_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"links", " ", "=", " ", 
      RowBox[{"MakeLinkList", "[", 
       RowBox[{"SQstringDM", "[", 
        RowBox[{"term", ",", "TermsERank"}], " ", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"-", "1"}], ")"}], "^", 
       RowBox[{"NumberOfIntersections", "[", "links", "]"}]}], "]"}]}], "\n", 
    ")"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExternalPartIndex", "[", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"pind", "++"}], ";", 
     RowBox[{"Return", "[", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"\"\<p0\>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"pind", "-", "1"}], "]"}]}], "]"}], "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExternalHoleIndex", "[", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"hind", "++"}], ";", 
      RowBox[{"Return", "[", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"\"\<h0\>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"hind", "-", "1"}], "]"}]}], "]"}], "]"}]}], ")"}]}], ";"}],
   "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HamPartAlg", "[", "a_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ParticleNumber", "=", "0"}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{"a", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Fn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}], 
         ">", "0"}], ",", 
        RowBox[{"ParticleNumber", "=", "1"}], " ", ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"a", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Vn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}],
            ">", "0"}], ",", 
          RowBox[{"ParticleNumber", "=", "2"}], " ", ",", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<Error, No Integral Found-HamPartAlg-\>\"", ",", "a"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Return", "[", 
             RowBox[{"{", "}"}], "]"}], ";"}], "\[IndentingNewLine]", ")"}]}],
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ParticleNumber", "==", "1"}], ",", 
        RowBox[{"TheIntegral", "=", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{"a", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Fn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], "]"}], 
          "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ParticleNumber", "\[Equal]", "2"}], ",", 
          RowBox[{"TheIntegral", "=", 
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"a", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Vn", ",", "1"}], "}"}], ",", "___"}], "}"}]}], 
             "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ","}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "TheIntegral", "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OVSpaceList", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tmp", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"a", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tore", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"Sow", "[", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"IsHole", "[", 
               RowBox[{"tmp", "[", 
                RowBox[{"[", "iter", "]"}], "]"}], "]"}], ",", "\"\<h\>\"", 
              ",", "\"\<p\>\""}], "]"}], "\[IndentingNewLine]", ")"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"iter", ",", "1", ",", 
            RowBox[{"Length", "[", "tmp", "]"}]}], "}"}]}], "]"}], "]"}], "[",
        
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "tore", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "Function", " ", "is", " ", "also", " ", "the", " ", "key", 
    " ", "for", " ", "numbering", " ", "of", " ", "Ham", " ", "Blocks"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InHamBlock", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SpaceList", "=", 
      RowBox[{"OVSpaceList", "[", 
       RowBox[{"HamPartAlg", "[", "a", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"SpaceList", "===", 
         RowBox[{"{", 
          RowBox[{"\"\<h\>\"", ",", "\"\<h\>\""}], "}"}]}], ",", "1", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"SpaceList", "===", 
           RowBox[{"{", 
            RowBox[{"\"\<h\>\"", ",", "\"\<p\>\""}], "}"}]}], ",", "2", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"SpaceList", "===", 
             RowBox[{"{", 
              RowBox[{"\"\<p\>\"", ",", "\"\<p\>\""}], "}"}]}], ",", "3", ",",
             "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"SpaceList", "===", 
               RowBox[{"{", 
                RowBox[{
                "\"\<h\>\"", ",", "\"\<h\>\"", ",", "\"\<h\>\"", ",", 
                 "\"\<h\>\""}], "}"}]}], ",", "4", ",", "\[IndentingNewLine]",
               
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"SpaceList", "===", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<h\>\"", ",", "\"\<h\>\"", ",", "\"\<h\>\"", ",", 
                   "\"\<p\>\""}], "}"}]}], ",", "5", ",", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"SpaceList", "===", 
                   RowBox[{"{", 
                    RowBox[{
                    "\"\<h\>\"", ",", "\"\<h\>\"", ",", "\"\<p\>\"", ",", 
                    "\"\<p\>\""}], "}"}]}], ",", "6", ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"SpaceList", "===", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<h\>\"", ",", "\"\<p\>\"", ",", "\"\<h\>\"", ",", 
                    "\"\<p\>\""}], "}"}]}], ",", "7", ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"SpaceList", "===", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<h\>\"", ",", "\"\<p\>\"", ",", "\"\<p\>\"", ",", 
                    "\"\<p\>\""}], "}"}]}], ",", "8", ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"SpaceList", "===", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<p\>\"", ",", "\"\<p\>\"", ",", "\"\<p\>\"", ",", 
                    "\"\<p\>\""}], "}"}]}], ",", "9", ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<Error! Space Not Found\>\"", ",", "a", ",", 
                    "SpaceList"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], 
                 "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Given", " ", "a", " ", "list", " ", "of", " ", "algebraic", " ", 
     "expressions", " ", "populates", " ", "several", " ", "variables", " ", 
     "gOO"}], ",", "gVV", ",", " ", 
    RowBox[{"gOOVV", " ", 
     RowBox[{"etc", ".", " ", "and"}], " ", "deletes", " ", "hamiltonian"}]}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DecomposeDM", "[", "a_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"gOO", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "1"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gOV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "2"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gVV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "3"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gOOOO", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "4"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gOOOV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "5"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gOOVV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "6"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gOVOV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "7"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gOVVV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "8"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gVVVV", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"DeleteHam", ",", 
        RowBox[{"Select", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"InHamBlock", "[", "#", "]"}], "\[Equal]", "9"}], ")"}], 
           "&"}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HasExternalIndices", "[", 
    RowBox[{"tens_", ",", "term_"}], "]"}], ":=", 
   RowBox[{"(", "\n", 
    RowBox[{"Return", "[", 
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"Intersection", "[", 
        RowBox[{
         RowBox[{"ExtInd", "[", "term", "]"}], ",", "tens"}], "]"}], "]"}], 
      ">", "0"}], "]"}], "\n", ")"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "does", " ", "a", " ", "sort", " ", "of", " ", "transitive", " ", 
     "equivalence", " ", "thingy", " ", "for", " ", 
     RowBox[{"pairs", ":", "  ", 
      RowBox[{"{", 
       RowBox[{"a", ",", "b"}], "}"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"b", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"d", ",", "e"}], "}"}], "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"d", ",", "e"}], "}"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PairsIntoClasses", "[", "pears_", "]"}], ":=", 
   RowBox[{"pears", "//.", 
    RowBox[{"{", "pairrule", "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"pairrule", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aa___", ",", 
       RowBox[{"{", 
        RowBox[{"a___", ",", "b_", ",", "\[Alpha]___"}], "}"}], ",", "bb___", 
       ",", 
       RowBox[{"{", 
        RowBox[{"\[Beta]___", ",", "b_", ",", "c___"}], "}"}], ",", "cc___"}],
       "}"}], "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"aa", ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "\[Alpha]", ",", "\[Beta]", ",", "c"}], 
        "}"}], ",", "bb", ",", "cc"}], "}"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ExternalTensorEqFactor", "[", "r_", "]"}], ":=", 
   RowBox[{"(", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "PrintL", "[", "\"\<Generating Inequivalent Subsets of tensors... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "PrintL", "[", 
      "\"\<Figuring out if any two Tensors have the same name & \
connections... \>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"r", ",", 
        RowBox[{"{", 
         RowBox[{"Sum", ",", 
          RowBox[{"{", "___", "}"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pairs", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"Sort", ",", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{"Length", "[", "ex", "]"}]}], "]"}], ",", 
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{"Length", "[", "ex", "]"}]}], "]"}]}], "}"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"x_", ",", "x_"}], "}"}]}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eqtens", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Reap", "[", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"AreEqTensors", "[", 
                 RowBox[{"ex", ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "2"}], "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"pairs", "[", 
                  RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], "]"}], ";"}], 
             "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"iter", ",", "1", ",", 
              RowBox[{"Length", "[", "pairs", "]"}]}], "}"}]}], "]"}], "]"}], 
         "=!=", 
         RowBox[{"{", 
          RowBox[{"Null", ",", 
           RowBox[{"{", "}"}]}], "}"}]}], ",", 
        RowBox[{
         RowBox[{"Reap", "[", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"AreEqTensors", "[", 
                 RowBox[{"ex", ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "2"}], "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"pairs", "[", 
                  RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], "]"}], ";"}], 
             "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"iter", ",", "1", ",", 
              RowBox[{"Length", "[", "pairs", "]"}]}], "}"}]}], "]"}], "]"}], 
         "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"{", "}"}], "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"eqtens", "=!=", 
        RowBox[{"{", 
         RowBox[{"{", "}"}], "}"}]}], ",", 
       RowBox[{"(", "\n", 
        RowBox[{
         RowBox[{"eqclasses", "=", 
          RowBox[{"PairsIntoClasses", "[", "eqtens", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ExternalClassestemp", "=", 
          RowBox[{"Select", "[", 
           RowBox[{"eqclasses", ",", 
            RowBox[{
             RowBox[{"HasExternalIndices", "[", 
              RowBox[{
               RowBox[{"ex", "[", 
                RowBox[{"[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "ex"}], 
              "]"}], "&"}]}], "]"}]}], ";", "\n", 
         RowBox[{"ExternalClasses", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"r", ",", 
               RowBox[{"1", "+", "#"}]}], "]"}], "&"}], ",", 
            "ExternalClassestemp", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "ExternalClasses", "]"}], "\[NotEqual]", 
            " ", "0"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<External equivalents in term: \>\"", ",", " ", "r", ",", 
               "ExternalClasses"}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"mult", " ", "=", " ", "1"}], ";", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"mult", "=", 
                 RowBox[{"(", 
                  RowBox[{"mult", "*", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ExternalClasses", "[", 
                    RowBox[{"[", "iter", "]"}], "]"}], "]"}], "!"}], ")"}]}], 
                  ")"}]}], ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"iter", ",", "1", ",", 
                 RowBox[{"Length", "[", "ExternalClasses", "]"}]}], "}"}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Return", "[", "mult", "]"}], ";"}], 
            "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"PrintL", "[", "\"\<No Eq Tensors...\>\"", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Return", "[", "1", "]"}], ";"}], "\[IndentingNewLine]", 
            ")"}]}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"Return", "[", "1", "]"}]}], "]"}], ";"}], 
    "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"In", " ", "cc"}], "-", 
    RowBox[{"amplitude", " ", "equations", " ", "these", " ", 
     RowBox[{"can", "'"}], "t", " ", 
     RowBox[{"occur", ".", " ", "but"}], " ", "they", " ", "can", " ", "in", 
     " ", "DM", " ", "or", " ", "Lambda", " ", 
     RowBox[{"Diag", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InternalTensorEqFactor", "[", "r_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "PrintL", "[", "\"\<Generating Inequivalent Subsets of tensors... \>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "PrintL", "[", 
      "\"\<Figuring out if any Internal Tensors have the same name & \
connections... \>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"r", ",", 
        RowBox[{"{", 
         RowBox[{"Sum", ",", 
          RowBox[{"{", "___", "}"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pairs", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"Sort", ",", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{"Length", "[", "ex", "]"}]}], "]"}], ",", 
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{"Length", "[", "ex", "]"}]}], "]"}]}], "}"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"x_", ",", "x_"}], "}"}]}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eqtens", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Reap", "[", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"AreEqTensors", "[", 
                 RowBox[{"ex", ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "2"}], "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"pairs", "[", 
                  RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], "]"}], ";"}], 
             "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"iter", ",", "1", ",", 
              RowBox[{"Length", "[", "pairs", "]"}]}], "}"}]}], "]"}], "]"}], 
         "=!=", 
         RowBox[{"{", 
          RowBox[{"Null", ",", 
           RowBox[{"{", "}"}]}], "}"}]}], ",", 
        RowBox[{
         RowBox[{"Reap", "[", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"AreEqTensors", "[", 
                 RowBox[{"ex", ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"pairs", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter", ",", "2"}], "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"pairs", "[", 
                  RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], "]"}], ";"}], 
             "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"iter", ",", "1", ",", 
              RowBox[{"Length", "[", "pairs", "]"}]}], "}"}]}], "]"}], "]"}], 
         "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"{", "}"}], "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"eqtens", "=!=", 
        RowBox[{"{", 
         RowBox[{"{", "}"}], "}"}]}], ",", 
       RowBox[{"(", "\n", 
        RowBox[{
         RowBox[{"eqclasses", "=", 
          RowBox[{"PairsIntoClasses", "[", "eqtens", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"InternalClassestemp", "=", 
          RowBox[{"Select", "[", 
           RowBox[{"eqclasses", ",", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"HasExternalIndices", "[", 
               RowBox[{
                RowBox[{"ex", "[", 
                 RowBox[{"[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "ex"}], 
               "]"}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"InternalClasses", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"r", ",", 
               RowBox[{"1", "+", "#"}]}], "]"}], "&"}], ",", 
            "InternalClassestemp", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "InternalClasses", "]"}], "\[NotEqual]", 
            " ", "0"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<Internal equivalents in term: \>\"", ",", " ", "r", ",", 
               "InternalClasses"}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"mult", " ", "=", " ", "1"}], ";", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"mult", "=", 
                 RowBox[{"(", 
                  RowBox[{"mult", "*", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"InternalClasses", "[", 
                    RowBox[{"[", "iter", "]"}], "]"}], "]"}], "!"}], ")"}]}], 
                  ")"}]}], ")"}], ",", 
               RowBox[{"{", 
                RowBox[{"iter", ",", "1", ",", 
                 RowBox[{"Length", "[", "InternalClasses", "]"}]}], "}"}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Return", "[", "mult", "]"}], ";"}], 
            "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"PrintL", "[", "\"\<No Int-Eq Tensors...\>\"", "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"Return", "[", "1", "]"}], ";"}], "\[IndentingNewLine]", 
            ")"}]}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"Return", "[", "1", "]"}]}], "]"}], ";"}], "\n", ")"}]}], 
  "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Code", " ", "to", " ", "generate", " ", "a", " ", "second", " ", 
     "quantized", " ", "version", " ", "of", " ", "a", " ", "string", " ", 
     "for", " ", "the", " ", "purposes", " ", "of", " ", "getting", " ", 
     "the", " ", "sign", " ", "of", " ", "a", " ", "term"}], "..."}], "  ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Sign", " ", "generation", " ", "code", " ", "requires", " ", 
      "definition", " ", "of", " ", "the", " ", "SQ", " ", 
      RowBox[{"operator", ".", " ", "OpsForX"}]}], "..."}], " ", 
    RowBox[{"Etc", "."}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "ERank", " ", "is", " ", "used", " ", "to", " ", "determine", " ", "where",
     " ", "the", " ", "external", " ", "indices", " ", "occur", " ", "in", 
    " ", "a", " ", 
    RowBox[{"term", ".", "\[IndentingNewLine]", "\t", "If"}], " ", "they", 
    " ", "occur", " ", "on", " ", "the", " ", "inside", " ", "the", " ", "DM",
     " ", "version", " ", "of", " ", "this", " ", "routine", " ", "must", " ",
     "be", " ", 
    RowBox[{"used", "."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SQstring", "[", 
    RowBox[{"term1_", ",", " ", "ERank_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"term", "=", "term1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ToReturn", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ERank", ">", "0"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"OpsForL", "[", "term", "]"}], ",", 
           RowBox[{"LeftVacOps", "[", "ERank", "]"}], ",", 
           RowBox[{"OpsForLam", "[", "term", "]"}], ",", 
           RowBox[{"OpsForH", "[", "term", "]"}], ",", 
           RowBox[{"OpsForT", "[", "term", "]"}], ",", 
           RowBox[{"OpsForR", "[", "term", "]"}], ",", 
           RowBox[{"OpsForX", "[", 
            RowBox[{"term", ",", "\[CapitalSigma]"}], "]"}]}], "]"}], "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ERank", "==", "0"}], ",", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"OpsForL", "[", "term", "]"}], ",", 
             RowBox[{"OpsForLam", "[", "term", "]"}], ",", 
             RowBox[{"OpsForH", "[", "term", "]"}], ",", 
             RowBox[{"OpsForT", "[", "term", "]"}], ",", 
             RowBox[{"OpsForR", "[", "term", "]"}], ",", 
             RowBox[{"OpsForX", "[", 
              RowBox[{"term", ",", "\[CapitalSigma]"}], "]"}]}], "]"}], "]"}],
           ",", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"OpsForL", "[", "term", "]"}], ",", 
             RowBox[{"OpsForLam", "[", "term", "]"}], ",", 
             RowBox[{"OpsForH", "[", "term", "]"}], ",", 
             RowBox[{"OpsForT", "[", "term", "]"}], ",", 
             RowBox[{"OpsForR", "[", "term", "]"}], ",", 
             RowBox[{"OpsForX", "[", 
              RowBox[{"term", ",", "\[CapitalSigma]"}], "]"}], ",", 
             RowBox[{"RightVacOps", "[", "ERank", "]"}]}], "]"}], "]"}]}], 
         "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"Return", "[", "ToReturn", "]"}], ";"}], "\n", ")"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"HolePart", "[", "presh_", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{"Select", "[", 
    RowBox[{"presh", ",", "IsHole"}], "]"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"IsHole", "[", "Indexx_", "]"}], ":=", 
  RowBox[{
   RowBox[{"StringCount", "[", 
    RowBox[{
     RowBox[{"ToString", "[", "Indexx", "]"}], ",", 
     RowBox[{"(", 
      RowBox[{"\"\<h\>\"", "~~", "NumberString"}], ")"}]}], "]"}], 
   "\[NotEqual]", "0"}]}], "\n", 
 RowBox[{
  RowBox[{"PartPart", "[", "presh_", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{"Select", "[", 
    RowBox[{"presh", ",", "IsPart"}], "]"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"IsPart", "[", "Indexx_", "]"}], ":=", 
  RowBox[{
   RowBox[{"StringCount", "[", 
    RowBox[{
     RowBox[{"ToString", "[", "Indexx", "]"}], ",", 
     RowBox[{"(", 
      RowBox[{"\"\<p\>\"", "~~", "NumberString"}], ")"}]}], "]"}], 
   "\[NotEqual]", "0"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FirstHalf", "[", "presh_", "]"}], ":=", 
   RowBox[{"Drop", "[", 
    RowBox[{"presh", ",", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Length", "[", "presh", "]"}]}], "/", "2"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SecondHalf", "[", "presh_", "]"}], ":=", 
    RowBox[{"Drop", "[", 
     RowBox[{"presh", ",", 
      RowBox[{
       RowBox[{"Length", "[", "presh", "]"}], "/", "2"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LamPart", "[", "term_", "]"}], ":=", 
   RowBox[{"Cases", "[", 
    RowBox[{"term", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CapitalLambda]", ",", "aa_"}], "}"}], ",", "gg___"}], 
      "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"HPart", "[", "term_", "]"}], ":=", 
   RowBox[{"Cases", "[", 
    RowBox[{"term", ",", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Vn", ",", "aa_"}], "}"}], ",", "gg___"}], "}"}], "|", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Fn", ",", "aa_"}], "}"}], ",", "gg___"}], "}"}]}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TPart", "[", "term_", "]"}], ":=", 
   RowBox[{"Cases", "[", 
    RowBox[{"term", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"T", ",", "aa_"}], "}"}], ",", "gg___"}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RPart", "[", "term_", "]"}], ":=", 
   RowBox[{"Cases", "[", 
    RowBox[{"term", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"R", ",", "aa_"}], "}"}], ",", "gg___"}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LPart", "[", "term_", "]"}], ":=", 
   RowBox[{"Cases", "[", 
    RowBox[{"term", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"L", ",", "aa_"}], "}"}], ",", "gg___"}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"XPart", "[", 
    RowBox[{"term_", ",", "X_"}], "]"}], ":=", 
   RowBox[{"Cases", "[", 
    RowBox[{"term", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"X", ",", "aa_"}], "}"}], ",", "gg___"}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IndicesOf", "[", "fac_", "]"}], ":=", 
    RowBox[{"DeleteCases", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"fac", ",", "1"}], "]"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"T", ",", "aa_"}], "}"}], "|", 
       RowBox[{"{", 
        RowBox[{"Vn", ",", "1"}], "}"}], "|", 
       RowBox[{"{", 
        RowBox[{"\[CapitalLambda]", ",", "aa_"}], "}"}], "|", 
       RowBox[{"{", 
        RowBox[{"Fn", ",", "1"}], "}"}]}]}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OpsForH", "[", "term_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"intemp", "=", 
      RowBox[{"IndicesOf", "[", 
       RowBox[{"HPart", "[", "term", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"FirstHalf", "[", "intemp", "]"}], ",", 
        RowBox[{"Reverse", "[", 
         RowBox[{"SecondHalf", "[", "intemp", "]"}], "]"}]}], "]"}], "]"}], 
     ";"}], "\n", ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OpsForR", "[", "term_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"intemp", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"IndicesOf", ",", 
        RowBox[{"RPart", "[", "term", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"PartPart", "[", "#", "]"}], ",", 
            RowBox[{"Reverse", "[", 
             RowBox[{"HolePart", "[", "#", "]"}], "]"}]}], "]"}], "&"}], ",", 
         "intemp"}], "]"}], "]"}], "]"}], ";"}], "\n", ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OpsForL", "[", "term_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"intemp", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"IndicesOf", ",", 
        RowBox[{"LPart", "[", "term", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"PartPart", "[", "#", "]"}], ",", 
            RowBox[{"Reverse", "[", 
             RowBox[{"HolePart", "[", "#", "]"}], "]"}]}], "]"}], "&"}], ",", 
         "intemp"}], "]"}], "]"}], "]"}], ";"}], "\n", ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OpsForT", "[", "term_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"intemp", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"IndicesOf", ",", 
        RowBox[{"TPart", "[", "term", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"PartPart", "[", "#", "]"}], ",", 
            RowBox[{"Reverse", "[", 
             RowBox[{"HolePart", "[", "#", "]"}], "]"}]}], "]"}], "&"}], ",", 
         "intemp"}], "]"}], "]"}], "]"}], ";"}], "\n", ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OpsForX", "[", 
    RowBox[{"term_", ",", "X_"}], "]"}], ":=", 
   RowBox[{"(", "\n", 
    RowBox[{
     RowBox[{"intemp", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"IndicesOf", ",", 
        RowBox[{"XPart", "[", 
         RowBox[{"term", ",", "X"}], "]"}]}], "]"}]}], ";", "\n", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"PartPart", "[", "#", "]"}], ",", 
            RowBox[{"Reverse", "[", 
             RowBox[{"HolePart", "[", "#", "]"}], "]"}]}], "]"}], "&"}], ",", 
         "intemp"}], "]"}], "]"}], "]"}], ";"}], "\n", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeftVacOps", "[", "arrank_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"(", 
           RowBox[{"\"\<h0\>\"", "~~", 
            RowBox[{"ToString", "[", "iiter", "]"}]}], ")"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"iiter", ",", 
           RowBox[{"arrank", "+", "1"}], ",", 
           RowBox[{"2", "*", "arrank"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"(", 
           RowBox[{"\"\<p0\>\"", "~~", 
            RowBox[{"ToString", "[", "iiter", "]"}]}], ")"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"iiter", ",", "arrank", ",", "1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}], "]"}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RightVacOps", "[", "marrank_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"arrank", "=", 
      RowBox[{
       RowBox[{"-", "1"}], "*", "marrank"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"(", 
            RowBox[{"\"\<p0\>\"", "~~", 
             RowBox[{"ToString", "[", "iiter", "]"}]}], ")"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"iiter", ",", "1", ",", "arrank"}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"(", 
            RowBox[{"\"\<h0\>\"", "~~", 
             RowBox[{"ToString", "[", "iiter", "]"}]}], ")"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"iiter", ",", 
            RowBox[{"2", "*", "arrank"}], ",", 
            RowBox[{"arrank", "+", "1"}], ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VacName", "[", "arrank_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"(", 
           RowBox[{"\"\<h0\>\"", "~~", 
            RowBox[{"ToString", "[", "iiter", "]"}]}], ")"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"iiter", ",", 
           RowBox[{"arrank", "+", "1"}], ",", 
           RowBox[{"2", "*", "arrank"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"(", 
           RowBox[{"\"\<p0\>\"", "~~", 
            RowBox[{"ToString", "[", "iiter", "]"}]}], ")"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"iiter", ",", "1", ",", "arrank"}], "}"}]}], "]"}]}], "]"}],
      "]"}], "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OpsForLam", "[", "term_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"intemp", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"IndicesOf", ",", 
         RowBox[{"LamPart", "[", "term", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"HolePart", "[", "#", "]"}], ",", 
             RowBox[{"Reverse", "[", 
              RowBox[{"PartPart", "[", "#", "]"}], "]"}]}], "]"}], "&"}], ",",
           "intemp"}], "]"}], "]"}], "]"}], ";"}], "\n", ")"}]}], ";"}], "\n",
   "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeLinkList", "[", "lis_", "]"}], ":=", 
  RowBox[{"(", "\n", 
   RowBox[{
    RowBox[{"uelems", " ", "=", " ", 
     RowBox[{"Union", "[", "lis", "]"}]}], ";", "\n", 
    RowBox[{"Return", "[", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sort", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"lis", ",", "#"}], "]"}], "]"}], "&"}], ",", "uelems"}], 
      "]"}], "]"}], ";"}], "\n", ")"}]}], "\n", 
 RowBox[{
  RowBox[{"NumberOfIntersections", "[", "ll_", "]"}], ":=", 
  RowBox[{"(", "\n", 
   RowBox[{
    RowBox[{"nints", "=", "0"}], ";", "\n", 
    RowBox[{"pairstolookat", " ", "=", " ", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{"Union", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"Sort", ",", 
           RowBox[{"Tuples", "[", 
            RowBox[{"ll", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"same_", ",", "same_"}], "}"}]}], "]"}]}], ";", "\n", 
    RowBox[{"inmap", " ", "=", " ", 
     RowBox[{"Map", "[", 
      RowBox[{"crosses", ",", "pairstolookat"}], "]"}]}], ";", "\n", 
    RowBox[{"Return", "[", 
     RowBox[{"Total", "[", "inmap", "]"}], "]"}], ";"}], "\n", 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"intersects", "[", 
    RowBox[{"{", 
     RowBox[{"range1_", ",", "range2_"}], "}"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"Intersection", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{
           RowBox[{"range1", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"range1", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"Range", "[", 
          RowBox[{
           RowBox[{"range2", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"range2", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], "]"}], 
      ">", "0"}], ",", "1", ",", "0"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"crosses", "[", 
     RowBox[{"{", 
      RowBox[{"range1_", ",", "range2_"}], "}"}], "]"}], ":=", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"intersects", "[", 
          RowBox[{"{", 
           RowBox[{"range1", ",", "range2"}], "}"}], "]"}], "\[Equal]", "1"}],
         ")"}], "&&", 
       RowBox[{"(", 
        RowBox[{"!", 
         RowBox[{"IntervalMemberQ", "[", 
          RowBox[{
           RowBox[{"Interval", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"range1", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"range1", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}], ",", 
           RowBox[{"Interval", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"range2", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"range2", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}]}], 
          "]"}]}], ")"}], "&&", 
       RowBox[{"(", 
        RowBox[{"!", 
         RowBox[{"IntervalMemberQ", "[", 
          RowBox[{
           RowBox[{"Interval", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"range2", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"range2", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}], ",", 
           RowBox[{"Interval", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"range1", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"range1", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}]}], 
          "]"}]}], ")"}]}], ",", "1", ",", "0"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Create", " ", "sign", " ", "of", " ", "a", " ", "diagram", " ", "by", " ",
     "appealing", " ", "to", " ", 
    RowBox[{"it", "'"}], "s", " ", "second", " ", "quantized", " ", 
    "string"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"GenerateSign", "[", 
   RowBox[{"term_", ",", "TermsERank_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"links", " ", "=", " ", 
     RowBox[{"MakeLinkList", "[", 
      RowBox[{"SQstring", "[", 
       RowBox[{"term", ",", "TermsERank"}], " ", "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"-", "1"}], ")"}], "^", 
      RowBox[{"NumberOfIntersections", "[", "links", "]"}]}], "]"}]}], "\n", 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"IndiciesThatNeedSpawning", "[", "b_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"extones", "=", 
     RowBox[{"b", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"tmpt", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmpt", "+=", 
         RowBox[{"b", "[", 
          RowBox[{"[", 
           RowBox[{"iter4", ",", "2"}], "]"}], "]"}]}], ";"}], 
       "\[IndentingNewLine]", ")"}], ",", 
      RowBox[{"{", 
       RowBox[{"iter4", ",", "4", ",", 
        RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"PrintL", "[", 
     RowBox[{
     "\"\<Sorts of Indices Needed for this External Tensor: \>\"", ",", 
      RowBox[{"extones", "+", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmpt", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"tmpt", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"tmpt", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", 
         RowBox[{"tmpt", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"extones", "+", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmpt", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"tmpt", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"tmpt", "[", 
         RowBox[{"[", "4", "]"}], "]"}], ",", 
        RowBox[{"tmpt", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FmtTens", "[", "a_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"outt", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"curt", "=", 
           RowBox[{"a", "[", 
            RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "curt", " ", "]"}], "\[GreaterEqual]", 
             "3"}], ",", 
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ttmp", "=", 
               RowBox[{"Drop", "[", 
                RowBox[{"curt", ",", "1"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"ttmp", "=", 
               RowBox[{"Flatten", "[", "ttmp", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"outt", "=", 
               RowBox[{"Append", "[", 
                RowBox[{"outt", ",", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"curt", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", "ttmp"}], 
                  "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
            
            RowBox[{"outt", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"outt", ",", "curt"}], "]"}]}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter", ",", "1", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "outt", "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContainsT", "[", 
    RowBox[{"Term_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Term", ",", "1"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"T", ",", "n"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"KillAmp", "[", 
     RowBox[{"terms_", ",", "nn_"}], "]"}], ":=", 
    RowBox[{"Select", "[", 
     RowBox[{"terms", ",", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"ContainsT", "[", 
         RowBox[{"#", ",", "nn"}], "]"}]}], "&"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ContainsL", "[", 
    RowBox[{"Term_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Term", ",", "1"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[CapitalLambda]", ",", "n"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"KillLam", "[", 
     RowBox[{"terms_", ",", "nn_"}], "]"}], ":=", 
    RowBox[{"Select", "[", 
     RowBox[{"terms", ",", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"ContainsL", "[", 
         RowBox[{"#", ",", "nn"}], "]"}]}], "&"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AreEqTensors", "[", 
    RowBox[{"dex_", ",", "dpos1_", ",", "dpos2_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"dex", "[", 
         RowBox[{"[", 
          RowBox[{"dpos1", ",", "1"}], "]"}], "]"}], "=!=", 
        RowBox[{"dex", "[", 
         RowBox[{"[", 
          RowBox[{"dpos2", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"Return", "[", "False", "]"}], ",", 
       RowBox[{
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{"Connections", "[", 
           RowBox[{"dex", ",", "dpos1"}], "]"}], "===", 
          RowBox[{"Connections", "[", 
           RowBox[{"dex", ",", "dpos2"}], "]"}]}], "]"}], ";"}]}], "]"}], 
     ";"}], "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Connections", "[", 
    RowBox[{"term_", ",", "tens_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ten", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "tens", "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"places", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Sow", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"term", ",", 
                  RowBox[{"ten", "[", 
                   RowBox[{"[", "cd", "]"}], "]"}], ",", "3"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "=!=", "tens"}], "&"}]}], 
               "]"}], "]"}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"cd", ",", "1", ",", 
            RowBox[{"Length", "[", "ten", "]"}]}], "}"}]}], "]"}], "]"}], "[",
        
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"places", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"places", ",", 
        RowBox[{
         RowBox[{"#", "=!=", 
          RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"cons", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Sow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"term", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"places", "[", 
                   RowBox[{"[", 
                    RowBox[{"iter9", ",", "1"}], "]"}], "]"}], ",", "1"}], 
                 "]"}], "]"}], ",", 
               RowBox[{"ToExpression", "[", 
                RowBox[{"StringTake", "[", 
                 RowBox[{
                  RowBox[{"ToString", "[", 
                   RowBox[{"term", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"places", "[", 
                    RowBox[{"[", "iter9", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"places", "[", 
                    RowBox[{"[", "iter9", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "]"}], 
                  ",", "1"}], "]"}], "]"}]}], "}"}], "]"}], ";"}], 
           "\[IndentingNewLine]", ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"iter9", ",", "1", ",", 
            RowBox[{"Length", "[", "places", "]"}]}], "}"}]}], "]"}], "]"}], 
       "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cons", "=", 
      RowBox[{"Sort", "[", "cons", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cons", "]"}], ";"}], "\[IndentingNewLine]", 
    ")"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Keeps", " ", "h"}], ",", 
    RowBox[{
    "p", " ", "parts", " ", "of", " ", "each", " ", "tensor", " ", "in", " ", 
     "order"}]}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"ExtInd", "[", "arg_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TmIL", "=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"IndicesOf", "[", 
        RowBox[{"LPart", "[", "arg", "]"}], "]"}], ",", 
       RowBox[{"IndicesOf", "[", 
        RowBox[{"LamPart", "[", "arg", "]"}], "]"}], ",", 
       RowBox[{"IndicesOf", "[", 
        RowBox[{"HPart", "[", "arg", "]"}], "]"}], ",", 
       RowBox[{"IndicesOf", "[", 
        RowBox[{"TPart", "[", "arg", "]"}], "]"}], ",", 
       RowBox[{"IndicesOf", "[", 
        RowBox[{"RPart", "[", "arg", "]"}], "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"ep", "[", "TmIL", "]"}], ",", 
       RowBox[{"eh", "[", "TmIL", "]"}]}], "]"}], "]"}]}], 
   "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IntInd", "[", "arg_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TmIL", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"IndicesOf", "[", 
         RowBox[{"LPart", "[", "arg", "]"}], "]"}], ",", 
        RowBox[{"IndicesOf", "[", 
         RowBox[{"LamPart", "[", "arg", "]"}], "]"}], ",", 
        RowBox[{"IndicesOf", "[", 
         RowBox[{"HPart", "[", "arg", "]"}], "]"}], ",", 
        RowBox[{"IndicesOf", "[", 
         RowBox[{"TPart", "[", "arg", "]"}], "]"}], ",", 
        RowBox[{"IndicesOf", "[", 
         RowBox[{"RPart", "[", "arg", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"ip", "[", "TmIL", "]"}], ",", 
        RowBox[{"ih", "[", "TmIL", "]"}]}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", ")"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Write", " ", "all", " ", "terms", " ", "in", " ", "terms", " ", "of", 
     " ", "the", " ", "same", " ", "external", " ", "indicies"}], ",", " ", 
    RowBox[{"Called", " ", "by", " ", "DtA"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CommonExtInd", "[", 
   RowBox[{"term_", ",", "aErank_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"termn", "=", "term"}], ";", "\[IndentingNewLine]", 
    RowBox[{"ee", "=", 
     RowBox[{"ExtInd", "[", "term", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"rrl", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ee", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "\[Rule]", 
           RowBox[{"ToExpression", "[", 
            RowBox[{
             RowBox[{"StringTake", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"ee", "[", 
                 RowBox[{"[", "iter", "]"}], "]"}], "]"}], ",", "1"}], "]"}], 
             "~~", "\"\<0\>\"", "~~", 
             RowBox[{"ToString", "[", "iter", "]"}]}], "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"termn", "=", 
         RowBox[{"termn", "/.", "rrl"}]}], ";"}], "\[IndentingNewLine]", 
       ")"}], ",", 
      RowBox[{"{", 
       RowBox[{"iter", ",", "1", ",", 
        RowBox[{"Length", "[", "ee", "]"}]}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Check", " ", "the", " ", "that", " ", "the", " ", "sign", " ", "is", 
      " ", "correct"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"sgntmp", "=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"GenerateSign", "[", 
        RowBox[{"termn", ",", "aErank"}], "]"}], "*", 
       RowBox[{"Abs", "[", 
        RowBox[{"termn", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ")"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"termn", "=", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"termn", ",", 
       RowBox[{"1", "\[Rule]", "sgntmp"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "termn", "]"}]}], "\[IndentingNewLine]", 
   ")"}]}]}], "Input",
 CellChangeTimes->{{3.396823613515625*^9, 3.396823669890625*^9}, {
   3.39682371340625*^9, 3.396823727390625*^9}, 3.3968237821875*^9, 
   3.396823846890625*^9, {3.396823995140625*^9, 3.396823997046875*^9}, {
   3.396888180140625*^9, 3.3968881910625*^9}, 3.396888248515625*^9, {
   3.3968883001875*^9, 3.396888318859375*^9}, 3.39688835715625*^9, {
   3.396888749390625*^9, 3.396888754296875*^9}, {3.39688894709375*^9, 
   3.396888961640625*^9}, {3.3968890801875*^9, 3.396889084421875*^9}, {
   3.396889219015625*^9, 3.3968893065*^9}, {3.39688988778125*^9, 
   3.396889899640625*^9}, {3.39688998065625*^9, 3.3968899904375*^9}, {
   3.39689201153125*^9, 3.396892099890625*^9}, {3.396903153453125*^9, 
   3.396903161515625*^9}, {3.396903200234375*^9, 3.396903213546875*^9}, {
   3.3969040565625*^9, 3.3969040620625*^9}, {3.396904107875*^9, 
   3.396904132609375*^9}, {3.396904216953125*^9, 3.396904224109375*^9}, {
   3.3972496471875*^9, 3.397249676796875*^9}, {3.39725032315625*^9, 
   3.3972503283125*^9}, {3.397324808328125*^9, 3.397324809234375*^9}, {
   3.39732501559375*^9, 3.397325019203125*^9}, {3.39733791159375*^9, 
   3.397337953890625*^9}, {3.397338246546875*^9, 3.397338282484375*^9}, {
   3.397338333296875*^9, 3.397338335109375*^9}, {3.39733837271875*^9, 
   3.39733837571875*^9}, {3.397919231515625*^9, 3.397919243546875*^9}, {
   3.3979207563125*^9, 3.397920766203125*^9}, {3.399838084109375*^9, 
   3.39983813665625*^9}, {3.3998381796875*^9, 3.399838218796875*^9}, {
   3.399838394484375*^9, 3.399838442390625*^9}, {3.39984382128125*^9, 
   3.399843934875*^9}, {3.399843995390625*^9, 3.399844012765625*^9}, {
   3.399847249078125*^9, 3.399847274015625*^9}, {3.3999259709374523`*^9, 
   3.3999259714598083`*^9}, {3.399928702383479*^9, 3.399928703598672*^9}, {
   3.3999289674831867`*^9, 3.399928968554368*^9}, {3.399989224965521*^9, 
   3.399989236705573*^9}, {3.3999893842197943`*^9, 3.399989402606064*^9}, 
   3.401127848136076*^9, {3.403396837189395*^9, 3.4033968442346087`*^9}, {
   3.403396882859779*^9, 3.4033969219742603`*^9}, {3.403483869188183*^9, 
   3.403483872158059*^9}, {3.4035372795451*^9, 3.403537290161599*^9}, {
   3.4035373756770372`*^9, 3.403537378874189*^9}, 3.4035374737228937`*^9, {
   3.403537505961464*^9, 3.403537529155345*^9}, {3.403537559427693*^9, 
   3.4035375920508747`*^9}, {3.403537677233509*^9, 3.403537687108399*^9}, {
   3.403537740453038*^9, 3.403537794491544*^9}, {3.403537897920054*^9, 
   3.40353790522852*^9}, {3.4035381381032467`*^9, 3.403538145027525*^9}, {
   3.403538177926937*^9, 3.403538182500771*^9}, {3.4035382262325907`*^9, 
   3.403538297178463*^9}, {3.403545563535677*^9, 3.4035455683109283`*^9}, {
   3.403545598731926*^9, 3.403545636089436*^9}, {3.403545951807014*^9, 
   3.403545958578312*^9}, {3.4036453499652863`*^9, 3.40364536729533*^9}, {
   3.403645477574685*^9, 3.403645478166224*^9}, {3.403645552357794*^9, 
   3.4036455605195417`*^9}, {3.403645720826806*^9, 3.403645732222013*^9}, {
   3.403645802650275*^9, 3.4036458611689587`*^9}, {3.4036459187669973`*^9, 
   3.4036459208975143`*^9}, {3.40364618848143*^9, 3.4036462327365837`*^9}, {
   3.403646264137108*^9, 3.403646275197228*^9}, {3.4036468703336897`*^9, 
   3.4036468794511538`*^9}, {3.4036469285635977`*^9, 3.403646941412862*^9}, {
   3.4036471208654337`*^9, 3.403647142281889*^9}, {3.403647195084146*^9, 
   3.403647204603237*^9}, {3.403647264972001*^9, 3.4036472732502003`*^9}, {
   3.403647423556439*^9, 3.403647430851387*^9}, {3.403647478263874*^9, 
   3.4036475750755787`*^9}, {3.403647702248391*^9, 3.403647755591354*^9}, {
   3.403649083478095*^9, 3.4036491125738*^9}, {3.403649193982841*^9, 
   3.4036492291232853`*^9}, {3.40364949033156*^9, 3.40364950483356*^9}, {
   3.403649535356276*^9, 3.403649564069872*^9}, {3.403649609137064*^9, 
   3.4036496312207327`*^9}, {3.4036497164104023`*^9, 
   3.4036497204070253`*^9}, {3.403649775246972*^9, 3.403649787346341*^9}, {
   3.40364984052398*^9, 3.403649860227103*^9}, {3.4036498925301456`*^9, 
   3.403649903761075*^9}, {3.403881773054974*^9, 3.403881774708075*^9}, 
   3.403881914379375*^9, 3.403882740528092*^9, {3.403893115475856*^9, 
   3.403893144453142*^9}, {3.403897133456966*^9, 3.403897137405545*^9}, {
   3.4038971958981743`*^9, 3.403897207075837*^9}, {3.404077325012662*^9, 
   3.404077326457732*^9}, {3.40407980061579*^9, 3.4040798103674793`*^9}, {
   3.404080075923127*^9, 3.404080081151263*^9}, {3.404080308262886*^9, 
   3.404080310750267*^9}, {3.40451182646875*^9, 3.404511835*^9}, {
   3.404511906421875*^9, 3.404511922*^9}, {3.405699929326681*^9, 
   3.405699930598215*^9}, {3.405700193812367*^9, 3.405700212379575*^9}, {
   3.405700309299357*^9, 3.4057003209612713`*^9}, {3.405700369151292*^9, 
   3.4057005128373747`*^9}, {3.4057005481080227`*^9, 3.405700576069292*^9}, {
   3.4057006412571907`*^9, 3.405700670578949*^9}, {3.40570070261168*^9, 
   3.4057007659689407`*^9}, {3.4057007986598263`*^9, 3.405700836204589*^9}, {
   3.405700870152883*^9, 3.4057008707998238`*^9}, {3.4057009956158*^9, 
   3.405701004657899*^9}, {3.405707049883151*^9, 3.405707096735783*^9}, {
   3.405707175595107*^9, 3.405707176853654*^9}, {3.4057072431288424`*^9, 
   3.405707245686083*^9}, 3.4057073377723017`*^9, {3.405707736291357*^9, 
   3.405707751834868*^9}, {3.405707831044675*^9, 3.405707844487989*^9}, {
   3.4057078910699787`*^9, 3.405707891467514*^9}, {3.405708096031473*^9, 
   3.405708119635248*^9}, {3.405708286203958*^9, 3.4057082870201178`*^9}, {
   3.4057083563079557`*^9, 3.405708421669735*^9}, {3.4057085172351723`*^9, 
   3.40570858961018*^9}, {3.405708634633215*^9, 3.405708751369076*^9}, {
   3.405708977113165*^9, 3.405708977588668*^9}, {3.4057092031320753`*^9, 
   3.405709212900281*^9}, {3.405710008201563*^9, 3.405710046068658*^9}, {
   3.405710952665523*^9, 3.4057109528828773`*^9}, {3.4057110158659563`*^9, 
   3.405711088861658*^9}, {3.405711161392744*^9, 3.405711165664505*^9}, {
   3.405711197132423*^9, 3.4057111975807323`*^9}, {3.405977580765245*^9, 
   3.405977610174144*^9}, {3.405977649238529*^9, 3.405977737697926*^9}, {
   3.410390332607977*^9, 3.410390391996509*^9}, {3.410390539867077*^9, 
   3.410390552932106*^9}, 3.410467672390223*^9, {3.410472567889922*^9, 
   3.410472576825416*^9}, {3.410473338712474*^9, 3.4104733545953293`*^9}, {
   3.4104735284695063`*^9, 3.410473553607463*^9}, {3.410473607490807*^9, 
   3.410473613683062*^9}, {3.411148229166559*^9, 3.411148250238633*^9}, {
   3.4111488160595427`*^9, 3.411148851055991*^9}, {3.411148927748364*^9, 
   3.4111489305385113`*^9}, {3.411149002983614*^9, 3.411149055198639*^9}, {
   3.411149610674507*^9, 3.411149610874346*^9}, {3.411149667095641*^9, 
   3.411149674972251*^9}, {3.411149713006014*^9, 3.411149750561336*^9}, {
   3.411149821727936*^9, 3.4111499043315487`*^9}, {3.411149934403462*^9, 
   3.411149967150488*^9}, {3.411150011741239*^9, 3.411150040818973*^9}, {
   3.4111509673526707`*^9, 3.411151036690014*^9}, {3.4111510915102053`*^9, 
   3.411151122670619*^9}, {3.411156165512632*^9, 3.411156270467566*^9}, {
   3.411156481986785*^9, 3.411156519176382*^9}, {3.4111566069718237`*^9, 
   3.4111566412032747`*^9}, {3.411156689155098*^9, 3.411156691576831*^9}, {
   3.411156967558132*^9, 3.4111569937721243`*^9}, {3.41115716149263*^9, 
   3.411157162220647*^9}, {3.41115724903078*^9, 3.411157335480977*^9}, {
   3.411157412534978*^9, 3.411157415157589*^9}, {3.4111574509067593`*^9, 
   3.411157488937312*^9}, {3.411157524446889*^9, 3.4111575705668173`*^9}, {
   3.411157945045602*^9, 3.411157946919559*^9}, {3.411158354401991*^9, 
   3.4111583548943987`*^9}, {3.411158529103119*^9, 3.4111585518452463`*^9}, {
   3.412015589234962*^9, 3.4120156374592113`*^9}, {3.412022897854487*^9, 
   3.412022937438044*^9}, {3.412023047178959*^9, 3.412023069390806*^9}, {
   3.4120248259595737`*^9, 3.4120248348781033`*^9}, {3.412027732616905*^9, 
   3.412027738784594*^9}, {3.412030169446066*^9, 3.412030169974407*^9}, {
   3.416238344776698*^9, 3.41623834633123*^9}, {3.416238685098727*^9, 
   3.416238695003551*^9}, {3.41623957574851*^9, 3.4162395876554317`*^9}, {
   3.417128191692889*^9, 3.41712822421072*^9}, {3.417128690787355*^9, 
   3.417128724616335*^9}, {3.4172200038977413`*^9, 3.417220009718792*^9}, 
   3.417222563274088*^9, {3.417222606748822*^9, 3.417222607780714*^9}, {
   3.4172285777787237`*^9, 3.417228626930544*^9}, {3.420389072512586*^9, 
   3.420389083962409*^9}, {3.4203891830984793`*^9, 3.420389185481976*^9}, {
   3.4203893213107853`*^9, 3.420389411883133*^9}, {3.420389983358493*^9, 
   3.420390002790736*^9}, {3.42039008270138*^9, 3.4203901016983633`*^9}, {
   3.420390160545529*^9, 3.420390165714264*^9}, {3.420390438442981*^9, 
   3.420390439125614*^9}, {3.42039082643371*^9, 3.420390831045978*^9}, {
   3.4203912279132357`*^9, 3.4203913766347427`*^9}, {3.420391409195532*^9, 
   3.4203914799309473`*^9}, {3.420391518586904*^9, 3.4203915219614697`*^9}, {
   3.420391589743042*^9, 3.4203916713866673`*^9}, {3.420394101739246*^9, 
   3.420394107859901*^9}, {3.420394143492976*^9, 3.420394198545992*^9}, {
   3.420394236002458*^9, 3.420394237815737*^9}, {3.4203969113952217`*^9, 
   3.42039691240661*^9}, {3.425718611114819*^9, 3.425718644711918*^9}, {
   3.4257188885215063`*^9, 3.425718891523868*^9}, {3.425718921847787*^9, 
   3.425718922729467*^9}, {3.426284968318019*^9, 3.4262849891566467`*^9}, {
   3.42699058051329*^9, 3.426990583447652*^9}, {3.427406610499749*^9, 
   3.4274066110064983`*^9}, {3.427476584574972*^9, 3.427476595595582*^9}, {
   3.427746558596292*^9, 3.427746564708715*^9}, {3.428427026631349*^9, 
   3.428427072170594*^9}, 3.4284341800386963`*^9, 3.4319810779159517`*^9, {
   3.4364078456691523`*^9, 3.436407848694742*^9}, {3.436833058561461*^9, 
   3.436833081349061*^9}, {3.4368352519987297`*^9, 3.436835262392692*^9}, {
   3.4368392333479557`*^9, 3.436839236837565*^9}, {3.436839398140394*^9, 
   3.436839403179764*^9}, 3.436890119020306*^9, {3.4368902111069937`*^9, 
   3.436890235756588*^9}, {3.436892047690034*^9, 3.436892051991372*^9}, {
   3.436892127801126*^9, 3.436892165362611*^9}, {3.43697659990521*^9, 
   3.436976602853516*^9}, {3.436976669898233*^9, 3.43697672767152*^9}, {
   3.436980789622138*^9, 3.436980793151698*^9}, {3.4369817672640553`*^9, 
   3.436981802353971*^9}, {3.4369819617686777`*^9, 3.436982033626233*^9}, {
   3.436982109673484*^9, 3.436982162142928*^9}, {3.437016817354286*^9, 
   3.437016824345673*^9}, {3.4370180686525307`*^9, 3.437018075263728*^9}, {
   3.437018226847034*^9, 3.4370182734067917`*^9}, 3.437019055679356*^9, {
   3.448460270333004*^9, 3.4484602713565273`*^9}, {3.448464874250526*^9, 
   3.4484648796907797`*^9}, {3.448465026716502*^9, 3.448465102756193*^9}, {
   3.448465279104784*^9, 3.448465291412184*^9}, {3.448466979328113*^9, 
   3.448467017875588*^9}, {3.448480126822968*^9, 3.4484801731504297`*^9}, {
   3.448480289060155*^9, 3.448480298389621*^9}, {3.4484803369374447`*^9, 
   3.448480373030064*^9}, {3.448480422738291*^9, 3.448480433130971*^9}, {
   3.448480529063501*^9, 3.4484805926723413`*^9}, {3.448480692579238*^9, 
   3.4484807440733147`*^9}, {3.448480783577586*^9, 3.4484807884012003`*^9}, {
   3.448480882696432*^9, 3.448480883274876*^9}, 3.4484809699188423`*^9, {
   3.448481009328279*^9, 3.448481038040433*^9}, {3.448481069115493*^9, 
   3.448481105083222*^9}, {3.4484811886789207`*^9, 3.4484812919058332`*^9}, {
   3.448837459901801*^9, 3.448837510125372*^9}, {3.448837586749936*^9, 
   3.448837622898633*^9}, {3.448837686489032*^9, 3.448837739422707*^9}, {
   3.448837788286799*^9, 3.448837802082967*^9}, {3.448837881089946*^9, 
   3.4488378885865583`*^9}, {3.448901463520268*^9, 3.4489014648689213`*^9}, 
   3.4489128347207537`*^9, {3.448912897108466*^9, 3.4489129039289093`*^9}, {
   3.4489137149977617`*^9, 3.448913775425108*^9}, {3.44891381465308*^9, 
   3.448913818890184*^9}, {3.448913855736833*^9, 3.448913883801992*^9}, {
   3.448914612739105*^9, 3.448914628947419*^9}, 3.4489146609291983`*^9, {
   3.4489147172804613`*^9, 3.4489148106788282`*^9}, {3.4489167347910337`*^9, 
   3.448916748576832*^9}, {3.448917554832797*^9, 3.448917566371834*^9}, {
   3.4501010095062227`*^9, 3.450101018054041*^9}, {3.450101178721292*^9, 
   3.4501012680465803`*^9}, {3.450101307965701*^9, 3.450101312069405*^9}, {
   3.450101364467086*^9, 3.450101445502684*^9}, {3.450115861718863*^9, 
   3.450115877391573*^9}, {3.45012472169561*^9, 3.450124737584343*^9}, {
   3.450141140228129*^9, 3.450141179406279*^9}, {3.450143996731289*^9, 
   3.4501440873823223`*^9}, {3.4501490289730043`*^9, 3.450149040999443*^9}, {
   3.4501491360006227`*^9, 3.450149242071827*^9}, {3.4501492773671007`*^9, 
   3.45014941242491*^9}, {3.450149493056826*^9, 3.45014955109791*^9}, {
   3.450149589956173*^9, 3.450149670535475*^9}, {3.450149728000516*^9, 
   3.4501497389635353`*^9}, {3.4502056052045593`*^9, 3.450205699050864*^9}, {
   3.450205766409371*^9, 3.450205860143217*^9}, {3.450409206739869*^9, 
   3.450409254796505*^9}, {3.450409337623363*^9, 3.450409338902329*^9}, {
   3.450409595429549*^9, 3.450409596762982*^9}, {3.450409832634057*^9, 
   3.4504099366034*^9}, {3.4504393841976423`*^9, 3.45043938506324*^9}, {
   3.450439489650777*^9, 3.450439529773967*^9}, {3.4504395647334967`*^9, 
   3.4504396691943073`*^9}, {3.450439699234439*^9, 3.4504397025589027`*^9}, {
   3.450468354171413*^9, 3.45046835562881*^9}, {3.45046902921025*^9, 
   3.4504690310164003`*^9}, {3.450469989833044*^9, 3.450469991070022*^9}, {
   3.451520388701003*^9, 3.4515203902359943`*^9}, {3.451520606529875*^9, 
   3.4515206492550364`*^9}, {3.451520680449897*^9, 3.4515206883844957`*^9}, {
   3.451520885315634*^9, 3.451520935930572*^9}, {3.451520980788331*^9, 
   3.451520989786748*^9}, {3.451521045061398*^9, 3.4515210783638678`*^9}, {
   3.451521142452546*^9, 3.451521157586008*^9}, {3.451521190153906*^9, 
   3.451521192236665*^9}, {3.451521255918017*^9, 3.451521290825368*^9}, {
   3.4515346544309387`*^9, 3.451534717923677*^9}, {3.451534763182232*^9, 
   3.451534819929598*^9}, {3.45159244140779*^9, 3.451592463655506*^9}, {
   3.4516199121283627`*^9, 3.451619921804102*^9}, {3.451619952104904*^9, 
   3.45161995312576*^9}, {3.452006909283366*^9, 3.452006915586925*^9}, {
   3.4520073401987953`*^9, 3.452007356728875*^9}, {3.452272026453322*^9, 
   3.45227203871623*^9}, {3.452272227197472*^9, 3.452272261101996*^9}, {
   3.452272326511663*^9, 3.452272468976108*^9}, {3.452272518105797*^9, 
   3.45227260348523*^9}, 3.459730490675763*^9, {3.459730554427883*^9, 
   3.459730580201565*^9}, {3.459730651683506*^9, 3.459730652596786*^9}, {
   3.4667934010981283`*^9, 3.466793416270207*^9}, {3.466797138568091*^9, 
   3.466797140144112*^9}, 3.4667980473361607`*^9, {3.467166465837484*^9, 
   3.467166479240382*^9}, {3.467167520821397*^9, 3.46716754790131*^9}, {
   3.4681231768062067`*^9, 3.46812318922561*^9}, {3.468123225969467*^9, 
   3.468123317216854*^9}, {3.46812349367682*^9, 3.468123525039178*^9}, {
   3.468123561566058*^9, 3.4681235938661203`*^9}, {3.4681575171086807`*^9, 
   3.468157531939847*^9}, {3.468157742810708*^9, 3.468157743399342*^9}, {
   3.4681578210518923`*^9, 3.468157826981529*^9}, {3.4688757099694633`*^9, 
   3.468875710672345*^9}, {3.468875774277194*^9, 3.468875774583487*^9}, {
   3.468875817923208*^9, 3.468875826589697*^9}, {3.4688788593747263`*^9, 
   3.4688788756223373`*^9}, {3.468879354268003*^9, 3.4688793878264313`*^9}, {
   3.468879424497511*^9, 3.4688794360083227`*^9}, {3.4688795006599283`*^9, 
   3.468879545697537*^9}, {3.468879746656137*^9, 3.468879840521433*^9}, {
   3.468879874630535*^9, 3.468879979275237*^9}, {3.468880065242847*^9, 
   3.468880175700533*^9}, {3.4688802368572598`*^9, 3.4688802670494432`*^9}, {
   3.468882299202567*^9, 3.46888232114145*^9}, {3.468882741496585*^9, 
   3.468882743448636*^9}, {3.469025668523658*^9, 3.469025678051137*^9}, {
   3.4690257312060127`*^9, 3.469025741155488*^9}, {3.469025777417677*^9, 
   3.469025808753346*^9}, {3.469025850275556*^9, 3.46902585083969*^9}, {
   3.469027992825384*^9, 3.4690280048536177`*^9}, 3.470054028113093*^9, {
   3.47005966793976*^9, 3.470059671433172*^9}, 3.470059706370988*^9, {
   3.472330751159631*^9, 3.4723308604885273`*^9}, {3.472331069454108*^9, 
   3.472331089900415*^9}, {3.472331126644246*^9, 3.47233112988972*^9}, {
   3.4723312058740883`*^9, 3.472331212419982*^9}, {3.473382434174746*^9, 
   3.473382458948413*^9}, {3.473383818128628*^9, 3.47338382177603*^9}, {
   3.4733838719275827`*^9, 3.4733838742985086`*^9}, {3.4735379466467323`*^9, 
   3.4735379816465387`*^9}, {3.473538043087381*^9, 3.473538294662716*^9}, {
   3.473539622801433*^9, 3.473539688970915*^9}, {3.473539921341514*^9, 
   3.473539935130056*^9}, {3.473540124360606*^9, 3.473540135930595*^9}, {
   3.473540219513834*^9, 3.473540227078331*^9}, {3.473540277568605*^9, 
   3.473540278125492*^9}, {3.473540481209057*^9, 3.473540491842269*^9}, {
   3.473862244140644*^9, 3.473862293246009*^9}, {3.473863222393045*^9, 
   3.473863264532119*^9}, {3.47386339242894*^9, 3.4738634300829372`*^9}, {
   3.473863555102734*^9, 3.4738635588013277`*^9}, {3.474221101208206*^9, 
   3.474221116528419*^9}, {3.474223459211547*^9, 3.474223468449463*^9}, {
   3.4742234987137012`*^9, 3.474223516385212*^9}, {3.4742235816222057`*^9, 
   3.474223587243082*^9}, 3.474223664039843*^9, {3.4742314568413887`*^9, 
   3.4742314577710333`*^9}, {3.474256252277961*^9, 3.4742562982080917`*^9}, {
   3.4742565368194513`*^9, 3.474256543487121*^9}, {3.474256925999487*^9, 
   3.4742569590643177`*^9}, {3.474256993208268*^9, 3.474257066557118*^9}, {
   3.474296490737341*^9, 3.4742965377178097`*^9}, 3.474296580083406*^9, {
   3.474296758332809*^9, 3.474296767930235*^9}, {3.474297799202931*^9, 
   3.47429780776448*^9}, 3.474298558466139*^9, {3.47430070607644*^9, 
   3.4743007228058434`*^9}, {3.474308617636092*^9, 3.474308628071103*^9}, {
   3.474309261408236*^9, 3.4743092973419657`*^9}, {3.4743094815712547`*^9, 
   3.474309514885797*^9}, {3.4743336829107018`*^9, 3.4743337227256603`*^9}, {
   3.474333787665043*^9, 3.474333791249354*^9}, {3.474333822894784*^9, 
   3.4743338326852493`*^9}, {3.474337089657151*^9, 3.474337103377007*^9}, {
   3.474337280481444*^9, 3.474337287432372*^9}, {3.4743844346093082`*^9, 
   3.47438444748002*^9}, 3.474384603668701*^9, {3.474385174587366*^9, 
   3.4743852200150013`*^9}, {3.474385302879064*^9, 3.474385392360505*^9}, 
   3.474400255475951*^9, {3.482517637382996*^9, 3.482517653165097*^9}, 
   3.485435934624464*^9, 3.4854770792230186`*^9, {3.4854772274849052`*^9, 
   3.485477323088087*^9}, 3.4854773564581947`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Plans contractions", "Section",
 CellChangeTimes->{{3.416606294940753*^9, 3.416606321099419*^9}, {
   3.4166063676289577`*^9, 3.416606403593831*^9}, {3.41660671062045*^9, 
   3.4166067107876863`*^9}, 3.4166068536951857`*^9, {3.416607266141217*^9, 
   3.416607267283771*^9}, 3.428434229037046*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Default", " ", "is", " ", "contractions", " ", "done", " ", "in", " ", 
      "order", " ", "of", " ", "ascending", " ", "scaling", " ", 
      RowBox[{"(", "nonsparse", ")"}], " ", "FactorizationType"}], "=", "0"}],
     ";", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Another", " ", "option", " ", "is", " ", "fewest", " ", "number", " ", 
       "of", " ", "external", " ", "indices", " ", "for", " ", "high"}], "-", 
      
      RowBox[{"rank", " ", 
       RowBox[{"multipliers", ".", " ", "Set"}], " ", "FactorizationType"}]}],
      "=", "1"}], ";"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MapToInts", "[", "a_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"domain", "=", 
       RowBox[{"Flatten", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"range", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rrl", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"rrl", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"rrl", ",", 
           RowBox[{
            RowBox[{"domain", "[", 
             RowBox[{"[", "it", "]"}], "]"}], "\[Rule]", 
            RowBox[{"range", "[", 
             RowBox[{"[", "it", "]"}], "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"it", ",", "1", ",", 
          RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"a", "//.", "rrl"}], "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MapBack", "[", "num_", "]"}], ":=", 
     RowBox[{"Extract", "[", 
      RowBox[{"domain", ",", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"range", ",", "num"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MapFromInts", "[", 
     RowBox[{"tomap_", ",", "key_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"domain", "=", 
       RowBox[{"Flatten", "[", "key", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"range", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MapBack", "[", "#", "]"}], "&"}], ",", "tomap"}], "]"}]}], 
     "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Indices", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Drop", "[", 
         RowBox[{"ten1", ",", "1"}], "]"}], ",", 
        RowBox[{"Drop", "[", 
         RowBox[{"ten2", ",", "1"}], "]"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RIndices", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"Intersection", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Drop", "[", 
          RowBox[{"ten1", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Drop", "[", 
          RowBox[{"ten2", ",", "1"}], "]"}], "]"}]}], "]"}], ")"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RIndices", "[", "ten1_", "]"}], ":=", 
     RowBox[{"Print", "[", "\"\<Mis-Called RIndices\>\"", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NRIndices", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Indices", "[", 
         RowBox[{"ten1", ",", "ten2"}], "]"}], ",", 
        RowBox[{"RIndices", "[", 
         RowBox[{"ten1", ",", "ten2"}], "]"}]}], "]"}], ")"}]}], ";", 
    RowBox[{
     RowBox[{"NumExtDims", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ten1", "=!=", "ten2"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"NRIndices", "[", 
         RowBox[{"ten1", ",", "ten2"}], "]"}], "]"}], ",", "10000"}], "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NumCon", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ten1", "=!=", "ten2"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"RIndices", "[", 
            RowBox[{"ten1", ",", "ten2"}], "]"}], "]"}], "\[NotEqual]", "0"}],
          ",", 
         RowBox[{"Length", "[", 
          RowBox[{"RIndices", "[", 
           RowBox[{"ten1", ",", "ten2"}], "]"}], "]"}], ",", "10000"}], "]"}],
        ",", "10000"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ScalingOfPairwiseContraction", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NumCon", "[", 
         RowBox[{"ten1", ",", "ten2"}], "]"}], ")"}], " ", "+", " ", 
       RowBox[{"(", 
        RowBox[{"NumExtDims", "[", 
         RowBox[{"ten1", ",", "ten2"}], "]"}], ")"}]}], ")"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExternalDimensionsOnIntermediate", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ten1", "=!=", "ten2"}], ",", 
       RowBox[{"NumExtDims", "[", 
        RowBox[{"ten1", ",", "ten2"}], "]"}], ",", "10000"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SharedIndices", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ten1", "=!=", "ten2"}], ",", 
       RowBox[{"NumCon", "[", 
        RowBox[{"ten1", ",", "ten2"}], "]"}], ",", "0"}], "]"}]}], ";"}], " ",
    "\n", 
   RowBox[{
    RowBox[{"IsR", "[", "args_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", "args", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "===", "R"}], ",", "True", ",", 
        "False"}], "]"}], "]"}], "\[IndentingNewLine]", ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IsH", "[", "args_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", "args", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "===", "Fn"}], " ", "||", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", "args", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "===", "Vn"}]}], " ", ",", "True", 
        ",", "False"}], "]"}], "]"}], "\[IndentingNewLine]", ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HRLast", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ten1", "=!=", "ten2"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"IsR", "[", "ten1", "]"}], "||", 
           RowBox[{"IsR", "[", "ten2", "]"}]}], ")"}], ",", "100", ",", 
         RowBox[{"ScalingOfPairwiseContraction", "[", 
          RowBox[{"ten1", ",", "ten2"}], "]"}]}], "]"}], ",", "10000"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HRFirst", "[", 
      RowBox[{"ten1_", ",", "ten2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ten1", "=!=", "ten2"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"IsR", "[", "ten1", "]"}], " ", "&&", " ", 
             RowBox[{"IsH", "[", "ten2", "]"}]}], ")"}], "||", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"IsR", "[", "ten2", "]"}], " ", "&&", " ", 
             RowBox[{"IsH", "[", "ten1", "]"}]}], ")"}]}], ")"}], ",", 
         RowBox[{"-", "10"}], ",", 
         RowBox[{"ScalingOfPairwiseContraction", "[", 
          RowBox[{"ten1", ",", "ten2"}], "]"}]}], "]"}], ",", "10000"}], 
      "]"}]}], ";"}], " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RepWInt", "[", 
      RowBox[{"tens_", ",", "ten1_", ",", "ten2_", ",", "intr_"}], "]"}], ":=",
      
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tenso", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"tens", ",", 
          RowBox[{"ten1", "|", "ten2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"intro", "=", 
        RowBox[{"Append", "[", 
         RowBox[{"intr", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{"In", ",", "inter"}], "}"}], "}"}], ",", 
              RowBox[{"NRIndices", "[", 
               RowBox[{"ten1", ",", "ten2"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"\"\<Defn:\>\"", ",", "ten1", ",", "ten2"}], "}"}]}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tenso", "=", 
        RowBox[{"Append", "[", 
         RowBox[{"tenso", ",", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"In", ",", "inter"}], "}"}], "}"}], ",", 
            RowBox[{"NRIndices", "[", 
             RowBox[{"ten1", ",", "ten2"}], "]"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"inter", "++"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"tenso", ",", "intro"}], "}"}], "]"}], ";"}], 
      "\[IndentingNewLine]", ")"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "For", " ", "some", " ", "reason", " ", "I", " ", "reversed", " ", "the",
       " ", "order", " ", "of", " ", "T"}], ",", "R", ",", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"L", "?"}], ")"}], " ", "in", " ", "diagrams", " ", "and", 
        " ", "code"}], "..."}], " ", "switch", " ", "to", " ", "OOVV"}]}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ReorderT", "[", "args_", "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmpw", "=", "args"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{
               RowBox[{"tmpw", "[", 
                RowBox[{"[", "te", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"T", ",", "_"}], "}"}], ",", "r___"}], "}"}]}], 
              "]"}], ",", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"tmpw", "[", 
                 RowBox[{"[", "te", "]"}], "]"}], " ", "=", " ", 
                RowBox[{"Prepend", "[", 
                 RowBox[{
                  RowBox[{"Swap", "[", 
                   RowBox[{"Drop", "[", 
                    RowBox[{
                    RowBox[{"tmpw", "[", 
                    RowBox[{"[", "te", "]"}], "]"}], ",", "1"}], "]"}], "]"}],
                   ",", 
                  RowBox[{"tmpw", "[", 
                   RowBox[{"[", 
                    RowBox[{"te", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}], 
              ")"}]}], "]"}], ";"}], ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"te", ",", "1", ",", 
           RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{
               RowBox[{"tmpw", "[", 
                RowBox[{"[", "te", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"R", ",", "_"}], "}"}], ",", "r___"}], "}"}]}], 
              "]"}], ",", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"tmpw", "[", 
                 RowBox[{"[", "te", "]"}], "]"}], " ", "=", " ", 
                RowBox[{"Prepend", "[", 
                 RowBox[{
                  RowBox[{"Swap", "[", 
                   RowBox[{"Drop", "[", 
                    RowBox[{
                    RowBox[{"tmpw", "[", 
                    RowBox[{"[", "te", "]"}], "]"}], ",", "1"}], "]"}], "]"}],
                   ",", 
                  RowBox[{"tmpw", "[", 
                   RowBox[{"[", 
                    RowBox[{"te", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}], 
              ")"}]}], "]"}], ";"}], ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"te", ",", "1", ",", 
           RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}], ";", 
       RowBox[{"Return", "[", "tmpw", "]"}], ";"}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"Swap", "[", "lis_", "]"}], ":=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"iter", " ", ">", " ", 
         RowBox[{
          RowBox[{"Length", "[", "lis", "]"}], "/", "2"}]}], ",", 
        RowBox[{"lis", "[", 
         RowBox[{"[", 
          RowBox[{"iter", "-", 
           RowBox[{
            RowBox[{"Length", "[", "lis", "]"}], "/", "2"}]}], "]"}], "]"}], 
        ",", 
        RowBox[{"lis", "[", 
         RowBox[{"[", 
          RowBox[{"iter", "+", 
           RowBox[{
            RowBox[{"Length", "[", "lis", "]"}], "/", "2"}]}], "]"}], "]"}]}],
        "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"iter", ",", "1", ",", 
        RowBox[{"Length", "[", "lis", "]"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FactorizationType", " ", "=", " ", "0"}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"FactorizationType", " ", "=", "3"}], ";", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"This", " ", "one", " ", "Makes", " ", "H"}], "-", 
       RowBox[{
       "R", " ", "Contractions", " ", "first", " ", "and", " ", "is", " ", 
        "otherwise", " ", "Like", " ", "FactorizationType"}]}], "=", "0"}]}], 
    "*)"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"SerialCont", "[", "a_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "a", "]"}], "<", " ", "4"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ReorderT", "[", 
          RowBox[{"Drop", "[", 
           RowBox[{"a", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numtens", "=", 
       RowBox[{
        RowBox[{"Length", "[", "a", "]"}], "-", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tens", "=", 
       RowBox[{"Drop", "[", 
        RowBox[{"a", ",", "1"}], "]"}]}], ";", "\n", "   ", 
      RowBox[{"(*", 
       RowBox[{
       "Reorder", " ", "T", " ", "since", " ", "code", " ", "for", " ", "T", 
        " ", "is", " ", "OOVV", " ", "not", " ", "VVOO"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"tens", " ", "=", " ", 
       RowBox[{"ReorderT", "[", "tens", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"FactorizationType", "\[Equal]", "0"}], ",", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ctable2", " ", "=", " ", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ScalingOfPairwiseContraction", "[", 
              RowBox[{
               RowBox[{"tens", "[", 
                RowBox[{"[", "iter1", "]"}], "]"}], ",", 
               RowBox[{"tens", "[", 
                RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"iter2", ",", "1", ",", 
               RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"iter1", ",", "1", ",", 
               RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"firstcont", "=", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"ctable2", ",", 
              RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
         ")"}], ",", 
        RowBox[{"If", " ", "[", 
         RowBox[{
          RowBox[{"FactorizationType", "\[Equal]", "1"}], ",", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ctable2", " ", "=", " ", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"SharedIndices", "[", 
                RowBox[{
                 RowBox[{"tens", "[", 
                  RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                 RowBox[{"tens", "[", 
                  RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"iter2", ",", "1", ",", 
                 RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"iter1", ",", "1", ",", 
                 RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"firstcont", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ctable2", ",", 
                RowBox[{"Max", "[", "ctable2", "]"}]}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
           ")"}], ",", 
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{"FactorizationType", "\[Equal]", "2"}], ",", 
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ctable2", " ", "=", " ", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"ExternalDimensionsOnIntermediate", "[", 
                  RowBox[{
                   RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                   RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"iter2", ",", "1", ",", 
                   RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"iter1", ",", "1", ",", 
                   RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"firstcont", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"ctable2", ",", 
                  RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
             "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"If", " ", "[", 
             RowBox[{
              RowBox[{"FactorizationType", "\[Equal]", "3"}], ",", 
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ctable2", " ", "=", " ", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"HRFirst", "[", 
                    RowBox[{
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter1", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"firstcont", "=", 
                 RowBox[{
                  RowBox[{"Position", "[", 
                   RowBox[{"ctable2", ",", 
                    RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"If", " ", "[", 
               RowBox[{
                RowBox[{"FactorizationType", "\[Equal]", "4"}], ",", 
                RowBox[{"(", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"ctable2", " ", "=", " ", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"HRLast", "[", 
                    RowBox[{
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter1", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
                  ";", "\[IndentingNewLine]", 
                  RowBox[{"firstcont", "=", 
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ctable2", ",", 
                    RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
                 "\[IndentingNewLine]", ")"}]}], "]"}]}], "]"}]}], "]"}]}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"RepWInt", "[", 
        RowBox[{"tens", ",", 
         RowBox[{"tens", "[", 
          RowBox[{"[", 
           RowBox[{"firstcont", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"tens", "[", 
          RowBox[{"[", 
           RowBox[{"firstcont", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "interms"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tens", "=", 
       RowBox[{"tmp", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"interms", "=", 
       RowBox[{"tmp", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "tens", "]"}], ">", "2"}], ",", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{"FactorizationType", "\[Equal]", "0"}], ",", 
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ctable2", " ", "=", " ", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"ScalingOfPairwiseContraction", "[", 
                  RowBox[{
                   RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                   RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"iter2", ",", "1", ",", 
                   RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"iter1", ",", "1", ",", 
                   RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"cont", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"ctable2", ",", 
                  RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
             "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"If", " ", "[", 
             RowBox[{
              RowBox[{"FactorizationType", "\[Equal]", "1"}], ",", 
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ctable2", " ", "=", " ", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"SharedIndices", "[", 
                    RowBox[{
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"iter1", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"cont", "=", 
                 RowBox[{
                  RowBox[{"Position", "[", 
                   RowBox[{"ctable2", ",", 
                    RowBox[{"Max", "[", "ctable2", "]"}]}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
               "\[IndentingNewLine]", ")"}], ",", 
              RowBox[{"If", " ", "[", 
               RowBox[{
                RowBox[{"FactorizationType", "\[Equal]", "2"}], ",", 
                RowBox[{"(", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"ctable2", " ", "=", " ", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"ExternalDimensionsOnIntermediate", "[", 
                    RowBox[{
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter1", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
                  ";", "\[IndentingNewLine]", 
                  RowBox[{"cont", "=", 
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ctable2", ",", 
                    RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
                 "\[IndentingNewLine]", ")"}], ",", 
                RowBox[{"If", " ", "[", 
                 RowBox[{
                  RowBox[{"FactorizationType", "\[Equal]", "3"}], ",", 
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"ctable2", " ", "=", " ", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"HRFirst", "[", 
                    RowBox[{
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter1", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"cont", "=", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ctable2", ",", 
                    RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ",", 
                  RowBox[{"If", " ", "[", 
                   RowBox[{
                    RowBox[{"FactorizationType", "\[Equal]", "4"}], ",", 
                    RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ctable2", " ", "=", " ", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"HRLast", "[", 
                    RowBox[{
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter1", "]"}], "]"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{"[", "iter2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter2", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"iter1", ",", "1", ",", 
                    RowBox[{"Length", "[", "tens", "]"}]}], "}"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"cont", "=", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ctable2", ",", 
                    RowBox[{"Min", "[", "ctable2", "]"}]}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
                    "\[IndentingNewLine]", ")"}], ","}], "]"}]}], "]"}]}], 
               "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"RepWInt", "[", 
            RowBox[{"tens", ",", 
             RowBox[{"tens", "[", 
              RowBox[{"[", 
               RowBox[{"cont", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"tens", "[", 
              RowBox[{"[", 
               RowBox[{"cont", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
             "interms"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tens", "=", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"interms", "=", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
         ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "tens", "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"scaling", "[", "at_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", "=", "at"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<O - \>\"", ",", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ih", "[", "a", "]"}], "]"}], "+", 
         RowBox[{"Length", "[", 
          RowBox[{"eh", "[", "a", "]"}], "]"}]}], ",", "\"\< V - \>\"", ",", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ip", "[", "a", "]"}], "]"}], "+", 
         RowBox[{"Length", "[", 
          RowBox[{"ep", "[", "a", "]"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"ih", "[", "a", "]"}], "]"}], "+", 
        RowBox[{"Length", "[", 
         RowBox[{"eh", "[", "a", "]"}], "]"}], "+", 
        RowBox[{"Length", "[", 
         RowBox[{"ip", "[", "a", "]"}], "]"}], "+", 
        RowBox[{"Length", "[", 
         RowBox[{"ep", "[", "a", "]"}], "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PlanContr", "[", 
     RowBox[{"a_", ",", "interstart_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{"interms", ",", "inter"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"interms", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"a", " ", "list", " ", "of", " ", "intermediates", " ", 
        RowBox[{"generated", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"inter", "=", "interstart"}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"inter", "=", "1"}], ";"}], "*)"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Allows", " ", "the", " ", "Intermediates", " ", "to", " ", "all", 
         " ", "have", " ", "different", " ", "names"}], "..."}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"terms", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"SerialCont", ",", "a"}], "]"}]}], ";", "\[IndentingNewLine]",
       
      RowBox[{"TermFactors", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Part", "[", 
           RowBox[{"#", ",", "1"}], "]"}], "&"}], ",", "a"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "\"\<Terms:\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"terms", "//", "MatrixForm"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "\"\<Scaling of Terms:\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"scaling", ",", "terms"}], "]"}], "//", "MatrixForm"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "\"\<Intermediates:\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"interms", "//", "MatrixForm"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "\"\<Scaling of Intermediates: \>\"", "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"scaling", ",", "interms"}], "]"}], "//", "MatrixForm"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "\"\<factors: \>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"TermFactors", "//", "MatrixForm"}], "]"}], ";"}], 
     "\[IndentingNewLine]", ")"}]}]}]}]], "Input",
 CellChangeTimes->{{3.3999894739131117`*^9, 3.399989496576932*^9}, {
   3.399989547157402*^9, 3.399989723835153*^9}, {3.3999898052460814`*^9, 
   3.399989809743441*^9}, {3.399989852797172*^9, 3.3999901712197866`*^9}, {
   3.399990807174759*^9, 3.399990829979966*^9}, {3.399990887355914*^9, 
   3.399990940756794*^9}, {3.3999909827692003`*^9, 3.3999912516958513`*^9}, {
   3.399991288119652*^9, 3.399991372720319*^9}, {3.399992166697528*^9, 
   3.399992225698773*^9}, {3.399992297205635*^9, 3.3999923079544897`*^9}, {
   3.399992364172079*^9, 3.3999923711551743`*^9}, {3.399992414125177*^9, 
   3.3999924751066523`*^9}, {3.3999926487717943`*^9, 3.399992740403697*^9}, {
   3.399992779165043*^9, 3.399992791636876*^9}, {3.3999928373115664`*^9, 
   3.399993003717416*^9}, {3.3999930626314583`*^9, 3.399993119222066*^9}, {
   3.399993595079074*^9, 3.399993645269552*^9}, {3.399993698119978*^9, 
   3.399993700973577*^9}, 3.3999937372001534`*^9, {3.3999937693819838`*^9, 
   3.399993863342898*^9}, {3.399993958360806*^9, 3.399994100768208*^9}, {
   3.399994463294982*^9, 3.3999944990018272`*^9}, {3.399994591471686*^9, 
   3.399994608600729*^9}, {3.3999946633145027`*^9, 3.399994684047793*^9}, {
   3.399994726386859*^9, 3.3999947351437473`*^9}, 3.399994923043025*^9, {
   3.399995281418725*^9, 3.399995285208351*^9}, {3.399995395506298*^9, 
   3.399995397490209*^9}, {3.399995429960801*^9, 3.399995500979147*^9}, {
   3.399995582941361*^9, 3.3999956113920717`*^9}, {3.400000435029337*^9, 
   3.4000004451000032`*^9}, {3.4000006765139647`*^9, 3.400000689249036*^9}, {
   3.4000007797073603`*^9, 3.4000007909611692`*^9}, 3.4000009452306137`*^9, {
   3.400001012676672*^9, 3.4000010136563387`*^9}, {3.400001234683096*^9, 
   3.4000012393490973`*^9}, {3.400001400755042*^9, 3.400001410494404*^9}, {
   3.4000016282012568`*^9, 3.400001629560052*^9}, {3.400001699340673*^9, 
   3.400001703313918*^9}, {3.400001736270774*^9, 3.4000017564508953`*^9}, {
   3.400001788318512*^9, 3.400001845973647*^9}, {3.4000018962458363`*^9, 
   3.400001899340097*^9}, {3.400002263152714*^9, 3.400002263630075*^9}, {
   3.400002322446102*^9, 3.400002325773992*^9}, {3.4000023669429083`*^9, 
   3.400002372581102*^9}, {3.4000067798139677`*^9, 3.4000067932058496`*^9}, {
   3.400007014261859*^9, 3.4000070184617367`*^9}, {3.400007080732505*^9, 
   3.400007093938555*^9}, {3.4000071622697287`*^9, 3.40000719245638*^9}, {
   3.400007267930064*^9, 3.4000073808071632`*^9}, {3.400008084302289*^9, 
   3.400008153151039*^9}, {3.400008195239334*^9, 3.400008196708053*^9}, {
   3.400008317620298*^9, 3.400008351773844*^9}, {3.402689355766341*^9, 
   3.402689464915131*^9}, {3.402689616082862*^9, 3.402689794440364*^9}, {
   3.402689841946138*^9, 3.402689856961677*^9}, {3.402689888129675*^9, 
   3.402689908643697*^9}, {3.4026899593460407`*^9, 3.4026901149935923`*^9}, {
   3.402690173931683*^9, 3.4026902346271677`*^9}, {3.402690289831238*^9, 
   3.40269031925161*^9}, {3.402691281679858*^9, 3.4026913477173233`*^9}, {
   3.402691380953411*^9, 3.402691386492812*^9}, {3.40269142696329*^9, 
   3.402691439003384*^9}, {3.402691478171451*^9, 3.4026914956892767`*^9}, {
   3.402692550897941*^9, 3.402692569795904*^9}, {3.402692606457406*^9, 
   3.4026926073080378`*^9}, {3.40269275813861*^9, 3.402692784882732*^9}, {
   3.4028516369739656`*^9, 3.402851659981039*^9}, {3.4029336925075417`*^9, 
   3.4029337477190437`*^9}, {3.402935815455543*^9, 3.402935831390017*^9}, {
   3.402936047162888*^9, 3.4029360493276777`*^9}, {3.402936131665156*^9, 
   3.402936132008284*^9}, {3.40293616619497*^9, 3.402936170010247*^9}, {
   3.4029363462465754`*^9, 3.402936378074217*^9}, {3.402936438874366*^9, 
   3.402936442153902*^9}, {3.402939441904634*^9, 3.40293944664132*^9}, {
   3.40293948694094*^9, 3.402939490523388*^9}, {3.402953789633404*^9, 
   3.402953795720531*^9}, {3.402956106733831*^9, 3.4029561121139307`*^9}, {
   3.403481888885248*^9, 3.403481941096788*^9}, {3.4034820711282578`*^9, 
   3.4034820880857697`*^9}, {3.403482359865893*^9, 3.40348236577931*^9}, {
   3.4034833430470247`*^9, 3.403483360906269*^9}, {3.403538579564845*^9, 
   3.403538586890812*^9}, {3.403540478894588*^9, 3.4035405096096888`*^9}, {
   3.4035429827334957`*^9, 3.403543002348528*^9}, {3.405710112678088*^9, 
   3.405710124129449*^9}, {3.4057101545340014`*^9, 3.4057101832430153`*^9}, {
   3.405710268836738*^9, 3.405710316982264*^9}, {3.405710384102387*^9, 
   3.405710406122918*^9}, {3.4057105555327253`*^9, 3.405710615347687*^9}, {
   3.405710660606031*^9, 3.405710744388438*^9}, {3.405710811707829*^9, 
   3.40571083223248*^9}, {3.405711885693927*^9, 3.405711909204665*^9}, {
   3.405712217928081*^9, 3.4057123186991653`*^9}, {3.4057125822607307`*^9, 
   3.4057126486299*^9}, {3.405712808542454*^9, 3.405712861262232*^9}, {
   3.405713201642136*^9, 3.405713264990485*^9}, {3.405713352288965*^9, 
   3.405713407853982*^9}, {3.405713978242897*^9, 3.405714064487111*^9}, {
   3.4057141022201757`*^9, 3.405714106100814*^9}, {3.4057141417119493`*^9, 
   3.405714229694956*^9}, {3.405714272531191*^9, 3.405714274846683*^9}, {
   3.4057143332328053`*^9, 3.405714504117923*^9}, {3.405714807861012*^9, 
   3.405714827237743*^9}, {3.405715090483015*^9, 3.4057152838644953`*^9}, {
   3.40571541713876*^9, 3.4057154416269217`*^9}, {3.4057154916094437`*^9, 
   3.405715496768361*^9}, {3.405715527615574*^9, 3.405715562759059*^9}, {
   3.405715594089676*^9, 3.405715633527341*^9}, {3.405715670617906*^9, 
   3.405715692598802*^9}, {3.4057165478603163`*^9, 3.405716574794945*^9}, 
   3.405975238316861*^9, {3.405975321970479*^9, 3.405975338054789*^9}, {
   3.405977501750515*^9, 3.405977504289629*^9}, {3.410468430330433*^9, 
   3.4104684319292717`*^9}, {3.410468978453959*^9, 3.410469000436859*^9}, {
   3.410473008029183*^9, 3.4104730187904863`*^9}, {3.4110728981201353`*^9, 
   3.411072919765154*^9}, {3.4110760880101643`*^9, 3.411076110867259*^9}, {
   3.411846117345626*^9, 3.411846125263694*^9}, 3.4118579642668533`*^9, {
   3.411943806276478*^9, 3.411943815577471*^9}, 3.412010647906995*^9, {
   3.412027719005918*^9, 3.4120277266061363`*^9}, {3.412282893762732*^9, 
   3.412282896739328*^9}, {3.4122831878344183`*^9, 3.412283222339836*^9}, {
   3.416607843172535*^9, 3.4166078586651297`*^9}, {3.4166081563512383`*^9, 
   3.416608177313472*^9}, {3.4172883015834427`*^9, 3.4172883299167423`*^9}, {
   3.417288383306678*^9, 3.41728838667636*^9}, {3.417288445968463*^9, 
   3.417288453216384*^9}, {3.417289169337113*^9, 3.417289171255045*^9}, {
   3.417289215845145*^9, 3.417289307989994*^9}, {3.417289343069104*^9, 
   3.417289358325016*^9}, {3.4172894794570103`*^9, 3.417289502959337*^9}, {
   3.41728954626097*^9, 3.417289547383944*^9}, {3.4172900091708097`*^9, 
   3.417290010877572*^9}, {3.417290076039798*^9, 3.4172900787779303`*^9}, {
   3.41736475701015*^9, 3.417364761770392*^9}, {3.417365575986*^9, 
   3.417365577882505*^9}, {3.4197001027382927`*^9, 3.419700109860523*^9}, {
   3.419700563193487*^9, 3.419700569095867*^9}, {3.4197006641770678`*^9, 
   3.4197006725578423`*^9}, {3.419700741355988*^9, 3.419700756662188*^9}, {
   3.419700808929328*^9, 3.4197008147359657`*^9}, {3.4197009820937347`*^9, 
   3.419701167563027*^9}, {3.419709437804524*^9, 3.419709471675376*^9}, {
   3.419711792703738*^9, 3.419711797317367*^9}, {3.419711964634922*^9, 
   3.419711966437348*^9}, {3.419712205676923*^9, 3.419712211240254*^9}, {
   3.419712379708337*^9, 3.419712384568494*^9}, {3.4197124509345713`*^9, 
   3.4197124522619133`*^9}, {3.4197125023553467`*^9, 3.419712502754436*^9}, {
   3.419712657431219*^9, 3.419712658008779*^9}, {3.419716755360208*^9, 
   3.419716779643684*^9}, {3.420390425849856*^9, 3.420390428128834*^9}, {
   3.4209128157569027`*^9, 3.420912862383024*^9}, 3.420912923029088*^9, {
   3.4209129721881943`*^9, 3.4209129915684137`*^9}, {3.4217806555243387`*^9, 
   3.4217807023511353`*^9}, {3.4262847951082163`*^9, 3.426284899322652*^9}, {
   3.426604789475347*^9, 3.42660485809161*^9}, {3.426605049364717*^9, 
   3.42660506488258*^9}, {3.432417672566682*^9, 3.432417693254787*^9}, {
   3.450205730243408*^9, 3.450205755116835*^9}, {3.450205985663389*^9, 
   3.450206043056273*^9}, {3.450206101709538*^9, 3.45020610243748*^9}, {
   3.450474947763857*^9, 3.450474972805475*^9}, {3.4527350017662907`*^9, 
   3.4527350094306*^9}, {3.4527350589996967`*^9, 3.452735076496788*^9}, {
   3.452735112701887*^9, 3.452735299426957*^9}, {3.452735383649947*^9, 
   3.452735475921688*^9}, {3.452735575208436*^9, 3.452735645741826*^9}, {
   3.452736996483563*^9, 3.452737111647378*^9}, {3.452737982900157*^9, 
   3.4527379902373466`*^9}, {3.452738485528264*^9, 3.45273849027337*^9}, {
   3.45273857227057*^9, 3.4527385870500183`*^9}, {3.452738758972638*^9, 
   3.452738764618608*^9}, {3.4527388680485888`*^9, 3.452738879579529*^9}, {
   3.4527799468707247`*^9, 3.452780124998509*^9}, {3.466793603656444*^9, 
   3.466793624063778*^9}, {3.466794081125977*^9, 3.4667940960544243`*^9}, 
   3.46679539604537*^9, 3.466795590147118*^9, {3.4667956451858253`*^9, 
   3.4667956490532513`*^9}, {3.466795719626875*^9, 3.466795719909292*^9}, {
   3.466820108158361*^9, 3.466820114214377*^9}, {3.467045425067769*^9, 
   3.4670454545006638`*^9}, {3.468873920325358*^9, 3.468873948545924*^9}, {
   3.468874074691348*^9, 3.468874074797987*^9}, 3.468874720080052*^9, {
   3.493047234412982*^9, 3.493047279388307*^9}, {3.493047310929982*^9, 
   3.493047313506534*^9}, {3.493047456032606*^9, 3.493047480221407*^9}, {
   3.4930475356011887`*^9, 3.493047576556142*^9}, {3.493047613460977*^9, 
   3.49304763527595*^9}, {3.493047683542742*^9, 3.493047700017618*^9}, {
   3.493047836663439*^9, 3.493047871461487*^9}, {3.493048002572143*^9, 
   3.493048010705811*^9}, {3.493048191254883*^9, 3.493048207077056*^9}, {
   3.49305372405097*^9, 3.493053780567835*^9}, {3.493054235296883*^9, 
   3.49305423824306*^9}, {3.493054275173665*^9, 3.493054319229864*^9}, {
   3.493054351003571*^9, 3.4930544095195627`*^9}, {3.493054642349839*^9, 
   3.4930546620521307`*^9}, 3.493054789639798*^9, {3.493054830977319*^9, 
   3.49305486450202*^9}, {3.493054917316959*^9, 3.493054959103311*^9}, {
   3.493055649556065*^9, 3.493055695280445*^9}, {3.493056693536751*^9, 
   3.49305669743681*^9}, {3.493083497834135*^9, 3.4930835117212563`*^9}, {
   3.493083638154421*^9, 3.493083755948801*^9}, {3.493134577715974*^9, 
   3.493134579284766*^9}, {3.493134724779233*^9, 3.493134788290432*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Generates code for BLAS Contraction Library. ", "Section",
 CellChangeTimes->{{3.416606294940753*^9, 3.416606321099419*^9}, {
  3.4166063676289577`*^9, 3.416606403593831*^9}, {3.416606439277481*^9, 
  3.4166064569711533`*^9}, {3.4166067041957397`*^9, 3.416606704419718*^9}, {
  3.417229082279044*^9, 3.417229088934849*^9}, {3.4172291203001823`*^9, 
  3.417229157057188*^9}, {3.432417418206779*^9, 3.432417446363277*^9}, {
  3.434229110499311*^9, 3.434229128044594*^9}, {3.4377635404683123`*^9, 
  3.437763547732476*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "The", " ", "functions", " ", "below", " ", "handle", " ", "the", " ", 
    "logic", " ", "of", " ", "sequencing", " ", "calls", " ", 
    RowBox[{"etc", "."}]}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"IntsNeededBy", "[", "term_", "]"}], " ", ":=", " ", 
    RowBox[{"(", "\n", "  ", 
     RowBox[{
      RowBox[{"Return", "[", 
       RowBox[{"Cases", "[", 
        RowBox[{"term", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"In", ",", " ", "_"}], "}"}], ",", " ", "___"}], "}"}]}], 
        "]"}], "]"}], ";"}], "\n", "  ", ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AutoProgram", "[", 
      RowBox[{"resshape_", ",", "ContainerName_"}], "]"}], " ", ":=", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{
       "Print", "[", 
        "\"\<//Code below automatically generated by Symbol Manipulator JAP - \
2007\>\"", "]"}], ";", "\n", "\t", 
       RowBox[{"PrintL", "[", 
        RowBox[{"\"\<//Residual being generated is...\>\"", ",", "resshape"}],
         "]"}], ";", "\n", "\t", 
       RowBox[{"rshape", "=", "resshape"}], ";", "\n", "\n", "   ", 
       RowBox[{"ints", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"interms", ",", " ", "1"}], "]"}]}], ";", "\n", "   ", 
       RowBox[{"ObjsToDelete", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\n", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "=", "1"}], ";", " ", "\n", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Populate", " ", "Contractions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
       "Print", "[", 
        "\"\<//---------------------------- \\n// Contraction Population \
Follows: \>\"", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"FactorDepth", " ", "=", " ", "0"}], ";", "\n", "     ", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<\\n// Contribution #:\>\"", ",", "iter", ",", " ", 
             "\"\< :: \>\"", ",", " ", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"terms", "[", 
                RowBox[{"[", "iter", "]"}], "]"}], "]"}], " ", "\[Equal]", 
              " ", "1"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}], ")"}]}], "]"}], ";", 
           "\n", "\t", 
           RowBox[{"tmpinters", " ", "=", " ", 
            RowBox[{"IntsNeededBy", "[", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"MadeOfMediate", " ", "=", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "tmpinters", "]"}], "\[NotEqual]", "0"}],
              ")"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{"MadeOfMediate", ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"PrintL", "[", 
                RowBox[{"\"\<// \>\"", ",", 
                 RowBox[{"Length", "[", "tmpinters", "]"}], ",", 
                 "\"\< Required intermediates: \>\"", ",", " ", "tmpinters"}],
                 "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AssignImaps", "[", 
                    RowBox[{
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}], ",", 
                    RowBox[{"ints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    
                    RowBox[{"FactorDepth", "++"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ";"}], "\[IndentingNewLine]",
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"Inum", ",", "1", ",", 
                   RowBox[{"Length", "[", "tmpinters", "]"}]}], "}"}]}], 
                "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
           "\n", "\t", 
           RowBox[{"AssignContMaps", "[", 
            RowBox[{
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", 
             RowBox[{"TermFactors", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", "resshape", ",", 
             "MadeOfMediate"}], "]"}], ";"}], "\n", "     ", ")"}], ",", " ", 
         
         RowBox[{"{", 
          RowBox[{"iter", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Perform", " ", "Contractions"}], "*)"}], "\n", 
       RowBox[{
       "Print", "[", 
        "\"\<\\n//Intermediate Instantiation code goes Inside amplitude \
update...\>\"", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\n", "\t\t", 
          RowBox[{
           RowBox[{"inter", " ", "=", " ", 
            RowBox[{"ints", "[", 
             RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<mbt<\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
               RowBox[{"Length", "[", "inter", "]"}], "-", "1"}], "]"}], 
             "<>", "\"\<>* \>\"", "<>", 
             RowBox[{"CppName2", "[", "inter", "]"}], "<>", 
             "\"\< = new mbt<\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
               RowBox[{"Length", "[", "inter", "]"}], "-", "1"}], "]"}], 
             "<>", "\"\<>(false); \>\""}], "]"}], ";"}], 
          "\[IndentingNewLine]", " ", ")"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "ints", "]"}], ",", "2"}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
       "Print", "[", 
        "\"\<//---------------------------- \\n// Contraction Routine \
Follows: \>\"", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"PrintL", "[", 
            RowBox[{
            "\"\<\\n// Contribution #:\>\"", ",", "iter", ",", " ", 
             "\"\< :: \>\"", ",", " ", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"terms", "[", 
                RowBox[{"[", "iter", "]"}], "]"}], "]"}], " ", "\[Equal]", 
              " ", "1"}], ",", 
             RowBox[{
              RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmpinters", " ", "=", " ", 
            RowBox[{"IntsNeededBy", "[", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"MadeOfMediate", " ", "=", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "tmpinters", "]"}], "\[NotEqual]", "0"}],
              ")"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"MadeOfMediate", ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<// \>\"", ",", 
                 RowBox[{"Length", "[", "tmpinters", "]"}], ",", 
                 "\"\< Required intermediates: \>\"", ",", " ", "tmpinters"}],
                 "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"(", "\[IndentingNewLine]", 
                  RowBox[{"ContractIntermediate", "[", 
                   RowBox[{
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}], ",", 
                    RowBox[{"ints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
                  ")"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Inum", ",", "1", ",", 
                   RowBox[{"Length", "[", "tmpinters", "]"}]}], "}"}]}], 
                "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Perform", " ", "Actual", " ", "Contraction", " ", "and", " ", 
             RowBox[{"Permutation", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"ContractResult", "[", 
            RowBox[{
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", 
             RowBox[{"TermFactors", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", "resshape", ",", 
             "MadeOfMediate"}], "]"}], ";", "\n", "\t", 
           RowBox[{"(*", 
            RowBox[{"Delete", " ", "the", " ", "Intermediate"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"MadeOfMediate", ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{"(", "\[IndentingNewLine]", 
                 RowBox[{"DelInterm", "[", 
                  RowBox[{
                   RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}], ",", 
                   RowBox[{"ints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
                 ")"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Inum", ",", "1", ",", 
                  RowBox[{"Length", "[", "tmpinters", "]"}]}], "}"}]}], "]"}],
               "\[IndentingNewLine]", ")"}]}], "]"}], ";"}], "\n", "     ", 
          ")"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}], ";"}], 
      ")"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "All", " ", "the", " ", "functions", " ", "below", " ", "are", " ", 
     "shorthand", " ", "for", " ", "getting", " ", "a", " ", "string", " ", 
     "related", " ", "to", " ", "a", " ", "term", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"the", " ", "rank"}], ",", " ", 
       RowBox[{"name", " ", 
        RowBox[{"etc", "."}]}]}], ")"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Name", "[", "tens_", "]"}], " ", ":=", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ToString", "[", 
        RowBox[{"tens", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], "]"}], " ", "~~", " ", 
       RowBox[{"ToString", "[", 
        RowBox[{"tens", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", " ", "2"}], "]"}], "]"}], "]"}]}], ")"}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Rank", "[", "tens_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"Length", "[", "tens", "]"}], " ", "-", " ", "1"}]}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Size", "[", "tens_", "]"}], " ", ":=", " ", 
     RowBox[{"(", "\"\<2\>\"", ")"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "All", " ", "the", " ", "functions", " ", "below", " ", "print", " ", 
     RowBox[{"c", "++"}], " ", "strings", " ", "which", " ", "perform", " ", 
     "some", " ", "specific", " ", "task", " ", 
     RowBox[{"(", 
      RowBox[{"contraction", ",", " ", 
       RowBox[{"temporary", " ", "allocation", " ", 
        RowBox[{"etc", "."}]}]}]}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ContractResult", "[", 
      RowBox[{"tm_", ",", "pm_", ",", "rshape_", ",", "MadeOfMed_"}], "]"}], ":=",
      
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"NumOne", "=", 
        RowBox[{"tm", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumTwo", "=", 
        RowBox[{"tm", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumThree", "=", "residual"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"ContractStr", "[", 
         RowBox[{
         "ContractionNumber", ",", "NumOne", ",", "NumTwo", ",", "NumThree"}],
          "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "++"}], ";"}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ContractIntermediate", "[", 
      RowBox[{"inter_", ",", "defn_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "inter", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"PrintL", "[", 
        RowBox[{"\"\<// Constructing \>\"", "<>", 
         RowBox[{"CppName", "[", "inter", "]"}], "<>", "\"\< Cont#: \>\"", "<>",
          
         RowBox[{"ToString", "[", "ContractionNumber", "]"}], "<>", 
         "\"\<//defn \>\"", "<>", 
         RowBox[{"ToString", "[", "defn", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"neededints", " ", "=", " ", 
        RowBox[{"IntsNeededBy", "[", "defn", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"MadeOfIntermediate", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Length", "[", "neededints", "]"}], "\[NotEqual]", "0"}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"MadeOfIntermediate", ",", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"PrintL", "[", 
            RowBox[{"\"\<// \>\"", ",", 
             RowBox[{"Length", "[", "neededints", "]"}], ",", 
             "\"\< Required intermediates: \>\"", ",", " ", "neededints"}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}], "]"}], "\[Equal]", 
                  "0"}], ",", 
                 RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ContractIntermediate", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                  RowBox[{"[", "Inum2", "]"}], "]"}], ",", 
                 RowBox[{"ints", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
              ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"Inum2", ",", "1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}]}], "}"}]}], 
            "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NumOne", "=", 
        RowBox[{"defn", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumTwo", "=", 
        RowBox[{"defn", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumThree", "=", "inter"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"ContractStr", "[", 
         RowBox[{
         "ContractionNumber", ",", "NumOne", ",", "NumTwo", ",", "NumThree"}],
          "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "++"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}], "\[NotEqual]", 
          "0"}], ",", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{"DelInterm", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                RowBox[{"[", "Inum2", "]"}], "]"}], ",", 
               RowBox[{"ints", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                  "1"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", ")"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"Inum2", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}]}], "}"}]}], 
           "]"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";"}], "\n", ")"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Several", " ", "different", " ", "Contraction", " ", "routines", " ", 
     "depending", " ", "on", " ", "the", " ", "need", " ", "to", " ", "keep", 
     " ", "things", " ", "around"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Generate", " ", "a", " ", "contraction", " ", "String", " ", "for", 
       " ", "an", " ", "amplitude"}], "-", "integral"}], "\[Rule]", 
     RowBox[{"residual", " ", "contraction"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ContractStr", "[", 
     RowBox[{"num_", ",", "Uno_", ",", "Dos_", ",", "Tres_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"(", 
       RowBox[{"\"\<Term[\>\"", "<>", 
        RowBox[{"ToString", "[", "num", "]"}], "<>", "\"\<].Contract(\>\"", "<>",
         
        RowBox[{"CppName", "[", "Uno", "]"}], "<>", "\"\<,\>\"", "<>", 
        RowBox[{"CppName", "[", "Dos", "]"}], "<>", "\"\<,\>\"", "<>", 
        RowBox[{"CppName", "[", "Tres", "]"}], "<>", "\"\<);\>\""}], ")"}], 
      "]"}], "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PopulateString", "[", 
     RowBox[{"num_", ",", "rithm_", ",", "dep_", ",", "anti_", ",", "fac_"}], 
     "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"(", 
       RowBox[{"\"\<Term[\>\"", "<>", 
        RowBox[{"ToString", "[", "num", "]"}], "<>", 
        "\"\<].Populate(eimap,cmap,\>\"", "<>", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", "fac", "]"}], "\[NotEqual]", " ", "1"}], ",", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"N", "[", 
             RowBox[{"Numerator", "[", "fac", "]"}], "]"}], "]"}], "<>", 
           "\"\</\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"N", "[", 
             RowBox[{"Denominator", "[", "fac", "]"}], "]"}], "]"}]}], ",", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "fac", "]"}], "]"}]}], "]"}], "<>", "\"\<,\>\"", 
        "<>", 
        RowBox[{"ToString", "[", "rithm", "]"}], "<>", 
        "\"\<,UnfactorizedExternal);\>\""}], ")"}], "]"}], 
     "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Makes", " ", "Intermediate", " ", "Contraction", " ", "Paramter", " ", 
      "Strings"}], ",", " ", 
     RowBox[{"No", " ", "longer", " ", "deletes", " ", "them"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AssignImaps", "[", 
     RowBox[{"inter_", ",", "defn_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "inter", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<//Constructing \>\"", "<>", 
        RowBox[{"CppName", "[", "inter", "]"}], "<>", "\"\< Cont#: \>\"", "<>",
         
        RowBox[{"ToString", "[", "ContractionNumber", "]"}], "<>", 
        "\"\<//defn \>\"", "<>", 
        RowBox[{"ToString", "[", "defn", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"neededints", " ", "=", " ", 
       RowBox[{"IntsNeededBy", "[", "defn", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MadeOfIntermediate", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Length", "[", "neededints", "]"}], "\[NotEqual]", "0"}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"MadeOfIntermediate", ",", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"PrintL", "[", 
           RowBox[{"\"\<// \>\"", ",", 
            RowBox[{"Length", "[", "neededints", "]"}], ",", 
            "\"\< Required intermediates: \>\"", ",", " ", "neededints"}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                   RowBox[{"[", "Inum2", "]"}], "]"}], "]"}], "\[Equal]", 
                 "0"}], ",", 
                RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AssignImaps", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                 RowBox[{"[", "Inum2", "]"}], "]"}], ",", 
                RowBox[{"ints", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                   "1"}], "]"}], "]"}]}], "]"}], ";"}], "\[IndentingNewLine]",
              ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"Inum2", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}]}], "}"}]}], 
           "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AssignEimap", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"defn", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"defn", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "inter"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"AssignCmap", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"defn", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"defn", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "Dummy_"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"AssignExternArrayVect", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"defn", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"defn", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "inter"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Arithm", "=", "1"}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"CDepth", "=", "FactorDepth"}], ";", " ", "\[IndentingNewLine]",
       
      RowBox[{"Arize", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"PopulateString", "[", 
        RowBox[{
        "ContractionNumber", ",", "Arithm", ",", "CDepth", ",", "Arize", ",", 
         "1"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ContractionNumber", "++"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "\"\<eimap.clear(); cmap.clear();\>\"", "]"}], 
      ";"}], "\n", ")"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Populate", " ", "Last", " ", "Contraction"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssignContMaps", "[", 
      RowBox[{"tm_", ",", "pm_", ",", "rshape_", ",", "MadeOfMed_"}], "]"}], ":=",
      
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AssignEimap", "[", 
        RowBox[{"tm", ",", "rshape"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"AssignCmap", "[", 
        RowBox[{"tm", ",", "rshape"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Arithm", "=", "1"}], ";", " ", "\[IndentingNewLine]", 
       RowBox[{"CDepth", "=", "FactorDepth"}], ";", ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"Arize", "=", "\"\<0\>\""}], ";", " ", 
       RowBox[{"(*", "Depreciated", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Fac", "=", "pm"}], ";", " ", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"PopulateString", "[", 
         RowBox[{
         "ContractionNumber", ",", "Arithm", ",", "CDepth", ",", "Arize", ",",
           "Fac"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "++"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<eimap.clear();\>\"", ",", "\"\<\\n\>\"", ",", 
         "\"\<cmap.clear();\>\""}], "]"}]}], ")"}]}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DelInterm", "[", 
     RowBox[{"inter_", ",", "defn_"}], "]"}], ":=", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<delete \>\"", "<>", 
        RowBox[{"CppName2", "[", "inter", "]"}], "<>", "\"\<;\>\""}], "]"}], 
      ";"}], "\n", ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"Set2ZeroInterm", "[", 
     RowBox[{"inter_", ",", "defn_"}], "]"}], ":=", 
    RowBox[{"(", "\n", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{
        RowBox[{"CppName2", "[", "inter", "]"}], "<>", 
        "\"\<->set2zero();\>\""}], "]"}], ";"}], "\n", ")"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExternalPart", "[", "presh_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"Select", "[", 
       RowBox[{"presh", ",", "IsExternal"}], "]"}], ")"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IsExternal", "[", "Indexx_", "]"}], ":=", 
     RowBox[{
      RowBox[{"StringCount", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "Indexx", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<h\>\"", "~~", "\"\<0\>\"", "~~", "NumberString"}], ",",
           
          RowBox[{"\"\<p\>\"", "~~", "\"\<0\>\"", "~~", "NumberString"}]}], 
         "}"}]}], "]"}], "\[NotEqual]", "0"}]}], ";"}], "\[IndentingNewLine]",
    "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Make", " ", "a", " ", "vector", " ", "containing", " ", "the", " ", 
     "dimensions", " ", "which", " ", "are", " ", "external", " ", "in", " ", 
     "the", " ", "whole", " ", "contraction", " ", "to", " ", "enforce", " ", 
     "locality", " ", "on", " ", "intermediates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssignExternArrayVect", "[", 
      RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToPrint", "=", "\"\<UnfactorizedExternal.clear(); \>\""}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"epart", "=", 
        RowBox[{"ExternalPart", "[", "rshape", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ToPrint", "=", 
            RowBox[{
            "ToPrint", "<>", "\"\< UnfactorizedExternal.push_back(\>\"", "<>",
              
             RowBox[{"ToString", "[", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"rshape", ",", 
                   RowBox[{"epart", "[", 
                    RowBox[{"[", "riter", "]"}], "]"}]}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "2"}], ")"}], 
              "]"}], "<>", "\"\<);\>\""}]}], ";"}], "\[IndentingNewLine]", 
          ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"riter", ",", "1", ",", 
           RowBox[{"Length", "[", "epart", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "ToPrint", "]"}], ";"}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AssignEimap", "[", 
      RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
     RowBox[{"(", "\n", 
      RowBox[{
       RowBox[{"ToPrint", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ToPrint", "=", 
            RowBox[{"ToPrint", "<>", "\"\< eimap[\>\"", "<>", 
             RowBox[{"ToString", "[", " ", 
              RowBox[{"iter1", "-", "1"}], "]"}], "<>", 
             "\"\<] = pair<int,int>(\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"TPosOfIndex", "[", 
               RowBox[{
                RowBox[{"rshape", "[", 
                 RowBox[{"[", 
                  RowBox[{"iter1", "+", "1"}], "]"}], "]"}], ",", "arg"}], 
               "]"}], "]"}], "<>", "\"\<);\>\""}]}], ";"}], "\n", "\t", ")"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"iter1", ",", "1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"NRIndices", "[", 
             RowBox[{
              RowBox[{"arg", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"arg", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "ToPrint", "]"}], ";"}], "\n", ")"}]}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"TPosOfIndex", "[", 
      RowBox[{"dex_", ",", "tenses_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "1"}], "]"}], "<>", 
      "\"\<,\>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "2"}], "]"}]}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CPosOfIndex", "[", 
      RowBox[{"dex_", ",", "tenses_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "2"}], "]"}], "<>", 
      "\"\<,\>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "2"}], "]"}]}]}], ";"}],
    "\n", "\n", 
   RowBox[{
    RowBox[{"AssignCmap", "[", 
     RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ToPrint", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ToPrint", "=", 
           RowBox[{"ToPrint", "<>", "\"\< cmap[\>\"", "<>", 
            RowBox[{"ToString", "[", " ", 
             RowBox[{"iter1", "-", "1"}], "]"}], "<>", 
            "\"\<] = pair<int,int>(\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"CPosOfIndex", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"RIndices", "[", 
                 RowBox[{
                  RowBox[{"arg", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"arg", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", "iter1", "]"}], "]"}], ",", "arg"}], "]"}], 
             "]"}], "<>", "\"\<);\>\""}]}], ";"}], "\[IndentingNewLine]", 
         ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter1", ",", "1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"RIndices", "[", 
            RowBox[{
             RowBox[{"arg", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"arg", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "ToPrint", "]"}], ";"}], "\[IndentingNewLine]", 
     ")"}]}], "\n", " ", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "1"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t1\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "2"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t2\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "3"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t3\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "4"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t4\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "5"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t5\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "6"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t6\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "7"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t7\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "8"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t8\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "9"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t9\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "10"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t10\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "11"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t11\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "12"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<vars->t12\>\""}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "1"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.R1\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "2"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.R2\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "3"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.R3\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "4"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.R4\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "5"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.R5\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"R", ",", "6"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.R6\>\""}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "1"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.L1\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "2"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.L2\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "3"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.L3\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "4"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.L4\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "5"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.L5\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "6"}], "}"}], ",", "___"}], "}"}], "]"}], ":=", 
     "\"\<Vector.L6\>\""}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "1"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l1\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "2"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l2\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "3"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l3\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "4"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l4\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "5"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l5\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "6"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l6\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "7"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l7\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "8"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l8\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "9"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l9\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "10"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l10\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "11"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l11\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalLambda]", ",", "12"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<vars->l12\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]oo", ",", "1"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<DM.gOO\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]ov", ",", "1"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<DM.gOV\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]vv", ",", "1"}], "}"}], ",", "___"}], "}"}], 
      "]"}], ":=", "\"\<DM.gVV\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]oooo", ",", "2"}], "}"}], ",", "___"}], 
       "}"}], "]"}], ":=", "\"\<DM.gOOOO\>\""}], ";"}], "\[IndentingNewLine]",
    
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]ooov", ",", "2"}], "}"}], ",", "___"}], 
       "}"}], "]"}], ":=", "\"\<DM.gOOOV\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]oovv", ",", "2"}], "}"}], ",", "___"}], 
       "}"}], "]"}], ":=", "\"\<DM.gOOVV\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]ovov", ",", "2"}], "}"}], ",", "___"}], 
       "}"}], "]"}], ":=", "\"\<DM.gOVOV\>\""}], ";"}], "\[IndentingNewLine]",
    
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]ovvv", ",", "2"}], "}"}], ",", "___"}], 
       "}"}], "]"}], ":=", "\"\<DM.gOVVV\>\""}], ";"}], "\[IndentingNewLine]",
    
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[CapitalGamma]vvvv", ",", "2"}], "}"}], ",", "___"}], 
       "}"}], "]"}], ":=", "\"\<DM.gVVVV\>\""}], ";"}], "\[IndentingNewLine]",
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", "residual", "]"}], ":=", " ", 
     RowBox[{"\"\<new\>\"", "<>", 
      RowBox[{"CppName", "[", "rshape", "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"In", ",", "h_"}], "}"}], ",", "g___"}], "}"}], "]"}], ":=", 
     
     RowBox[{"\"\<*Interm\>\"", "<>", 
      RowBox[{"ToString", "[", "h", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName2", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"In", ",", "h_"}], "}"}], ",", "g___"}], "}"}], "]"}], ":=", 
     
     RowBox[{"\"\<Interm\>\"", "<>", 
      RowBox[{"ToString", "[", "h", "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Vn", ",", "1"}], "}"}], ",", "g___"}], "}"}], "]"}], ":=", 
     RowBox[{"HamName", "[", 
      RowBox[{"{", "g", "}"}], "]"}]}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CppName", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Fn", ",", "1"}], "}"}], ",", "g___"}], "}"}], "]"}], ":=", 
     RowBox[{"HamName", "[", 
      RowBox[{"{", "g", "}"}], "]"}]}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamName", "[", "indxs_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "indxs", "]"}], "\[Equal]", "2"}], ",", 
        RowBox[{"(", 
         RowBox[{"\"\<H\>\"", "<>", 
          RowBox[{"OorV", "[", 
           RowBox[{"indxs", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "<>", 
          RowBox[{"OorV", "[", 
           RowBox[{"indxs", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}], ",", 
        RowBox[{"(", " ", 
         RowBox[{"\"\<V\>\"", "<>", 
          RowBox[{"OorV", "[", 
           RowBox[{"indxs", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "<>", 
          RowBox[{"OorV", "[", 
           RowBox[{"indxs", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "<>", 
          RowBox[{"OorV", "[", 
           RowBox[{"indxs", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "<>", 
          RowBox[{"OorV", "[", 
           RowBox[{"indxs", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ")"}]}], "]"}], ")"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OorV", "[", "tx_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Characters", "[", 
           RowBox[{"ToString", "[", "tx", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<h\>\""}], ",", 
        "\"\<O\>\"", ",", "\"\<V\>\""}], "]"}], ")"}]}], ";"}], 
   "\n"}]}]], "Input",
 CellChangeTimes->{{3.40027033371875*^9, 3.400270473734375*^9}, {
   3.400270540359375*^9, 3.400270614765625*^9}, {3.40027069671875*^9, 
   3.400270802875*^9}, {3.40027086596875*^9, 3.400270911546875*^9}, {
   3.400270961234375*^9, 3.40027106940625*^9}, {3.400271117515625*^9, 
   3.400271140609375*^9}, {3.40027121384375*^9, 3.40027144490625*^9}, {
   3.400271484921875*^9, 3.400271522046875*^9}, {3.40027155240625*^9, 
   3.400271736890625*^9}, {3.400271786875*^9, 3.400271792328125*^9}, {
   3.400272003546875*^9, 3.400272374875*^9}, {3.40027268265625*^9, 
   3.40027281740625*^9}, {3.400273670206603*^9, 3.4002737388601503`*^9}, {
   3.4024316042453938`*^9, 3.402431670260296*^9}, 3.402431781678141*^9, {
   3.402686416960907*^9, 3.4026864595497637`*^9}, {3.402686500082732*^9, 
   3.4026865022698097`*^9}, {3.40268656862994*^9, 3.40268681507026*^9}, {
   3.402686882807767*^9, 3.4026869810514793`*^9}, {3.402687029109585*^9, 
   3.402687043138405*^9}, {3.402687875194543*^9, 3.402687971129773*^9}, {
   3.40268801474868*^9, 3.4026880220327873`*^9}, {3.402688057076324*^9, 
   3.402688087721805*^9}, 3.402688160379033*^9, {3.4028512411246643`*^9, 
   3.4028512619604883`*^9}, {3.4028513394244633`*^9, 
   3.4028513956757183`*^9}, {3.4028515009834538`*^9, 3.402851543111738*^9}, {
   3.402851685163862*^9, 3.402851806866412*^9}, {3.402851855212295*^9, 
   3.4028519060713577`*^9}, {3.4028519388985357`*^9, 3.402851976111232*^9}, {
   3.4028520136104794`*^9, 3.4028521214484863`*^9}, {3.402852258584247*^9, 
   3.402852288651099*^9}, {3.402852338228251*^9, 3.402852434032256*^9}, {
   3.402852480481154*^9, 3.4028524807910748`*^9}, {3.402852521230193*^9, 
   3.402852530722816*^9}, {3.402852576825943*^9, 3.4028526375811253`*^9}, {
   3.4028526911340723`*^9, 3.402852746605558*^9}, {3.402852785260735*^9, 
   3.4028527862268677`*^9}, {3.402852818175551*^9, 3.4028528477828817`*^9}, {
   3.402853147705914*^9, 3.402853149280919*^9}, {3.4028531858959103`*^9, 
   3.4028532401658087`*^9}, {3.402853360074581*^9, 3.4028533636638517`*^9}, {
   3.402857190065452*^9, 3.4028572664180517`*^9}, {3.402857297571067*^9, 
   3.4028573026242332`*^9}, {3.402857332998555*^9, 3.4028573350003653`*^9}, {
   3.402857391601739*^9, 3.402857409013815*^9}, {3.4028574446644297`*^9, 
   3.4028574913834267`*^9}, {3.402857535135579*^9, 3.402857553983644*^9}, {
   3.4028575881390867`*^9, 3.40285760651999*^9}, {3.40285766368032*^9, 
   3.402857801160614*^9}, {3.4028582672856483`*^9, 3.4028583449267073`*^9}, {
   3.402858404010819*^9, 3.402858412167856*^9}, {3.402858521998151*^9, 
   3.402858524267838*^9}, {3.402933453939024*^9, 3.402933460532802*^9}, {
   3.402933796856883*^9, 3.402933865944668*^9}, {3.402933906584372*^9, 
   3.4029341217621603`*^9}, {3.402934159623438*^9, 3.402934218481662*^9}, {
   3.402934260792788*^9, 3.402934269016966*^9}, {3.402934310837474*^9, 
   3.402934314201365*^9}, 3.402934355850027*^9, {3.402934409453511*^9, 
   3.402934485922729*^9}, {3.40293451912433*^9, 3.4029345482794447`*^9}, {
   3.4029345852062473`*^9, 3.4029346675544024`*^9}, {3.402934725635343*^9, 
   3.402934729281207*^9}, {3.402934762153532*^9, 3.4029348413718357`*^9}, {
   3.402935194316276*^9, 3.4029352015051517`*^9}, {3.402935239275177*^9, 
   3.402935243577598*^9}, {3.40293528364958*^9, 3.402935293810985*^9}, {
   3.402935331600425*^9, 3.402935362620892*^9}, {3.4029355666548567`*^9, 
   3.4029357140317574`*^9}, {3.402936697936178*^9, 3.4029367065176783`*^9}, {
   3.402936882273188*^9, 3.402936887996443*^9}, {3.402936949817891*^9, 
   3.402937009661696*^9}, {3.40293864062435*^9, 3.402938641235683*^9}, {
   3.402938751512402*^9, 3.402938752877789*^9}, {3.402939812035592*^9, 
   3.402939826719421*^9}, {3.402948360556288*^9, 3.402948413675638*^9}, {
   3.4029497700880737`*^9, 3.4029498104436293`*^9}, {3.402949873095406*^9, 
   3.4029499117901287`*^9}, {3.402949965543481*^9, 3.402949985270524*^9}, {
   3.402950297877059*^9, 3.402950300889769*^9}, {3.402950345706655*^9, 
   3.4029503526971407`*^9}, {3.4029505237313957`*^9, 3.402950598252211*^9}, {
   3.402950826750722*^9, 3.4029508586669273`*^9}, {3.402950918708597*^9, 
   3.402950919123349*^9}, {3.402950955073811*^9, 3.402950977040832*^9}, {
   3.402951158030315*^9, 3.402951159299869*^9}, {3.402951259672305*^9, 
   3.402951293315215*^9}, {3.402951407922091*^9, 3.402951470949151*^9}, {
   3.4029515044785757`*^9, 3.4029515112967587`*^9}, {3.402951547728992*^9, 
   3.402951563680539*^9}, {3.402951646125966*^9, 3.4029517306849117`*^9}, {
   3.402951778859252*^9, 3.402951808202723*^9}, {3.402951839415636*^9, 
   3.402951917225669*^9}, {3.402952083602388*^9, 3.4029521667831383`*^9}, {
   3.4029523098419037`*^9, 3.40295237107836*^9}, {3.402952427720035*^9, 
   3.4029524663997173`*^9}, {3.402952625646233*^9, 3.402952627285728*^9}, {
   3.402952749464643*^9, 3.402952795809534*^9}, {3.402952897039433*^9, 
   3.402952907616249*^9}, {3.40295294445162*^9, 3.4029529453002357`*^9}, {
   3.402952988176893*^9, 3.402953103509225*^9}, 3.4029531589118643`*^9, {
   3.4029538599942703`*^9, 3.40295386025788*^9}, 3.402953892313982*^9, {
   3.402953979757025*^9, 3.402954065415799*^9}, {3.402954150814292*^9, 
   3.402954167584313*^9}, {3.402954217443816*^9, 3.402954232372211*^9}, {
   3.402954336895424*^9, 3.4029543730230913`*^9}, {3.4029544418183193`*^9, 
   3.402954672817935*^9}, {3.402954720843573*^9, 3.4029547318938513`*^9}, {
   3.402954810244372*^9, 3.402954853105215*^9}, {3.402954946490025*^9, 
   3.40295495663278*^9}, {3.4029562693006353`*^9, 3.402956278148075*^9}, {
   3.402956647499694*^9, 3.402956660600565*^9}, {3.402956708932757*^9, 
   3.402956709153366*^9}, 3.402956800772333*^9, {3.402956843870311*^9, 
   3.402956899798066*^9}, {3.403370609414701*^9, 3.403370609523843*^9}, {
   3.40337089548772*^9, 3.403370935776544*^9}, {3.403625315370427*^9, 
   3.403625362018344*^9}, {3.403625486943281*^9, 3.4036254874015017`*^9}, {
   3.403625595007057*^9, 3.403625619503694*^9}, {3.403625682758106*^9, 
   3.403625689863614*^9}, {3.403650082602865*^9, 3.403650126217217*^9}, {
   3.410885169703404*^9, 3.4108851990536823`*^9}, {3.410885555746415*^9, 
   3.410885624223365*^9}, {3.410885685781601*^9, 3.410885761868778*^9}, {
   3.410885792640436*^9, 3.410885836952178*^9}, {3.410886042589579*^9, 
   3.410886043920239*^9}, {3.4108862776218967`*^9, 3.410886301119928*^9}, {
   3.410886376223075*^9, 3.410886503678225*^9}, {3.410886662800721*^9, 
   3.410886671826592*^9}, {3.41088685318372*^9, 3.410886857317314*^9}, {
   3.410886907126871*^9, 3.4108869086585608`*^9}, {3.410886951688387*^9, 
   3.410886965917042*^9}, 3.410887048949003*^9, {3.410887128307291*^9, 
   3.41088715857833*^9}, {3.410890567152629*^9, 3.410890606066959*^9}, {
   3.410890656356697*^9, 3.410890661171837*^9}, 3.410890731461479*^9, 
   3.410890792377039*^9, {3.410890946761033*^9, 3.410890949246163*^9}, {
   3.4108910620812273`*^9, 3.410891073490931*^9}, {3.4108911377541103`*^9, 
   3.4108911511431026`*^9}, {3.4108912321475973`*^9, 3.410891333305448*^9}, {
   3.4108913968477488`*^9, 3.410891449351605*^9}, {3.4108916715184402`*^9, 
   3.410891701318142*^9}, {3.410891732061668*^9, 3.410891743844925*^9}, {
   3.410891781061366*^9, 3.4108917883359222`*^9}, {3.4108918294037523`*^9, 
   3.4108918295035267`*^9}, {3.410891870123519*^9, 3.410891923441576*^9}, {
   3.4108921457576103`*^9, 3.4108921978988447`*^9}, 3.410892273567562*^9, {
   3.411075799904052*^9, 3.4110758082545547`*^9}, {3.411075839981971*^9, 
   3.411075889394931*^9}, {3.4110759218189793`*^9, 3.411075932063395*^9}, {
   3.411159228250218*^9, 3.4111592342862873`*^9}, {3.413924131903298*^9, 
   3.413924149486533*^9}, {3.416608313448846*^9, 3.4166083276776648`*^9}, {
   3.4166084304404163`*^9, 3.4166085082434473`*^9}, {3.417366203919009*^9, 
   3.417366261634659*^9}, {3.41736674913284*^9, 3.417366751672452*^9}, {
   3.417366790978441*^9, 3.4173668900400457`*^9}, {3.41736697213686*^9, 
   3.417366986801804*^9}, {3.417367091894289*^9, 3.4173670960968037`*^9}, {
   3.417367281872923*^9, 3.417367288967188*^9}, {3.417367329164776*^9, 
   3.417367370420066*^9}, 3.4173676904335327`*^9, {3.417368950062557*^9, 
   3.41736895446299*^9}, {3.417369094600219*^9, 3.417369095356043*^9}, {
   3.417369461372834*^9, 3.417369628028167*^9}, {3.4173698191352262`*^9, 
   3.417369852507868*^9}, {3.417370005182919*^9, 3.417370034383045*^9}, 
   3.417370259327146*^9, {3.417370392591893*^9, 3.417370416187091*^9}, {
   3.417370645821698*^9, 3.4173706461810017`*^9}, {3.417370866354505*^9, 
   3.4173708792596807`*^9}, {3.419723963801435*^9, 3.419723977790436*^9}, {
   3.419874640317316*^9, 3.419874640483329*^9}, {3.420737702674856*^9, 
   3.42073772501368*^9}, {3.421607660793148*^9, 3.421607670497746*^9}, {
   3.421708220053214*^9, 3.4217082301355257`*^9}, {3.421782869917995*^9, 
   3.4217828760228157`*^9}, {3.421782909725627*^9, 3.421782922320415*^9}, {
   3.4218804619115458`*^9, 3.4218804905767593`*^9}, 3.428426472152244*^9, {
   3.428426514895455*^9, 3.428426543792214*^9}, {3.4284266389766083`*^9, 
   3.428426699570662*^9}, {3.428426750573822*^9, 3.4284267522041616`*^9}, {
   3.428426825064633*^9, 3.428426851184194*^9}, {3.428434469386428*^9, 
   3.428434540489102*^9}, {3.428434603376602*^9, 3.428434927429985*^9}, {
   3.428434962034492*^9, 3.428434964609695*^9}, {3.4284350439448643`*^9, 
   3.428435109515121*^9}, {3.4284362622612123`*^9, 3.428436297463417*^9}, {
   3.4284363422392406`*^9, 3.428436378988236*^9}, {3.4284364372829437`*^9, 
   3.428436439138576*^9}, {3.4284364758035517`*^9, 3.4284365193275347`*^9}, {
   3.428436551744464*^9, 3.42843655446414*^9}, {3.43205515962948*^9, 
   3.432055162722538*^9}, {3.432906094607094*^9, 3.432906265969914*^9}, {
   3.432906305599907*^9, 3.432906342132951*^9}, {3.432906383588891*^9, 
   3.432906458447145*^9}, {3.4329065043322687`*^9, 3.432906555842413*^9}, {
   3.432906594896001*^9, 3.4329065966835203`*^9}, {3.4329067854848013`*^9, 
   3.432906984762392*^9}, {3.432907056638216*^9, 3.432907139162229*^9}, {
   3.432907220307006*^9, 3.4329073184415207`*^9}, {3.432907385192721*^9, 
   3.4329074299449387`*^9}, {3.432907527151825*^9, 3.4329075282243233`*^9}, {
   3.432907596709381*^9, 3.4329076108341084`*^9}, {3.432907775066824*^9, 
   3.432907997339344*^9}, {3.432908066795307*^9, 3.432908078666586*^9}, {
   3.434217915175147*^9, 3.434217952841619*^9}, {3.434218046462831*^9, 
   3.43421806967346*^9}, {3.434218199862306*^9, 3.434218200774179*^9}, 
   3.434218230899365*^9, {3.434218352485981*^9, 3.4342183886404343`*^9}, {
   3.4342184822837467`*^9, 3.434218484611937*^9}, {3.4342185262186193`*^9, 
   3.434218550011689*^9}, {3.4342186555197973`*^9, 3.434218693011484*^9}, {
   3.4342187543457947`*^9, 3.434218973533938*^9}, {3.434219013600144*^9, 
   3.434219059163467*^9}, {3.4342191215923347`*^9, 3.434219169108478*^9}, {
   3.434219235785783*^9, 3.434219236438787*^9}, {3.4342192674139214`*^9, 
   3.4342192688441877`*^9}, {3.434219800867365*^9, 3.434220081419222*^9}, {
   3.434220126878284*^9, 3.434220134957292*^9}, {3.434220224259149*^9, 
   3.434220281004005*^9}, {3.434220322133465*^9, 3.4342203394452763`*^9}, {
   3.434220437957067*^9, 3.434220443202443*^9}, {3.434220496469487*^9, 
   3.43422050035476*^9}, {3.434220582054793*^9, 3.434220628368763*^9}, {
   3.434220710266193*^9, 3.4342207939588747`*^9}, {3.434220832365691*^9, 
   3.434221337035616*^9}, {3.43422139796462*^9, 3.4342214769611883`*^9}, {
   3.434221591939595*^9, 3.434221615716951*^9}, {3.434221649983452*^9, 
   3.434221699101342*^9}, {3.4342217797104387`*^9, 3.434221791262258*^9}, {
   3.4342218444790163`*^9, 3.434221850845595*^9}, {3.434221890628934*^9, 
   3.434221897159412*^9}, {3.434222019494561*^9, 3.434222023049806*^9}, {
   3.434222071376511*^9, 3.434222075843471*^9}, {3.434222143126685*^9, 
   3.434222179085965*^9}, {3.4342281479926987`*^9, 3.434228179166787*^9}, {
   3.434228327579074*^9, 3.4342283293332367`*^9}, {3.43422840823317*^9, 
   3.4342284092435083`*^9}, {3.434228442343966*^9, 3.434228460044312*^9}, {
   3.434228518576344*^9, 3.434228518677637*^9}, {3.434228565636656*^9, 
   3.434228565748426*^9}, {3.4342286225073137`*^9, 3.434228657642436*^9}, 
   3.434229100619617*^9, {3.436408281968833*^9, 3.436408404068921*^9}, {
   3.436408624799122*^9, 3.4364086250292397`*^9}, {3.43645888766477*^9, 
   3.436458906591989*^9}, {3.436976504448295*^9, 3.436976513555839*^9}, {
   3.440439793976837*^9, 3.440439804259605*^9}, {3.440439841192789*^9, 
   3.440439862892373*^9}, {3.448460655089796*^9, 3.448460695347337*^9}, {
   3.448460734837431*^9, 3.448460783598259*^9}, {3.448836752617919*^9, 
   3.448836778273426*^9}, {3.448836899442628*^9, 3.448836918050208*^9}, {
   3.448840291961585*^9, 3.448840300397246*^9}, {3.448917719221177*^9, 
   3.448917723416493*^9}, {3.448973880914929*^9, 3.448973881613287*^9}, {
   3.450206311252894*^9, 3.450206387946518*^9}, {3.450474188673236*^9, 
   3.450474191225978*^9}, 3.4504791110015793`*^9, {3.4512770538125153`*^9, 
   3.4512771616805077`*^9}, {3.451277239479195*^9, 3.451277305139764*^9}, {
   3.4512773365170927`*^9, 3.451277367204402*^9}, {3.4516827831394243`*^9, 
   3.451682803964098*^9}, {3.452742309202982*^9, 3.452742370435389*^9}, {
   3.4527424635604267`*^9, 3.45274247668719*^9}, {3.452742560008499*^9, 
   3.4527425795610723`*^9}, {3.452744119813499*^9, 3.452744129331155*^9}, {
   3.45274416380864*^9, 3.4527441935343103`*^9}, {3.452744253451989*^9, 
   3.452744396847125*^9}, {3.452745335537878*^9, 3.452745393947578*^9}, {
   3.452746218076373*^9, 3.452746252050585*^9}, {3.452776795495083*^9, 
   3.452776803574974*^9}, {3.452778255672707*^9, 3.452778263490952*^9}, {
   3.4527787938201427`*^9, 3.452778815452923*^9}, {3.452778941813662*^9, 
   3.4527790361136913`*^9}, {3.468873257653891*^9, 3.4688732879589777`*^9}, {
   3.468873333382824*^9, 3.468873379490486*^9}, {3.4688734554924994`*^9, 
   3.468873456395176*^9}, {3.468873488671596*^9, 3.4688734892679977`*^9}, {
   3.46887353151262*^9, 3.4688735434153557`*^9}, 3.468873584387619*^9, {
   3.468874933953837*^9, 3.46887500777149*^9}, 3.468875424107862*^9, 
   3.468875469256833*^9, {3.471703075350514*^9, 3.4717031926854773`*^9}, {
   3.472406249756316*^9, 3.472406252345079*^9}, {3.473968700512128*^9, 
   3.473968760867661*^9}, {3.473969056687908*^9, 3.47396906783149*^9}, {
   3.473970012004675*^9, 3.473970014433188*^9}, {3.473970056317007*^9, 
   3.473970095485677*^9}, {3.473972418570977*^9, 3.473972434928163*^9}, {
   3.4742237092726297`*^9, 3.474223727384101*^9}, 3.4757890975685377`*^9, {
   3.485448141316218*^9, 3.485448142166504*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
AutoProgramDsk writes a Populate file which can be read directly from disk \
not compiled and a code file which doesn't have to be copied \
\>", "Section",
 CellChangeTimes->{{3.485445847363538*^9, 3.485445884239259*^9}, {
  3.485446377234907*^9, 3.4854463780393*^9}, {3.4854464973234587`*^9, 
  3.4854465062826757`*^9}, {3.4854487347078733`*^9, 3.48544873828898*^9}, {
  3.485449393111988*^9, 3.4854493947956047`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Algorithm", " ", "can", " ", "be", " ", "changed", " ", 
    RowBox[{"below", " ", ":"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Arithm", " ", "=", " ", "1"}], ";"}], " ", "\[IndentingNewLine]",
    
   RowBox[{
    RowBox[{
     RowBox[{"AssignImapsDsk", "[", 
      RowBox[{"Des_", ",", "inter_", ",", "defn_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "inter", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"neededints", " ", "=", " ", 
        RowBox[{"IntsNeededBy", "[", "defn", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"MadeOfIntermediate", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Length", "[", "neededints", "]"}], "\[NotEqual]", "0"}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"MadeOfIntermediate", ",", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}], "]"}], "\[Equal]", 
                  "0"}], ",", 
                 RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AssignImapsDsk", "[", 
                RowBox[{"Des", ",", 
                 RowBox[{
                  RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                  RowBox[{"[", "Inum2", "]"}], "]"}], ",", 
                 RowBox[{"ints", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], ";"}], 
              "\[IndentingNewLine]", ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"Inum2", ",", "1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}]}], "}"}]}], 
            "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Arize", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "ContractionNumber"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "1"}], "]"}], ";", " ", 
       RowBox[{"(*", "Numerator", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "1"}], "]"}], ";", " ", 
       RowBox[{"(*", "Denominator", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "Arithm"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", 
         RowBox[{"AssignEimapDsk", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"defn", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"defn", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "inter"}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", 
         RowBox[{"AssignCmapDsk", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"defn", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"defn", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "inter"}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", 
         RowBox[{"AssignExternArrayVectDsk", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"defn", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"defn", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "inter"}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"ContractionNumber", "++"}], ";"}], "\n", ")"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssignExternArrayVectDsk", "[", 
      RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToPrint", "=", "\"\< { \>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{"epart", "=", 
        RowBox[{"ExternalPart", "[", "rshape", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ToPrint", "=", 
            RowBox[{"ToPrint", "<>", "\"\< \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"rshape", ",", 
                   RowBox[{"epart", "[", 
                    RowBox[{"[", "riter", "]"}], "]"}]}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "2"}], ")"}], 
              "]"}], "<>", "\"\< \>\""}]}], ";"}], "\[IndentingNewLine]", 
          ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"riter", ",", "1", ",", 
           RowBox[{"Length", "[", "epart", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ToPrint", "=", 
        RowBox[{"ToPrint", "<>", "\"\< } \>\""}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "ToPrint", "]"}]}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TPosOfIndexDsk", "[", 
      RowBox[{"dex_", ",", "tenses_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "1"}], "]"}], "<>", 
      "\"\< \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "2"}], "]"}]}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"CPosOfIndexDsk", "[", 
      RowBox[{"dex_", ",", "tenses_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "2"}], "]"}], "<>", 
      "\"\< \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"tenses", ",", "dex"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "2"}], "]"}]}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AssignEimapDsk", "[", 
      RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToPrint", "=", "\"\< { \>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ToPrint", "=", 
            RowBox[{"ToPrint", "<>", "\"\< \>\"", "<>", 
             RowBox[{"ToString", "[", " ", 
              RowBox[{"iter1", "-", "1"}], "]"}], "<>", "\"\< \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"TPosOfIndexDsk", "[", 
               RowBox[{
                RowBox[{"rshape", "[", 
                 RowBox[{"[", 
                  RowBox[{"iter1", "+", "1"}], "]"}], "]"}], ",", "arg"}], 
               "]"}], "]"}], "<>", "\"\< \>\""}]}], ";"}], "\n", "\t", ")"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"iter1", ",", "1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"NRIndices", "[", 
             RowBox[{
              RowBox[{"arg", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"arg", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ToPrint", "=", 
        RowBox[{"ToPrint", "<>", "\"\< } \>\""}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "ToPrint", "]"}]}], "\n", ")"}]}], ";"}], "\n", 
   
   RowBox[{
    RowBox[{"AssignCmapDsk", "[", 
     RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ToPrint", "=", "\"\< { \>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ToPrint", "=", 
           RowBox[{"ToPrint", "<>", "\"\< \>\"", "<>", 
            RowBox[{"ToString", "[", " ", 
             RowBox[{"iter1", "-", "1"}], "]"}], "<>", "\"\< \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"CPosOfIndexDsk", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"RIndices", "[", 
                 RowBox[{
                  RowBox[{"arg", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"arg", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", "iter1", "]"}], "]"}], ",", "arg"}], "]"}], 
             "]"}], "<>", "\"\< \>\""}]}], ";"}], "\[IndentingNewLine]", 
         ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter1", ",", "1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"RIndices", "[", 
            RowBox[{
             RowBox[{"arg", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"arg", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ToPrint", "=", 
       RowBox[{"ToPrint", "<>", "\"\< } \>\""}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "ToPrint", "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssignContMapsDsk", "[", 
      RowBox[{
      "Des_", ",", "tm_", ",", "pm_", ",", "rshape_", ",", "MadeOfMed_"}], 
      "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"CDepth", "=", "FactorDepth"}], ";"}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"Arize", "=", "\"\<0\>\""}], ";", " ", 
       RowBox[{"(*", "Depreciated", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"nFac", "=", 
        RowBox[{"Numerator", "[", 
         RowBox[{"Rationalize", "[", "pm", "]"}], "]"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"dFac", "=", 
        RowBox[{"Denominator", "[", 
         RowBox[{"Rationalize", "[", "pm", "]"}], "]"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "ContractionNumber"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "nFac"}], "]"}], ";", " ", 
       RowBox[{"(*", "Numerator", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "dFac"}], "]"}], ";", " ", 
       RowBox[{"(*", "Denominator", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "Arithm"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", 
         RowBox[{"AssignEimapDsk", "[", 
          RowBox[{"tm", ",", "rshape"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", 
         RowBox[{"AssignCmapDsk", "[", 
          RowBox[{"tm", ",", "rshape"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{
        "This", " ", "is", " ", "the", " ", "External", " ", "Array", " ", 
         "Vector"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< { 0 } \>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"Des", ",", "\"\< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"ContractionNumber", "++"}], ";"}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ContractIntermediateDsk", "[", 
      RowBox[{"DF_", ",", "inter_", ",", "defn_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "inter", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"WriteString", "[", 
          RowBox[{"DF", ",", 
           RowBox[{"\"\<// Constructing \>\"", "<>", 
            RowBox[{"CppName", "[", "inter", "]"}], "<>", "\"\< Cont#: \>\"", 
            "<>", 
            RowBox[{"ToString", "[", "ContractionNumber", "]"}], "<>", 
            "\"\<//defn \>\"", "<>", 
            RowBox[{"ToString", "[", "defn", "]"}]}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"neededints", " ", "=", " ", 
        RowBox[{"IntsNeededBy", "[", "defn", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"MadeOfIntermediate", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Length", "[", "neededints", "]"}], "\[NotEqual]", "0"}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"MadeOfIntermediate", ",", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"WriteString", "[", 
            RowBox[{"DF", ",", "\"\<// \>\"", ",", 
             RowBox[{"Length", "[", "neededints", "]"}], ",", 
             "\"\< Required intermediates: \>\"", ",", " ", "neededints"}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"WriteString", "[", 
             RowBox[{"DF", ",", "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]",
             
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}], "]"}], "\[Equal]", 
                   "0"}], ",", 
                  RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"ContractIntermediateDsk", "[", 
                 RowBox[{"DF", ",", 
                  RowBox[{
                   RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                   RowBox[{"[", "Inum2", "]"}], "]"}], ",", 
                  RowBox[{"ints", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
               ")"}], ",", 
              RowBox[{"{", 
               RowBox[{"Inum2", ",", "1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}]}], "}"}]}],
              "]"}]}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NumOne", "=", 
        RowBox[{"defn", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumTwo", "=", 
        RowBox[{"defn", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumThree", "=", "inter"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"DF", ",", 
         RowBox[{"ContractStr", "[", 
          RowBox[{
          "ContractionNumber", ",", "NumOne", ",", "NumTwo", ",", 
           "NumThree"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"DF", ",", "\"\<\\n\>\""}], "]"}], ";", "\[IndentingNewLine]",
        
       RowBox[{"ContractionNumber", "++"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}], "\[NotEqual]", 
          "0"}], ",", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{"DelIntermDsk", "[", 
              RowBox[{"DF", ",", 
               RowBox[{
                RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                RowBox[{"[", "Inum2", "]"}], "]"}], ",", 
               RowBox[{"ints", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{
                    RowBox[{"IntsNeededBy", "[", "defn", "]"}], "[", 
                    RowBox[{"[", "Inum2", "]"}], "]"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                  "1"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", ")"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"Inum2", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"IntsNeededBy", "[", "defn", "]"}], "]"}]}], "}"}]}], 
           "]"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";"}], "\n", ")"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DelIntermDsk", "[", 
      RowBox[{"DF_", ",", "inter_", ",", "defn_"}], "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"WriteString", "[", 
        RowBox[{"DF", ",", 
         RowBox[{"\"\<delete \>\"", "<>", 
          RowBox[{"CppName2", "[", "inter", "]"}], "<>", "\"\<;\>\""}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"DF", ",", "\"\<\\n\>\""}], "]"}], ";"}], "\n", ")"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ContractResultDsk", "[", 
      RowBox[{
      "DF_", ",", "tm_", ",", "pm_", ",", "rshape_", ",", "MadeOfMed_"}], 
      "]"}], ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"NumOne", "=", 
        RowBox[{"tm", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumTwo", "=", 
        RowBox[{"tm", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"NumThree", "=", "residual"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"DF", ",", 
         RowBox[{"ContractStr", "[", 
          RowBox[{
          "ContractionNumber", ",", "NumOne", ",", "NumTwo", ",", 
           "NumThree"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"DF", ",", "\"\<\\n\>\""}], "]"}], ";", "\[IndentingNewLine]",
        
       RowBox[{"ContractionNumber", "++"}], ";"}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AutoProgramDsk", "[", 
      RowBox[{"resshape_", ",", "afile_", ",", "codefile_"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"\"\<There are \>\"", ",", 
         RowBox[{"Length", "[", "terms", "]"}], ",", "\"\< terms, and \>\"", 
         ",", " ", 
         RowBox[{
          RowBox[{"Length", "[", "terms", "]"}], "+", 
          RowBox[{"Length", "[", "interms", "]"}]}], ",", " ", 
         "\"\< total Contractions \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Population Commands being Dumped to: \>\"", ",", "afile"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Contraction Commands being Dumped to: \>\"", ",", "codefile"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"rshape", "=", "resshape"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ints", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"interms", ",", " ", "1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ObjsToDelete", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "=", "1"}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"s", " ", "=", " ", 
        RowBox[{"OpenWrite", "[", "afile", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r", " ", "=", " ", 
        RowBox[{"OpenWrite", "[", "codefile", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"s", ",", 
         RowBox[{
          RowBox[{"Length", "[", "terms", "]"}], "+", 
          RowBox[{"Length", "[", "interms", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"s", ",", "\"\<\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{"Populate", " ", "Contractions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"FactorDepth", " ", "=", " ", "0"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"terms", "[", 
                RowBox[{"[", "iter", "]"}], "]"}], "]"}], " ", "\[Equal]", 
              " ", "1"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}], ")"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmpinters", " ", "=", " ", 
            RowBox[{"IntsNeededBy", "[", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"MadeOfMediate", " ", "=", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "tmpinters", "]"}], "\[NotEqual]", "0"}],
              ")"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"MadeOfMediate", ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AssignImapsDsk", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}], ",", 
                    RowBox[{"ints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    
                    RowBox[{"FactorDepth", "++"}], ";"}], 
                   "\[IndentingNewLine]", ")"}], ";"}], "\[IndentingNewLine]",
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"Inum", ",", "1", ",", 
                   RowBox[{"Length", "[", "tmpinters", "]"}]}], "}"}]}], 
                "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AssignContMapsDsk", "[", 
            RowBox[{"s", ",", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", 
             RowBox[{"TermFactors", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", "resshape", ",", 
             "MadeOfMediate"}], "]"}], ";"}], "\n", "     ", ")"}], ",", " ", 
         
         RowBox[{"{", 
          RowBox[{"iter", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Perform", " ", "Contractions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{
        "r", ",", 
         "\"\<//Code below automatically generated by Symbol Manipulator JAP \
- 2007\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{
        "r", ",", 
         "\"\<\\n//Intermediate Instantiation code goes Inside amplitude \
update...\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\n", "\t\t", 
          RowBox[{
           RowBox[{"inter", " ", "=", " ", 
            RowBox[{"ints", "[", 
             RowBox[{"[", "iter", "]"}], "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"WriteString", "[", 
            RowBox[{"r", ",", 
             RowBox[{"\"\<mbt<\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{
                RowBox[{"Length", "[", "inter", "]"}], "-", "1"}], "]"}], 
              "<>", "\"\<>* \>\"", "<>", 
              RowBox[{"CppName2", "[", "inter", "]"}], "<>", 
              "\"\< = new mbt<\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{
                RowBox[{"Length", "[", "inter", "]"}], "-", "1"}], "]"}], 
              "<>", "\"\<>(false); \>\""}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"WriteString", "[", 
            RowBox[{"r", ",", "\"\<\\n\>\""}], "]"}], ";"}], 
          "\[IndentingNewLine]", " ", ")"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "ints", "]"}], ",", "2"}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{
        "r", ",", 
         "\"\<//---------------------------- \\n// Contraction Routine \
Follows: \>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ContractionNumber", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"WriteString", "[", 
            RowBox[{
            "r", ",", "\"\<\\n// Contribution #:\>\"", ",", "iter", ",", " ", 
             "\"\< :: \>\"", ",", " ", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"WriteString", "[", 
            RowBox[{"r", ",", "\"\<\\n\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"terms", "[", 
                RowBox[{"[", "iter", "]"}], "]"}], "]"}], " ", "\[Equal]", 
              " ", "1"}], ",", 
             RowBox[{
              RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmpinters", " ", "=", " ", 
            RowBox[{"IntsNeededBy", "[", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"MadeOfMediate", " ", "=", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "tmpinters", "]"}], "\[NotEqual]", "0"}],
              ")"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"MadeOfMediate", ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"WriteString", "[", 
                RowBox[{"r", ",", "\"\<// \>\"", ",", 
                 RowBox[{"Length", "[", "tmpinters", "]"}], ",", 
                 "\"\< Required intermediates: \>\"", ",", " ", "tmpinters"}],
                 "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"WriteString", "[", 
                RowBox[{"r", ",", "\"\<\\n\>\""}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"(", "\[IndentingNewLine]", 
                  RowBox[{"ContractIntermediateDsk", "[", 
                   RowBox[{"r", ",", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}], ",", 
                    RowBox[{"ints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
                  ")"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Inum", ",", "1", ",", 
                   RowBox[{"Length", "[", "tmpinters", "]"}]}], "}"}]}], 
                "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Perform", " ", "Actual", " ", "Contraction", " ", "and", " ", 
             RowBox[{"Permutation", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"ContractResultDsk", "[", 
            RowBox[{"r", ",", 
             RowBox[{"terms", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", 
             RowBox[{"TermFactors", "[", 
              RowBox[{"[", "iter", "]"}], "]"}], ",", "resshape", ",", 
             "MadeOfMediate"}], "]"}], ";", "\n", "\t", 
           RowBox[{"(*", 
            RowBox[{"Delete", " ", "the", " ", "Intermediate"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"MadeOfMediate", ",", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{"(", "\[IndentingNewLine]", 
                 RowBox[{"DelIntermDsk", "[", 
                  RowBox[{
                   RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}], ",", 
                   RowBox[{"ints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"ints", ",", " ", 
                    RowBox[{"tmpinters", "[", 
                    RowBox[{"[", "Inum", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "+", " ", 
                    "1"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
                 ")"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Inum", ",", "1", ",", 
                  RowBox[{"Length", "[", "tmpinters", "]"}]}], "}"}]}], "]"}],
               "\[IndentingNewLine]", ")"}]}], "]"}], ";"}], "\n", "     ", 
          ")"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Close", "[", "s", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Close", "[", "r", "]"}], ";"}], "\[IndentingNewLine]", 
      ")"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.485445911649849*^9, 3.485445917950238*^9}, {
   3.4854459853970013`*^9, 3.485446064928739*^9}, {3.485446121200296*^9, 
   3.485446160063047*^9}, {3.4854461933891153`*^9, 3.485446249586977*^9}, {
   3.485446309287097*^9, 3.485446316883362*^9}, {3.485446407833424*^9, 
   3.4854464851875353`*^9}, {3.485446519474017*^9, 3.48544655282191*^9}, {
   3.485446630241892*^9, 3.485446675666844*^9}, {3.4854467133756313`*^9, 
   3.485446759739633*^9}, {3.4854469950352163`*^9, 3.485447000920534*^9}, {
   3.485447073653157*^9, 3.4854471415194693`*^9}, {3.485447252208164*^9, 
   3.4854472656205177`*^9}, {3.485447321155298*^9, 3.485447347004285*^9}, {
   3.485447392889442*^9, 3.485447562205513*^9}, {3.485447601075056*^9, 
   3.485447727258017*^9}, {3.485447760969726*^9, 3.485447762112792*^9}, {
   3.485447877932806*^9, 3.485448070991734*^9}, {3.4854481550860233`*^9, 
   3.48544827593885*^9}, {3.485448532123946*^9, 3.4854485583776073`*^9}, {
   3.485448683998918*^9, 3.4854487029783487`*^9}, {3.485448827194088*^9, 
   3.485448899891523*^9}, {3.48544896505122*^9, 3.485448968174817*^9}, {
   3.485448998278023*^9, 3.4854490404627457`*^9}, {3.485449089748329*^9, 
   3.4854491096824207`*^9}, {3.485449256497925*^9, 3.48544927106046*^9}, {
   3.485449308714561*^9, 3.485449359513929*^9}, {3.485463694651697*^9, 
   3.485463695047882*^9}, {3.485465849713069*^9, 3.485465883562148*^9}, {
   3.4855205421194887`*^9, 3.485520549170946*^9}, {3.485520595879541*^9, 
   3.485520600483027*^9}, {3.485520806272937*^9, 3.48552081435849*^9}, 
   3.485521086531893*^9, {3.4855211968891487`*^9, 3.485521213881041*^9}, {
   3.485522466622939*^9, 3.485522493660222*^9}, {3.485522841202785*^9, 
   3.485522940025375*^9}, {3.485523055350861*^9, 3.485523065417634*^9}, {
   3.485523394732236*^9, 3.485523400148478*^9}, {3.485529184215864*^9, 
   3.485529204194478*^9}, {3.48552923962495*^9, 3.485529267586952*^9}, {
   3.485529299691635*^9, 3.4855292998750362`*^9}, {3.485529998045959*^9, 
   3.4855300836333838`*^9}, {3.485530212619137*^9, 3.485530215410664*^9}, {
   3.485530254563395*^9, 3.4855302635947733`*^9}, {3.4855336014152603`*^9, 
   3.485533674865477*^9}, 3.4855339004063587`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Refinement of the Above Routines which re-uses intermediates: \
\>", "Section",
 CellChangeTimes->{{3.4667959910356627`*^9, 3.466796007050737*^9}, {
  3.46679657502098*^9, 3.466796583076231*^9}, {3.4681574182444*^9, 
  3.46815741998813*^9}}],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
  "The", " ", "Arguements", " ", "of", " ", "this", " ", "Routine", " ", 
   "should", " ", 
   RowBox[{"be", ":", " ", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "Terms", "}"}], ",", 
        RowBox[{"{", "ResidualType", "}"}]}], "}"}], " ", "..."}], " ", 
     "}"}]}]}], "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{{3.4690494315620813`*^9, 3.469049467985229*^9}, {
  3.469050459548184*^9, 3.4690504600569277`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MakeCCUpdate", "[", "Residuals_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Raw", " ", "Terms"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TermList", "=", " ", 
      RowBox[{"Fold", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"#1", ",", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "}"}], ",", "Residuals"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Dest", " ", "Tensor", " ", "for", " ", "each"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"DestList", "=", 
      RowBox[{"Fold", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"#1", ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"#2", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "}"}]}], "]"}]}], 
          "]"}], "&"}], ",", 
        RowBox[{"{", "}"}], ",", "Residuals"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Intermediates", " ", "are", " ", 
       RowBox[{"Append", "[", 
        RowBox[{"intr", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"In", ",", "inter"}], "}"}], "}"}], ",", 
             RowBox[{"NRIndices", "[", 
              RowBox[{"ten1", ",", "ten2"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Defn:\>\"", ",", "ten1", ",", "ten2"}], "}"}]}], 
          "}"}]}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"IntermList", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Intermediate", " ", "numbers", " ", "used", " ", "for", " ", "each", 
       " ", "contraction", " ", 
       RowBox[{"(", 
        RowBox[{"or", " ", "0", " ", "if", " ", 
         RowBox[{"it", "'"}], "s", " ", "obvious"}], ")"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"IntermediatesPerTerm", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "List", " ", "of", " ", "integers", " ", "ordering", " ", "the", " ", 
       RowBox[{"contractions", ":", " ", 
        RowBox[{"123", " ", 
         RowBox[{"etc", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PairwiseTerms", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"Factorize", ",", "TermList"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"Ti1", "\[LessEqual]", "Ti2"}], ",", 
           RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"CommonIntermediatesForFactorization", "[", 
            RowBox[{
             RowBox[{"TermList", "[", 
              RowBox[{"[", "Ti1", "]"}], "]"}], ",", 
             RowBox[{"PairwiseTerms", "[", 
              RowBox[{"[", "Ti1", "]"}], "]"}], ",", 
             RowBox[{"TermList", "[", 
              RowBox[{"[", "Ti2", "]"}], "]"}], ",", 
             RowBox[{"PairwiseTerms", "[", 
              RowBox[{"[", "Ti2", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Can Factorize: \>\"", ",", " ", 
               RowBox[{"TermList", "[", 
                RowBox[{"[", "Ti1", "]"}], "]"}], ",", "\"\< and \>\"", ",", 
               " ", 
               RowBox[{"TermList", "[", 
                RowBox[{"[", "Ti2", "]"}], "]"}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", ")"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"Ti1", ",", "1", ",", 
         RowBox[{"Length", "[", "PairwiseTerms", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Ti2", ",", "1", ",", 
         RowBox[{"Length", "[", "PairwiseTerms", "]"}]}], "}"}]}], "]"}], 
     ";"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Makes", " ", "list", " ", "of", " ", "I", " ", "types", " ", "and", 
       " ", "Terms", " ", "they", " ", "Occur", " ", "in"}], "..."}], "*)"}], 
    "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Routines", " ", "below", " ", "may", " ", "use", " ", "the", " ", 
     "global", " ", "variables", " ", "from", " ", "MakeCCUpdate"}], "..."}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "Does", " ", "the", " ", "work", " ", "of", " ", "PrepareContraction"}], 
    ",", " ", 
    RowBox[{"Minimizes", " ", "Storage", " ", "Costs"}]}], 
   "\[IndentingNewLine]", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AssignInitalFactorization", "[", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PairwiseTerms", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"Factorize", ",", "TermList"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllIndices", "[", "Tens_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tore", "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sow", "[", 
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Tens", "[", 
              RowBox[{"[", "itr", "]"}], "]"}], ",", "1"}], "]"}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"itr", ",", "1", ",", 
            RowBox[{"Length", "[", "Tens", "]"}]}], "}"}]}], "]"}], "]"}], 
       "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tore", "=", 
      RowBox[{"Flatten", "[", "tore", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "tore", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllContractedIndices", "[", "STerm_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ti", " ", "=", " ", 
      RowBox[{"AllIndices", "[", "STerm", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"UTi", "=", 
      RowBox[{"Union", "[", "Ti", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Select", "[", 
       RowBox[{"UTi", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"Ti", ",", "#"}], "]"}], ">", "1"}], ")"}], "&"}]}], 
       "]"}], "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllUniqueIndices", "[", "STerm_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ti", " ", "=", 
      RowBox[{"Union", "[", " ", 
       RowBox[{"AllIndices", "[", "STerm", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Ci", " ", "=", " ", 
      RowBox[{"AllContractedIndices", "[", "STerm", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Complement", "[", 
       RowBox[{"Ti", ",", "Ci"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PairwiseCost", "[", 
    RowBox[{"t1_", ",", "t2_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Cx", "=", 
      RowBox[{"AllContractedIndices", "[", 
       RowBox[{"{", 
        RowBox[{"t1", ",", "t2"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ex", "=", 
      RowBox[{"AllUniqueIndices", "[", 
       RowBox[{"{", 
        RowBox[{"t1", ",", "t2"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Length", "[", "Cx", "]"}], "+", 
       RowBox[{"Length", "[", "Ex", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Factorize", "[", "ATerm_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Remove", " ", 
       RowBox[{"Factor", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"TmpTerm", "=", 
       RowBox[{"Drop", "[", 
        RowBox[{"ATerm", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"TmpFac", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Perform", " ", "the", " ", "First", " ", "Contraction"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CostTable", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"it1", "===", "it2"}], ",", "99", ",", 
            RowBox[{"PairwiseCost", "[", 
             RowBox[{
              RowBox[{"TmpTerm", "[", 
               RowBox[{"[", "it1", "]"}], "]"}], ",", 
              RowBox[{"TmpTerm", "[", 
               RowBox[{"[", "it2", "]"}], "]"}]}], "]"}]}], "]"}], ")"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"it1", ",", "1", ",", 
           RowBox[{"Length", "[", "TmpTerm", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"it2", ",", "1", ",", 
           RowBox[{"Length", "[", "TmpTerm", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MinFirstCost", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"CostTable", ",", 
          RowBox[{"Min", "[", "CostTable", "]"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"TmpFac", "=", 
       RowBox[{"Append", "[", 
        RowBox[{"TmpFac", ",", 
         RowBox[{"MinFirstCost", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TmpFac", "=", 
       RowBox[{"Append", "[", 
        RowBox[{"TmpFac", ",", 
         RowBox[{"MinFirstCost", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{
       "\"\<CostTable: \>\"", ",", "CostTable", " ", ",", " ", 
        "\"\< First Con: \>\"", ",", "TmpFac"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "TmpFac", "]"}], "<", 
         RowBox[{"Length", "[", "TmpTerm", "]"}]}], ",", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Tmpin", "=", 
           RowBox[{"Select", "[", 
            RowBox[{"TmpTerm", ",", "TmpFac"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"UncontractedIndices", "=", 
           RowBox[{"AllUniqueIndices", "[", "Tmpin", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"CostTable", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"TmpFac", ",", "ite"}], "]"}], ",", "99", ",", 
                RowBox[{"PairwiseCost", "[", 
                 RowBox[{"UncontractedIndices", ",", 
                  RowBox[{"TmpTerm", "[", 
                   RowBox[{"[", "ite", "]"}], "]"}]}], "]"}]}], "]"}], ")"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"ite", ",", "1", ",", 
               RowBox[{"Length", "[", "TmpTerm", "]"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"NextTen", "=", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"CostTable", ",", 
              RowBox[{"Min", "[", "CostTable", "]"}]}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"TmpFac", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"TmpFac", ",", 
             RowBox[{"NextTen", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "TmpFac", "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"deepest", " ", "level", " ", "First"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateInitalIntermediates", "[", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Return", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Does", " ", "every", " ", "posibility"}], ",", " ", 
    RowBox[{"Extracts", " ", "the", " ", 
     RowBox[{"Factors", "."}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CommonIntermediatesForFactorization", "[", 
    RowBox[{"ATerm1_", ",", "AFac1_", ",", "ATerm2_", ",", "AFac2_"}], "]"}], 
   ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"COFF", "=", "False"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"Fl1", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{
        RowBox[{"FoldList", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
          RowBox[{"{", "}"}], ",", "AFac1"}], "]"}], ",", "1"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Fl2", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{
        RowBox[{"FoldList", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
          RowBox[{"{", "}"}], ",", "AFac2"}], "]"}], ",", "1"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"COFF", "\[Equal]", "True"}], ",", 
               RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"PrintL", "[", 
              RowBox[{"\"\<In1: \>\"", ",", " ", 
               RowBox[{"Fl1", "[", 
                RowBox[{"[", "it1", "]"}], "]"}], ",", "\"\< In2: \>\"", ",", 
               
               RowBox[{"Fl2", "[", 
                RowBox[{"[", "it2", "]"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"TempSum1", "=", 
              RowBox[{"GenerateSummary", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{"ATerm1", ",", "1"}], "]"}], ",", 
                RowBox[{"Fl1", "[", 
                 RowBox[{"[", "it1", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"TempSum2", "=", 
              RowBox[{"GenerateSummary", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{"ATerm2", ",", "1"}], "]"}], ",", 
                RowBox[{"Fl2", "[", 
                 RowBox[{"[", "it2", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"TempSum1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", 
                RowBox[{"Length", "[", 
                 RowBox[{"TempSum2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
               RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ContainsSubterm", "[", 
                RowBox[{"TempSum1", ",", "TempSum2"}], "]"}], ",", 
               RowBox[{"(", 
                RowBox[{"COFF", "=", "True"}], ")"}], ",", 
               RowBox[{"(", 
                RowBox[{"COFF", "=", "False"}], ")"}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"it2", ",", "1", ",", 
             RowBox[{"Length", "[", "Fl2", "]"}]}], "}"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"it1", ",", "1", ",", 
         RowBox[{"Length", "[", "Fl1", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "COFF", "]"}]}], " ", "\[IndentingNewLine]", 
    ")"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Are", " ", "two", " ", "terms", " ", "the", " ", "same", " ", "up", " ", 
     "to", " ", "n"}], "-", 
    RowBox[{"1", "th", " ", 
     RowBox[{"contraction", " ", "?"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CommonIntermediatesForLast", "[", 
    RowBox[{"ATerm1_", ",", "AFac1_", ",", "ATerm2_", ",", "AFac2_"}], "]"}], 
   ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"COFF", "=", "False"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"Fl1", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{
        RowBox[{"FoldList", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
          RowBox[{"{", "}"}], ",", "AFac1"}], "]"}], ",", "1"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Fl2", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{
        RowBox[{"FoldList", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
          RowBox[{"{", "}"}], ",", "AFac2"}], "]"}], ",", "1"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Fl1", "=", 
      RowBox[{"{", 
       RowBox[{"Fl1", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Fl2", "=", 
      RowBox[{"{", 
       RowBox[{"Fl2", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"COFF", "\[Equal]", "True"}], ",", 
               RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"PrintL", "[", 
              RowBox[{"\"\<In1: \>\"", ",", " ", 
               RowBox[{"Fl1", "[", 
                RowBox[{"[", "it1", "]"}], "]"}], ",", "\"\< In2: \>\"", ",", 
               
               RowBox[{"Fl2", "[", 
                RowBox[{"[", "it2", "]"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"TempSum1", "=", 
              RowBox[{"GenerateSummary", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{"ATerm1", ",", "1"}], "]"}], ",", 
                RowBox[{"Fl1", "[", 
                 RowBox[{"[", "it1", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"TempSum2", "=", 
              RowBox[{"GenerateSummary", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{"ATerm2", ",", "1"}], "]"}], ",", 
                RowBox[{"Fl2", "[", 
                 RowBox[{"[", "it2", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"TempSum1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", 
                RowBox[{"Length", "[", 
                 RowBox[{"TempSum2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
               RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ContainsSubterm", "[", 
                RowBox[{"TempSum1", ",", "TempSum2"}], "]"}], ",", 
               RowBox[{"(", 
                RowBox[{"COFF", "=", "True"}], ")"}], ",", 
               RowBox[{"(", 
                RowBox[{"COFF", "=", "False"}], ")"}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"it2", ",", "1", ",", 
             RowBox[{"Length", "[", "Fl2", "]"}]}], "}"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"it1", ",", "1", ",", 
         RowBox[{"Length", "[", "Fl1", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "COFF", "]"}]}], " ", "\[IndentingNewLine]", 
    ")"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Term", "#"}], " ", ",", " ", 
      RowBox[{"SubTerm", " ", "Summarized"}]}], "}"}], "\[IndentingNewLine]", 
    "A", " ", "SubTerm", " ", "Summary", " ", 
    RowBox[{"is", ":", " ", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Ordered", " ", "Tensor", " ", "List"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Connection", " ", "Matrix"}], "}"}]}], "}"}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Factor", " ", "Must", " ", "Be", " ", 
    RowBox[{"Ommitted", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateSummary", "[", "ATerm_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TTerm", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"ATerm", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Tensors", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", "TTerm", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tt", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"TTerm", "[", 
          RowBox[{"[", 
           RowBox[{"#", ",", "1"}], "]"}], "]"}], "&"}], ",", "Tensors"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"STensors", "=", 
      RowBox[{"Tensors", "[", 
       RowBox[{"[", 
        RowBox[{"Ordering", "[", "tt", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tl", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"SummaryName", ",", 
        RowBox[{"DTTerm", "[", 
         RowBox[{"[", "STensors", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cl", " ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ConnectionsBetween", "[", 
         RowBox[{
          RowBox[{"TTerm", "[", 
           RowBox[{"[", 
            RowBox[{"STensors", "[", 
             RowBox[{"[", "iter1", "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"TTerm", "[", 
           RowBox[{"[", 
            RowBox[{"STensors", "[", 
             RowBox[{"[", "iter2", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter1", ",", "1", ",", 
          RowBox[{"Length", "[", "STensors", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"iter2", ",", "1", ",", 
          RowBox[{"Length", "[", "STensors", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"tl", ",", "cl"}], "}"}], "]"}], ";"}], "\[IndentingNewLine]", 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateSummary", "[", 
     RowBox[{"ATerm_", ",", "Tensors_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tt", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ATerm", "[", 
           RowBox[{"[", 
            RowBox[{"#", ",", "1"}], "]"}], "]"}], "&"}], ",", "Tensors"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"STensors", "=", 
       RowBox[{"Tensors", "[", 
        RowBox[{"[", 
         RowBox[{"Ordering", "[", "tt", "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tl", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"SummaryName", ",", 
         RowBox[{"ATerm", "[", 
          RowBox[{"[", "STensors", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cl", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ConnectionsBetween", "[", 
          RowBox[{
           RowBox[{"ATerm", "[", 
            RowBox[{"[", 
             RowBox[{"STensors", "[", 
              RowBox[{"[", "iter1", "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"ATerm", "[", 
            RowBox[{"[", 
             RowBox[{"STensors", "[", 
              RowBox[{"[", "iter2", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"iter1", ",", "1", ",", 
           RowBox[{"Length", "[", "STensors", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"iter2", ",", "1", ",", 
           RowBox[{"Length", "[", "STensors", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"tl", ",", "cl"}], "}"}], "]"}], ";"}], "\[IndentingNewLine]",
      ")"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Arguement", " ", "is", " ", "a", " ", "tensor"}], ".."}], " ", 
    "If", " ", "Hamiltonian", " ", "then", " ", "it", " ", 
    RowBox[{"get", "'"}], "s", " ", "a", " ", "block", " ", 
    RowBox[{"number", "."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SummaryName", "[", "SNArg_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"SNArg", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "===", 
        RowBox[{"{", 
         RowBox[{"Vn", ",", "1"}], "}"}]}], "  ", ",", 
       RowBox[{"{", 
        RowBox[{"Vn", ",", 
         RowBox[{"InHamBlock", "[", 
          RowBox[{"{", "SNArg", "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"SNArg", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "===", 
          RowBox[{"{", 
           RowBox[{"Fn", ",", "1"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"Fn", ",", 
           RowBox[{"InHamBlock", "[", 
            RowBox[{"{", "SNArg", "}"}], "]"}]}], "}"}], ",", 
         RowBox[{"SNArg", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}]}], "]"}], "]"}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConnectionsBetween", "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"hol", "=", 
       RowBox[{"HolePart", "[", 
        RowBox[{"RIndices", "[", 
         RowBox[{"A", ",", "B"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"par", "=", 
       RowBox[{"PartPart", "[", 
        RowBox[{"RIndices", "[", 
         RowBox[{"A", ",", "B"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "hol", "]"}], ",", 
         RowBox[{"Length", "[", "par", "]"}]}], "}"}], "]"}]}], 
     "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Arguements", " ", "are", " ", "SubTermSummaries"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ContainsSubterm", "[", 
     RowBox[{"bg_", ",", "sm_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"toreCST", "=", "True"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ContainsTens", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Count", "[", 
              RowBox[{
               RowBox[{"bg", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "]"}], ">", "0"}],
             ",", "1", ",", "0"}], "]"}], "&"}], ",", 
         RowBox[{"sm", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"IfContainsTens", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Total", "[", "ContainsTens", "]"}], "\[Equal]", 
         RowBox[{"Length", "[", "sm", "]"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"IfContainsTens", ",", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"SliceOut", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{
                RowBox[{"bg", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"sm", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "itr"}], "]"}], "]"}]}], "]"}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"itr", ",", "1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"sm", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"ToEqual", "=", 
           RowBox[{"ExtractSubterm", "[", 
            RowBox[{"bg", ",", "SliceOut"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"toreCST", "=", 
           RowBox[{"ContainsSubterm2", "[", 
            RowBox[{"bg", ",", "sm"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
         ")"}], ",", 
        RowBox[{
         RowBox[{"toreCST", "=", "False"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "toreCST", "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "Any", " ", "useless", " ", "tensors", " ", "have", " ", "been", " ", 
     "removed", " ", 
     RowBox[{"above", ".", " ", "This"}], " ", "routine", " ", "permutes", 
     " ", "equivalent", " ", "tensors", " ", "every"}], "-", 
    RowBox[{"which", " ", 
     RowBox[{"way", ".", " ", "Finally"}], " ", "extracts", " ", "only", " ", 
     "the", " ", "first", " ", "N", " ", "Copies", " ", 
     RowBox[{"needed", "."}]}]}], " ", "\[IndentingNewLine]", "   ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ContainsSubterm2", "[", 
     RowBox[{"bg2_", ",", "sm2_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"TORE", "=", "False"}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"MutationsForBg", "=", 
       RowBox[{"PermuteSame", "[", 
        RowBox[{"bg2", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"MutationsForSm", "=", 
       RowBox[{"PermuteSame", "[", 
        RowBox[{"sm2", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Bg2 \>\"", ",", "bg2"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Sm2 \>\"", ",", "sm2"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<MutationsForBg \>\"", ",", "MutationsForBg"}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<MutationsForSm \>\"", ",", "MutationsForSm"}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"TORE", "\[Equal]", "True"}], ",", 
                RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tm1", "=", 
               RowBox[{"ExtractSubterm", "[", 
                RowBox[{"bg2", ",", 
                 RowBox[{"MutationsForBg", "[", 
                  RowBox[{"[", "ita", "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tm2", "=", 
               RowBox[{"ExtractSubterm", "[", 
                RowBox[{"sm2", ",", 
                 RowBox[{"MutationsForSm", "[", 
                  RowBox[{"[", "itb", "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"ContainsSubterm3", "[", 
                 RowBox[{"tm1", ",", "tm2"}], "]"}], ",", 
                RowBox[{"(", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"TORE", "=", "True"}], ";"}], "\[IndentingNewLine]",
                  ")"}]}], "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"itb", ",", "1", ",", 
              RowBox[{"Length", "[", "MutationsForSm", "]"}]}], "}"}]}], 
           "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"ita", ",", "1", ",", 
          RowBox[{"Length", "[", "MutationsForBg", "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", 
       RowBox[{"\"\<Returning From ContainsSubterm2: \>\"", ",", "TORE"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "TORE", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Finally", " ", "direct", " ", "equivalence", " ", "is", " ", 
    RowBox[{"checked", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContainsSubterm3", "[", 
    RowBox[{"bg3_", ",", "sm3_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TORE3", "=", "True"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"bg3", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "it3", ",", "it4"}], "]"}], "]"}], "=!=", 
                 RowBox[{"sm3", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "it3", ",", "it4"}], "]"}], "]"}]}], 
                ")"}], ",", 
               RowBox[{"TORE3", "=", "False"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"TORE3", "\[Equal]", "False"}], ",", 
               RowBox[{"Break", "[", "]"}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", ")"}], ",", 
           RowBox[{"{", 
            RowBox[{"it4", ",", "1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"bg3", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";"}],
         "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"it3", ",", "1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"bg3", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintL", "[", 
      RowBox[{"\"\<Returning From ContainsSubterm3: \>\"", ",", "TORE3"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "TORE3", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExtractSubterm", "[", 
     RowBox[{"st_", ",", "lst_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tpar", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{
         RowBox[{"st", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "lst", "]"}], ",", "1"}], "]"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"mpar", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"st", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "i1", ",", "i2"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", "1", ",", 
           RowBox[{"Length", "[", "lst", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i2", ",", "1", ",", 
           RowBox[{"Length", "[", "lst", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"tpar", ",", "mpar"}], "}"}], "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Arguement", " ", "is", " ", "a", " ", 
    RowBox[{"list", ".", " ", "Returns"}], " ", "a", " ", "list", " ", "of", 
    " ", "all", " ", "permutations", " ", "between", " ", "equivalent", " ", 
    RowBox[{"entries", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PermuteSame", "[", "MyArg_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"TmpRange", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"1", ",", 
         RowBox[{"Length", "[", "MyArg", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ToPer", "=", 
       RowBox[{"ListOfRepetitions", "[", "MyArg", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintL", "[", "ToPer", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Srce", "=", 
       RowBox[{"Flatten", "[", "ToPer", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Plists", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"Permutations", ",", "ToPer"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Selects", " ", "one", " ", "from", " ", "each", " ", "list", " ", 
        "all", " ", 
        RowBox[{"ways", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PTuples", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"Flatten", ",", 
         RowBox[{"Tuples", "[", "Plists", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SamePer", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Scan", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"SamePer", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"SamePer", ",", 
             RowBox[{"PermuteDims", "[", 
              RowBox[{"TmpRange", ",", "Srce", ",", "#"}], "]"}]}], "]"}]}], 
          ")"}], "&"}], ",", "PTuples"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "SamePer", "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Moves", " ", "element", " ", "in", " ", "SD", " ", "to", " ", "DD"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PermuteDims", "[", 
    RowBox[{"AList_", ",", "SD_", ",", "DD_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PDTR", "=", "AList"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PDTR", "=", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"PDTR", ",", 
            RowBox[{
             RowBox[{"SD", "[", 
              RowBox[{"[", "PDIT", "]"}], "]"}], "\[Rule]", 
             RowBox[{"DD", "[", 
              RowBox[{"[", "PDIT", "]"}], "]"}]}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ")"}], ",", 
       RowBox[{"{", 
        RowBox[{"PDIT", ",", "1", ",", 
         RowBox[{"Length", "[", "SD", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "PDTR", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Same", " ", "entires", " ", "must", " ", "be", " ", "contiguous"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ListOfRepetitions", "[", "MyArg_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"LOR", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Count", "[", 
              RowBox[{"MyArg", ",", 
               RowBox[{"MyArg", "[", 
                RowBox[{"[", "tit", "]"}], "]"}]}], "]"}], ">", "1"}], ",", 
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"LOR", " ", "=", " ", 
               RowBox[{"Append", "[", 
                RowBox[{"LOR", ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Position", "[", 
                   RowBox[{"MyArg", ",", 
                    RowBox[{"MyArg", "[", 
                    RowBox[{"[", "tit", "]"}], "]"}]}], "]"}], "]"}]}], 
                "]"}]}], ";"}], "\[IndentingNewLine]", ")"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ")"}], ",", 
        RowBox[{"{", 
         RowBox[{"tit", ",", "1", ",", 
          RowBox[{"Length", "[", "MyArg", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"LOR", "=", 
       RowBox[{"Union", "[", "LOR", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "LOR", "]"}]}], "\[IndentingNewLine]", ")"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "No", " ", "References", " ", "to", " ", "those", " ", "globals", " ", 
    "allowed", " ", "below", " ", "this", " ", "comment"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"--", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "--"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]\
}]}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PopulateString", "[", 
    RowBox[{"num_", ",", "fac_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", 
     RowBox[{"(", 
      RowBox[{"\"\<Term[\>\"", "<>", 
       RowBox[{"ToString", "[", "num", "]"}], "<>", 
       "\"\<].Populate(eimap,cmap,\>\"", "<>", 
       RowBox[{"ToString", "[", "fac", "]"}], "<>", "\"\<,\>\"", "<>", 
       "\"\<0, UnfactorizedExternal\>\"", "<>", "\"\<);\>\""}], ")"}], "]"}], 
    "\[IndentingNewLine]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EimapString", "[", 
    RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ToPrint", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ToPrint", "=", 
          RowBox[{"ToPrint", "<>", "\"\< eimap[\>\"", "<>", 
           RowBox[{"ToString", "[", " ", 
            RowBox[{"iter1", "-", "1"}], "]"}], "<>", 
           "\"\<] = pair<int,int>(\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"TPosOfIndex", "[", 
             RowBox[{
              RowBox[{"rshape", "[", 
               RowBox[{"[", 
                RowBox[{"iter1", "+", "1"}], "]"}], "]"}], ",", "arg"}], 
             "]"}], "]"}], "<>", "\"\<);\>\""}]}], ";"}], "\n", "\t", ")"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"iter1", ",", "1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"NRIndices", "[", 
           RowBox[{
            RowBox[{"arg", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"arg", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "ToPrint", "]"}], ";"}], "\n", ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CmapString", "[", 
   RowBox[{"arg_", ",", "rshape_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ToPrint", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ToPrint", "=", 
         RowBox[{"ToPrint", "<>", "\"\< cmap[\>\"", "<>", 
          RowBox[{"ToString", "[", " ", 
           RowBox[{"iter1", "-", "1"}], "]"}], "<>", 
          "\"\<] = pair<int,int>(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"CPosOfIndex", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"RIndices", "[", 
               RowBox[{
                RowBox[{"arg", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"arg", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", 
              RowBox[{"[", "iter1", "]"}], "]"}], ",", "arg"}], "]"}], "]"}], 
          "<>", "\"\<);\>\""}]}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
      RowBox[{"{", 
       RowBox[{"iter1", ",", "1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"RIndices", "[", 
          RowBox[{
           RowBox[{"arg", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"arg", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], "]"}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "ToPrint", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ContractStr", "[", 
   RowBox[{"num_", ",", "Uno_", ",", "Dos_", ",", "Tres_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{"Return", "[", 
    RowBox[{"(", 
     RowBox[{"\"\<Term[\>\"", "<>", 
      RowBox[{"ToString", "[", "num", "]"}], "<>", "\"\<].Contract(\>\"", "<>", 
      RowBox[{"CppName", "[", "Uno", "]"}], "<>", "\"\<,\>\"", "<>", 
      RowBox[{"CppName", "[", "Dos", "]"}], "<>", "\"\<,\>\"", "<>", 
      RowBox[{"CppName", "[", "Tres", "]"}], "<>", "\"\<);\>\""}], ")"}], 
    "]"}], "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DoPairwiseContraction", "[", 
   RowBox[{"Factor_", ",", "NumOne_", ",", "NumTwo_", ",", "NumThree_"}], 
   "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EimapString", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"NumOne", ",", "NumTwo"}], "}"}], ",", "NumThree"}], "]"}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"CmapString", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"NumOne", ",", "NumTwo"}], "}"}], ",", "NumThree"}], "]"}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"Fac", "=", 
     RowBox[{"ToString", "[", 
      RowBox[{"N", "[", "Factor", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"Print", "[", 
     RowBox[{"PopulateString", "[", 
      RowBox[{"TermNumber", ",", "Fac"}], "]"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"ContractStr", "[", 
      RowBox[{"TermNumber", ",", "NumOne", ",", "NumTwo", ",", "NumThree"}], 
      "]"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "\"\<eimap.clear(); cmap.clear();\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"TermNumber", "++"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]}], "Input",
 CellChangeTimes->{{3.468115751628497*^9, 3.46811585887815*^9}, {
   3.468115925943008*^9, 3.468115979187099*^9}, 3.468116064265904*^9, {
   3.468116115257309*^9, 3.468116164181912*^9}, 3.4681162145914383`*^9, {
   3.4681162561596947`*^9, 3.468116292540107*^9}, {3.468116504799776*^9, 
   3.468116529588749*^9}, {3.468116588404789*^9, 3.468116594020289*^9}, {
   3.4681166967770967`*^9, 3.468116736688829*^9}, {3.468116912502376*^9, 
   3.468116925570202*^9}, {3.468116997304598*^9, 3.468117012711969*^9}, {
   3.468122084806384*^9, 3.468122169962907*^9}, {3.468122205955223*^9, 
   3.468122241115058*^9}, {3.46812227521026*^9, 3.4681222767857847`*^9}, {
   3.468122368305792*^9, 3.468122412637146*^9}, 3.468122452896549*^9, {
   3.468122508212331*^9, 3.4681225141544847`*^9}, {3.4681225621059933`*^9, 
   3.468122592857018*^9}, {3.468122626090312*^9, 3.468122707846077*^9}, {
   3.4681228257972803`*^9, 3.4681228318593197`*^9}, {3.46812287709781*^9, 
   3.468122885175733*^9}, {3.4681248663650503`*^9, 3.468125006209627*^9}, {
   3.468125037385832*^9, 3.468125149094042*^9}, 3.468125199213241*^9, 
   3.4681257002555323`*^9, {3.4681257604969378`*^9, 3.468125865714396*^9}, {
   3.468125911471661*^9, 3.4681260160036507`*^9}, {3.468126153741728*^9, 
   3.4681261615160627`*^9}, {3.468173128121314*^9, 3.468173133187586*^9}, {
   3.468173206979409*^9, 3.4681732080572233`*^9}, {3.46817332981328*^9, 
   3.468173371933031*^9}, {3.46817342514638*^9, 3.468173425468479*^9}, {
   3.46817345605809*^9, 3.4681734642816143`*^9}, {3.468173545382886*^9, 
   3.468173545779492*^9}, {3.46817360026691*^9, 3.468173612883761*^9}, {
   3.4681736993745527`*^9, 3.4681737590353518`*^9}, {3.468174094675589*^9, 
   3.46817409779688*^9}, {3.468174201014121*^9, 3.468174207940652*^9}, {
   3.468174244724228*^9, 3.468174251077715*^9}, 3.4681743008516607`*^9, 
   3.4681746129516087`*^9, 3.468174687364122*^9, {3.468174725974969*^9, 
   3.4681747702743893`*^9}, {3.468174859477057*^9, 3.468174867763604*^9}, {
   3.4689838189206553`*^9, 3.4689838251039047`*^9}, {3.4689840083731937`*^9, 
   3.46898402585281*^9}, 3.4689841111272907`*^9, {3.468984183671239*^9, 
   3.468984187825992*^9}, {3.468984231802499*^9, 3.4689842333833313`*^9}, {
   3.46898426869794*^9, 3.4689842846385527`*^9}, {3.468984318301458*^9, 
   3.468984327959303*^9}, {3.4689844201471357`*^9, 3.468984441369766*^9}, {
   3.468984670975219*^9, 3.468984696223185*^9}, {3.468984741148752*^9, 
   3.4689848709460707`*^9}, 3.468984949195483*^9, {3.4689850383920717`*^9, 
   3.468985058420409*^9}, {3.468987555708208*^9, 3.468987607520214*^9}, {
   3.468987933718046*^9, 3.468988029309101*^9}, {3.469036090973851*^9, 
   3.4690361281302843`*^9}, {3.469036217034787*^9, 3.4690362398571043`*^9}, {
   3.469036770366849*^9, 3.4690368369446507`*^9}, 3.469036974408283*^9, {
   3.469037063458869*^9, 3.4690370919670963`*^9}, {3.469047984217491*^9, 
   3.469048029725746*^9}, {3.46904807227706*^9, 3.4690481006767817`*^9}, {
   3.4690481655070667`*^9, 3.469048271123495*^9}, 3.4690483017578487`*^9, {
   3.469048443925042*^9, 3.4690485669544*^9}, {3.4690486951196423`*^9, 
   3.469048756305842*^9}, {3.469049045466441*^9, 3.4690490643289127`*^9}, {
   3.469049174334043*^9, 3.469049193624344*^9}, {3.469049301884762*^9, 
   3.469049346309107*^9}, {3.4690493915394793`*^9, 3.469049419531872*^9}, {
   3.469051038537652*^9, 3.469051112075198*^9}, {3.46905122770837*^9, 
   3.4690512381153507`*^9}, {3.469051300107532*^9, 3.469051322407384*^9}, {
   3.46905140890132*^9, 3.469051442166368*^9}, {3.469051593731792*^9, 
   3.4690516336389513`*^9}, {3.4690516708521214`*^9, 3.469051685876667*^9}, {
   3.4690517968897943`*^9, 3.469051838128952*^9}, {3.469051899236404*^9, 
   3.469051967773469*^9}, {3.469052090575549*^9, 3.469052099488488*^9}, {
   3.469052150892962*^9, 3.469052159933763*^9}, {3.469052209088161*^9, 
   3.46905229531514*^9}, {3.469052375323627*^9, 3.469052376155052*^9}, {
   3.469052452029208*^9, 3.469052475667159*^9}, {3.469052586313168*^9, 
   3.4690526801065607`*^9}, {3.469052771766005*^9, 3.4690528137292147`*^9}, {
   3.469053456930131*^9, 3.4690534763326473`*^9}, {3.4690535435958023`*^9, 
   3.4690535608735523`*^9}, {3.469053646517405*^9, 3.469053790888126*^9}, {
   3.469054482424762*^9, 3.46905449560119*^9}, {3.469054536827458*^9, 
   3.469054554477675*^9}, {3.469054696649479*^9, 3.469054703525222*^9}, {
   3.469054764929496*^9, 3.469054783819516*^9}, {3.469054928067458*^9, 
   3.469054961184927*^9}, {3.469054992009295*^9, 3.469054996634712*^9}, {
   3.469055110757505*^9, 3.469055231754675*^9}, {3.469056938257579*^9, 
   3.469056947356614*^9}, {3.469107121468709*^9, 3.4691073550708437`*^9}, {
   3.469107385714501*^9, 3.469107386752592*^9}, {3.469107441620838*^9, 
   3.469107512240759*^9}, {3.4691075967065697`*^9, 3.4691076264007072`*^9}, {
   3.469108336962158*^9, 3.4691084957266006`*^9}, {3.469108536906802*^9, 
   3.469108561976157*^9}, {3.4691085970867367`*^9, 3.469108757641914*^9}, {
   3.4691090313792877`*^9, 3.469109286537126*^9}, {3.469109337065318*^9, 
   3.469109431444153*^9}, {3.4691094629632263`*^9, 3.469109522719015*^9}, {
   3.469109566207773*^9, 3.469109755471689*^9}, {3.469109978389595*^9, 
   3.4691099895344467`*^9}, {3.469111228375277*^9, 3.4691112294487333`*^9}, {
   3.469111348399703*^9, 3.469111475311695*^9}, {3.469111520961955*^9, 
   3.4691115318366013`*^9}, {3.4691115989182863`*^9, 3.469111660689672*^9}, {
   3.4691117577681637`*^9, 3.4691119290151052`*^9}, {3.469111990901127*^9, 
   3.469112503501161*^9}, {3.469112662292169*^9, 3.46911281375694*^9}, {
   3.469123701283326*^9, 3.469123702331867*^9}, {3.469125189300487*^9, 
   3.469125191691119*^9}, {3.469165993399336*^9, 3.469166007371999*^9}, {
   3.4692818099582977`*^9, 3.469281825408101*^9}, {3.469281893702189*^9, 
   3.469282031852179*^9}, {3.46928213027426*^9, 3.469282294397558*^9}, {
   3.469282460952978*^9, 3.469282478799852*^9}, {3.469282527685245*^9, 
   3.469282564979199*^9}, {3.4692826026301813`*^9, 3.469282606230073*^9}, {
   3.469284096715526*^9, 3.469284385663763*^9}, {3.469284432862214*^9, 
   3.469284487429883*^9}, {3.469284565977969*^9, 3.469284850003312*^9}, {
   3.469285046574573*^9, 3.469285071735632*^9}, {3.469285117130485*^9, 
   3.469285122529395*^9}, {3.4692851753461943`*^9, 3.46928520286305*^9}, {
   3.469285243597671*^9, 3.469285253247479*^9}, {3.469285291279503*^9, 
   3.469285300550869*^9}, {3.469285340877776*^9, 3.469285483368135*^9}, {
   3.469285580564027*^9, 3.469285611424945*^9}, {3.4692862898061733`*^9, 
   3.469286333764011*^9}, {3.469286366486871*^9, 3.469286392888598*^9}, {
   3.469286509555481*^9, 3.469286537989422*^9}, {3.469286663856145*^9, 
   3.469286685233727*^9}, {3.469286715576919*^9, 3.469286732255179*^9}, {
   3.469286798742197*^9, 3.469286905552539*^9}, {3.469286981193178*^9, 
   3.469287149562154*^9}, {3.469287257001199*^9, 3.4692872789325323`*^9}, 
   3.469287315111017*^9, {3.469288812253998*^9, 3.469288825576501*^9}, {
   3.469289554990479*^9, 3.469289583349408*^9}, {3.469289661868154*^9, 
   3.469289665367144*^9}, {3.469290052140852*^9, 3.469290058006606*^9}, {
   3.469290396964712*^9, 3.4692903971687593`*^9}, {3.469290467744948*^9, 
   3.469290507221336*^9}, {3.4692905444874268`*^9, 3.4692905469721403`*^9}, {
   3.469291654133259*^9, 3.4692916885110893`*^9}, {3.46929183969882*^9, 
   3.469291882722472*^9}, 3.469291917996388*^9, {3.469291957939515*^9, 
   3.469291986129179*^9}, 3.469292021733397*^9, {3.469331046390176*^9, 
   3.4693310556003933`*^9}, 3.4693312471003942`*^9, {3.469331347130089*^9, 
   3.4693313777454557`*^9}, {3.469331439851222*^9, 3.469331485001761*^9}, {
   3.469380792924384*^9, 3.469380840954207*^9}, 3.469380873877355*^9, {
   3.4693810346523867`*^9, 3.4693810417556877`*^9}, {3.46938108489081*^9, 
   3.469381140983451*^9}, {3.469381189235877*^9, 3.46938134635262*^9}, {
   3.469381398797904*^9, 3.469381466133737*^9}, {3.4693814982887573`*^9, 
   3.469381614387628*^9}, {3.469381674729642*^9, 3.469381702743664*^9}, {
   3.469381743053986*^9, 3.469381764484832*^9}, {3.469381826304019*^9, 
   3.469381849323448*^9}, {3.469381880267704*^9, 3.469381890458438*^9}, {
   3.4693823186398773`*^9, 3.4693823278929234`*^9}, {3.4693823603507*^9, 
   3.469382363172946*^9}, {3.469382466417262*^9, 3.469382486558621*^9}, 
   3.469382759094001*^9, 3.469383019990271*^9, {3.469383171698472*^9, 
   3.4693831876804247`*^9}, {3.469383225103981*^9, 3.469383237695355*^9}, {
   3.469383573500656*^9, 3.469383645697097*^9}, {3.469383691625806*^9, 
   3.4693837020785007`*^9}, {3.469383763515553*^9, 3.469383773397429*^9}, {
   3.4693838175456877`*^9, 3.4693838849006243`*^9}, {3.4693868779896193`*^9, 
   3.469386878929372*^9}, {3.469387040630384*^9, 3.469387066897669*^9}, {
   3.469387115406804*^9, 3.469387207415186*^9}, {3.4693872393302803`*^9, 
   3.469387283843796*^9}, {3.469387696427799*^9, 3.469387794419714*^9}, {
   3.469395662999454*^9, 3.469395712507853*^9}, {3.4694067216981688`*^9, 
   3.469406901433221*^9}, {3.469406968712216*^9, 3.469407097833543*^9}, {
   3.4694076966701937`*^9, 3.4694077475435753`*^9}, 3.469407788200918*^9, {
   3.469407825657259*^9, 3.46940788937109*^9}, {3.469407965337244*^9, 
   3.469407970176125*^9}, 3.469408330743967*^9, {3.469419098567444*^9, 
   3.4694191060641613`*^9}, {3.469419607295483*^9, 3.469419616504665*^9}, {
   3.469419688304194*^9, 3.469419763408908*^9}, {3.469420084301393*^9, 
   3.4694201323788424`*^9}, {3.469420176651256*^9, 3.469420212966453*^9}, 
   3.4694203370505867`*^9}]
}, Closed]]
},
WindowSize->{795, 732},
WindowMargins->{{157, Automatic}, {Automatic, 86}},
FrontEndVersion->"6.0 for Mac OS X x86 (32-bit) (April 20, 2007)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"], FontColor -> 
    RGBColor[0., 0., 0.], Background -> RGBColor[1., 1., 1.]]}, Visible -> 
  False, FrontEndVersion -> "6.0 for Mac OS X x86 (32-bit) (April 20, 2007)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[568, 21, 26, 0, 27, "Input"],
Cell[CellGroupData[{
Cell[619, 25, 498, 7, 67, "Section"],
Cell[1120, 34, 404, 8, 71, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1561, 47, 429, 7, 67, "Section"],
Cell[1993, 56, 343, 8, 27, "Input"],
Cell[2339, 66, 367619, 8984, 20348, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[369995, 9055, 302, 4, 37, "Section"],
Cell[370300, 9061, 45464, 1004, 2308, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[415801, 10070, 526, 7, 37, "Section"],
Cell[416330, 10079, 64835, 1515, 4003, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[481202, 11599, 429, 7, 59, "Section"],
Cell[481634, 11608, 37176, 858, 2863, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[518847, 12471, 251, 5, 37, "Section"],
Cell[519101, 12478, 567, 14, 73, "Input"],
Cell[519671, 12494, 65827, 1626, 4243, "Input"]
}, Closed]]
}
]
*)

(* End of internal cache information *)
